(function(){"use strict";var wt=typeof global=="object"&&global&&global.Object===Object&&global,St=wt,gt=typeof self=="object"&&self&&self.Object===Object&&self,xt=St||gt||Function("return this")(),_t=xt,Tt=_t.Symbol,v=Tt,H=Object.prototype,Et=H.hasOwnProperty,jt=H.toString,m=v?v.toStringTag:void 0;function Ot(t){var n=Et.call(t,m),e=t[m];try{t[m]=void 0;var r=!0}catch{}var o=jt.call(t);return r&&(n?t[m]=e:delete t[m]),o}var At=Object.prototype,It=At.toString;function Ct(t){return It.call(t)}var Rt="[object Null]",Ut="[object Undefined]",W=v?v.toStringTag:void 0;function Y(t){return t==null?t===void 0?Ut:Rt:W&&W in Object(t)?Ot(t):Ct(t)}function G(t){return t!=null&&typeof t=="object"}var $t="[object Symbol]";function Pt(t){return typeof t=="symbol"||G(t)&&Y(t)==$t}function kt(t,n){for(var e=-1,r=t==null?0:t.length,o=Array(r);++e<r;)o[e]=n(t[e],e,t);return o}var Mt=Array.isArray,q=Mt,Ft=1/0,B=v?v.prototype:void 0,J=B?B.toString:void 0;function S(t){if(typeof t=="string")return t;if(q(t))return kt(t,S)+"";if(Pt(t))return J?J.call(t):"";var n=t+"";return n=="0"&&1/t==-Ft?"-0":n}var Vt=/\s/;function Dt(t){for(var n=t.length;n--&&Vt.test(t.charAt(n)););return n}var Ht=/^\s+/;function Wt(t){return t&&t.slice(0,Dt(t)+1).replace(Ht,"")}function Yt(t,n,e,r){for(var o=t.length,i=e+(r?1:-1);r?i--:++i<o;)if(n(t[i],i,t))return i;return-1}function Gt(t){return t!==t}function qt(t,n,e){for(var r=e-1,o=t.length;++r<o;)if(t[r]===n)return r;return-1}function L(t,n,e){return n===n?qt(t,n,e):Yt(t,Gt,e)}function X(t){return t==null?"":S(t)}function Bt(t,n,e){var r=-1,o=t.length;n<0&&(n=-n>o?0:o+n),e=e>o?o:e,e<0&&(e+=o),o=n>e?0:e-n>>>0,n>>>=0;for(var i=Array(o);++r<o;)i[r]=t[r+n];return i}function Z(t,n,e){var r=t.length;return e=e===void 0?r:e,!n&&e>=r?t:Bt(t,n,e)}var Jt="\\ud800-\\udfff",Lt="\\u0300-\\u036f",Xt="\\ufe20-\\ufe2f",Zt="\\u20d0-\\u20ff",zt=Lt+Xt+Zt,Kt="\\ufe0e\\ufe0f",Qt="\\u200d",Nt=RegExp("["+Qt+Jt+zt+Kt+"]");function te(t){return Nt.test(t)}function ee(t){return t.split("")}var z="\\ud800-\\udfff",ne="\\u0300-\\u036f",re="\\ufe20-\\ufe2f",oe="\\u20d0-\\u20ff",ie=ne+re+oe,se="\\ufe0e\\ufe0f",ce="["+z+"]",C="["+ie+"]",R="\\ud83c[\\udffb-\\udfff]",ue="(?:"+C+"|"+R+")",K="[^"+z+"]",Q="(?:\\ud83c[\\udde6-\\uddff]){2}",N="[\\ud800-\\udbff][\\udc00-\\udfff]",fe="\\u200d",tt=ue+"?",et="["+se+"]?",ae="(?:"+fe+"(?:"+[K,Q,N].join("|")+")"+et+tt+")*",le=et+tt+ae,de="(?:"+[K+C+"?",C,Q,N,ce].join("|")+")",pe=RegExp(R+"(?="+R+")|"+de+le,"g");function he(t){return t.match(pe)||[]}function g(t){return te(t)?he(t):ee(t)}var ye="[object String]";function be(t){return typeof t=="string"||!q(t)&&G(t)&&Y(t)==ye}function ve(t,n){for(var e=t.length;e--&&L(n,t[e],0)>-1;);return e}function nt(t,n){for(var e=-1,r=t.length;++e<r&&L(n,t[e],0)>-1;);return e}function me(t,n,e){if(t=X(t),t&&(e||n===void 0))return Wt(t);if(!t||!(n=S(n)))return t;var r=g(t),o=g(n),i=nt(r,o),s=ve(r,o)+1;return Z(r,i,s).join("")}var we=/^\s+/;function Se(t,n,e){if(t=X(t),t&&(e||n===void 0))return t.replace(we,"");if(!t||!(n=S(n)))return t;var r=g(t),o=nt(r,g(n));return Z(r,o).join("")}var U=function(t,n){return U=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])},U(t,n)};function x(t,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");U(t,n);function e(){this.constructor=t}t.prototype=n===null?Object.create(n):(e.prototype=n.prototype,new e)}function $(t){var n=typeof Symbol=="function"&&Symbol.iterator,e=n&&t[n],r=0;if(e)return e.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function _(t,n){var e=typeof Symbol=="function"&&t[Symbol.iterator];if(!e)return t;var r=e.call(t),o,i=[],s;try{for(;(n===void 0||n-- >0)&&!(o=r.next()).done;)i.push(o.value)}catch(u){s={error:u}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(s)throw s.error}}return i}function T(t,n,e){if(e||arguments.length===2)for(var r=0,o=n.length,i;r<o;r++)(i||!(r in n))&&(i||(i=Array.prototype.slice.call(n,0,r)),i[r]=n[r]);return t.concat(i||Array.prototype.slice.call(n))}function y(t){return typeof t=="function"}function rt(t){var n=function(r){Error.call(r),r.stack=new Error().stack},e=t(n);return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var P=rt(function(t){return function(e){t(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(r,o){return o+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function k(t,n){if(t){var e=t.indexOf(n);0<=e&&t.splice(e,1)}}var E=function(){function t(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var n,e,r,o,i;if(!this.closed){this.closed=!0;var s=this._parentage;if(s)if(this._parentage=null,Array.isArray(s))try{for(var u=$(s),f=u.next();!f.done;f=u.next()){var a=f.value;a.remove(this)}}catch(h){n={error:h}}finally{try{f&&!f.done&&(e=u.return)&&e.call(u)}finally{if(n)throw n.error}}else s.remove(this);var c=this.initialTeardown;if(y(c))try{c()}catch(h){i=h instanceof P?h.errors:[h]}var l=this._finalizers;if(l){this._finalizers=null;try{for(var I=$(l),w=I.next();!w.done;w=I.next()){var Ke=w.value;try{st(Ke)}catch(h){i=i??[],h instanceof P?i=T(T([],_(i)),_(h.errors)):i.push(h)}}}catch(h){r={error:h}}finally{try{w&&!w.done&&(o=I.return)&&o.call(I)}finally{if(r)throw r.error}}}if(i)throw new P(i)}},t.prototype.add=function(n){var e;if(n&&n!==this)if(this.closed)st(n);else{if(n instanceof t){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(n)}},t.prototype._hasParent=function(n){var e=this._parentage;return e===n||Array.isArray(e)&&e.includes(n)},t.prototype._addParent=function(n){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(n),e):e?[e,n]:n},t.prototype._removeParent=function(n){var e=this._parentage;e===n?this._parentage=null:Array.isArray(e)&&k(e,n)},t.prototype.remove=function(n){var e=this._finalizers;e&&k(e,n),n instanceof t&&n._removeParent(this)},t.EMPTY=function(){var n=new t;return n.closed=!0,n}(),t}(),ot=E.EMPTY;function it(t){return t instanceof E||t&&"closed"in t&&y(t.remove)&&y(t.add)&&y(t.unsubscribe)}function st(t){y(t)?t():t.unsubscribe()}var ct={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},M={setTimeout:function(t,n){for(var e=[],r=2;r<arguments.length;r++)e[r-2]=arguments[r];var o=M.delegate;return o!=null&&o.setTimeout?o.setTimeout.apply(o,T([t,n],_(e))):setTimeout.apply(void 0,T([t,n],_(e)))},clearTimeout:function(t){var n=M.delegate;return((n==null?void 0:n.clearTimeout)||clearTimeout)(t)},delegate:void 0};function ge(t){M.setTimeout(function(){throw t})}function ut(){}function j(t){t()}var ft=function(t){x(n,t);function n(e){var r=t.call(this)||this;return r.isStopped=!1,e?(r.destination=e,it(e)&&e.add(r)):r.destination=Ee,r}return n.create=function(e,r,o){return new V(e,r,o)},n.prototype.next=function(e){this.isStopped||this._next(e)},n.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},n.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},n.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},n.prototype._next=function(e){this.destination.next(e)},n.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},n.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},n}(E),xe=Function.prototype.bind;function F(t,n){return xe.call(t,n)}var _e=function(){function t(n){this.partialObserver=n}return t.prototype.next=function(n){var e=this.partialObserver;if(e.next)try{e.next(n)}catch(r){O(r)}},t.prototype.error=function(n){var e=this.partialObserver;if(e.error)try{e.error(n)}catch(r){O(r)}else O(n)},t.prototype.complete=function(){var n=this.partialObserver;if(n.complete)try{n.complete()}catch(e){O(e)}},t}(),V=function(t){x(n,t);function n(e,r,o){var i=t.call(this)||this,s;if(y(e)||!e)s={next:e??void 0,error:r??void 0,complete:o??void 0};else{var u;i&&ct.useDeprecatedNextContext?(u=Object.create(e),u.unsubscribe=function(){return i.unsubscribe()},s={next:e.next&&F(e.next,u),error:e.error&&F(e.error,u),complete:e.complete&&F(e.complete,u)}):s=e}return i.destination=new _e(s),i}return n}(ft);function O(t){ge(t)}function Te(t){throw t}var Ee={closed:!0,next:ut,error:Te,complete:ut},je=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Oe(t){return t}function Ae(t){return t.length===0?Oe:t.length===1?t[0]:function(e){return t.reduce(function(r,o){return o(r)},e)}}var at=function(){function t(n){n&&(this._subscribe=n)}return t.prototype.lift=function(n){var e=new t;return e.source=this,e.operator=n,e},t.prototype.subscribe=function(n,e,r){var o=this,i=Ce(n)?n:new V(n,e,r);return j(function(){var s=o,u=s.operator,f=s.source;i.add(u?u.call(i,f):f?o._subscribe(i):o._trySubscribe(i))}),i},t.prototype._trySubscribe=function(n){try{return this._subscribe(n)}catch(e){n.error(e)}},t.prototype.forEach=function(n,e){var r=this;return e=lt(e),new e(function(o,i){var s=new V({next:function(u){try{n(u)}catch(f){i(f),s.unsubscribe()}},error:i,complete:o});r.subscribe(s)})},t.prototype._subscribe=function(n){var e;return(e=this.source)===null||e===void 0?void 0:e.subscribe(n)},t.prototype[je]=function(){return this},t.prototype.pipe=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return Ae(n)(this)},t.prototype.toPromise=function(n){var e=this;return n=lt(n),new n(function(r,o){var i;e.subscribe(function(s){return i=s},function(s){return o(s)},function(){return r(i)})})},t.create=function(n){return new t(n)},t}();function lt(t){var n;return(n=t??ct.Promise)!==null&&n!==void 0?n:Promise}function Ie(t){return t&&y(t.next)&&y(t.error)&&y(t.complete)}function Ce(t){return t&&t instanceof ft||Ie(t)&&it(t)}var Re=rt(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),dt=function(t){x(n,t);function n(){var e=t.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return n.prototype.lift=function(e){var r=new pt(this,this);return r.operator=e,r},n.prototype._throwIfClosed=function(){if(this.closed)throw new Re},n.prototype.next=function(e){var r=this;j(function(){var o,i;if(r._throwIfClosed(),!r.isStopped){r.currentObservers||(r.currentObservers=Array.from(r.observers));try{for(var s=$(r.currentObservers),u=s.next();!u.done;u=s.next()){var f=u.value;f.next(e)}}catch(a){o={error:a}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(o)throw o.error}}}})},n.prototype.error=function(e){var r=this;j(function(){if(r._throwIfClosed(),!r.isStopped){r.hasError=r.isStopped=!0,r.thrownError=e;for(var o=r.observers;o.length;)o.shift().error(e)}})},n.prototype.complete=function(){var e=this;j(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var r=e.observers;r.length;)r.shift().complete()}})},n.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(n.prototype,"observed",{get:function(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0},enumerable:!1,configurable:!0}),n.prototype._trySubscribe=function(e){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,e)},n.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},n.prototype._innerSubscribe=function(e){var r=this,o=this,i=o.hasError,s=o.isStopped,u=o.observers;return i||s?ot:(this.currentObservers=null,u.push(e),new E(function(){r.currentObservers=null,k(u,e)}))},n.prototype._checkFinalizedStatuses=function(e){var r=this,o=r.hasError,i=r.thrownError,s=r.isStopped;o?e.error(i):s&&e.complete()},n.prototype.asObservable=function(){var e=new at;return e.source=this,e},n.create=function(e,r){return new pt(e,r)},n}(at),pt=function(t){x(n,t);function n(e,r){var o=t.call(this)||this;return o.destination=e,o.source=r,o}return n.prototype.next=function(e){var r,o;(o=(r=this.destination)===null||r===void 0?void 0:r.next)===null||o===void 0||o.call(r,e)},n.prototype.error=function(e){var r,o;(o=(r=this.destination)===null||r===void 0?void 0:r.error)===null||o===void 0||o.call(r,e)},n.prototype.complete=function(){var e,r;(r=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||r===void 0||r.call(e)},n.prototype._subscribe=function(e){var r,o;return(o=(r=this.source)===null||r===void 0?void 0:r.subscribe(e))!==null&&o!==void 0?o:ot},n}(dt);let ht=60*1e3;var yt=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function u(c){try{a(r.next(c))}catch(l){s(l)}}function f(c){try{a(r.throw(c))}catch(l){s(l)}}function a(c){c.done?i(c.value):o(c.value).then(u,f)}a((r=r.apply(t,n||[])).next())})};function Ue(t=ht){return new Promise(n=>setTimeout(n,t))}function $e(t,n=ht,e=new ke("function did not complete within allowed time")){return yt(this,void 0,void 0,function*(){const r=Symbol("DELAY_EXPIRED"),o=yield Promise.race([t(),Pe(n,r)]);if(o===r)throw e;return o})}const Pe=(t,n)=>yt(void 0,void 0,void 0,function*(){return yield Ue(t),n});class ke extends Error{constructor(){super(...arguments),this.isTimeout=!0}}var A,Me=new Uint8Array(16);function Fe(){if(!A&&(A=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!A))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return A(Me)}var Ve=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function bt(t){return typeof t=="string"&&Ve.test(t)}for(var d=[],D=0;D<256;++D)d.push((D+256).toString(16).substr(1));function De(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,e=(d[t[n+0]]+d[t[n+1]]+d[t[n+2]]+d[t[n+3]]+"-"+d[t[n+4]]+d[t[n+5]]+"-"+d[t[n+6]]+d[t[n+7]]+"-"+d[t[n+8]]+d[t[n+9]]+"-"+d[t[n+10]]+d[t[n+11]]+d[t[n+12]]+d[t[n+13]]+d[t[n+14]]+d[t[n+15]]).toLowerCase();if(!bt(e))throw TypeError("Stringified UUID is invalid");return e}function He(t){if(!bt(t))throw TypeError("Invalid UUID");var n,e=new Uint8Array(16);return e[0]=(n=parseInt(t.slice(0,8),16))>>>24,e[1]=n>>>16&255,e[2]=n>>>8&255,e[3]=n&255,e[4]=(n=parseInt(t.slice(9,13),16))>>>8,e[5]=n&255,e[6]=(n=parseInt(t.slice(14,18),16))>>>8,e[7]=n&255,e[8]=(n=parseInt(t.slice(19,23),16))>>>8,e[9]=n&255,e[10]=(n=parseInt(t.slice(24,36),16))/1099511627776&255,e[11]=n/4294967296&255,e[12]=n>>>24&255,e[13]=n>>>16&255,e[14]=n>>>8&255,e[15]=n&255,e}function We(t,n,e){t=t||{};var r=t.random||(t.rng||Fe)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,n){e=e||0;for(var o=0;o<16;++o)n[e+o]=r[o];return n}return De(r)}const vt=t=>{typeof t=="function"&&t()},Ye=(t,n=1e3,e)=>{const{immediate:r=!1}=e??{};let o=null;const i=()=>{o=setInterval(()=>{vt(t)},n)},s=()=>{o&&(clearInterval(o),o=null)};return r===!0&&i(),{start:i,stop:s}},Ge=(t,n=3e3,e)=>{const{immediate:r=!1}=e??{};let o=null;const i=(u=!1)=>{u===!0&&s(),o=setTimeout(()=>{vt(t)},n)},s=()=>{o&&(clearTimeout(o),o=null)};return r===!0&&i(),{start:i,stop:s}};class qe{constructor(n){n&&this.setup(n),self.onerror=(e,r,o,i,s)=>{const u={source:r,lineno:o,colno:i,error:s};console.error(["=> worker process error",u]),this.send({type:"error",data:u})}}setup(n){self.onmessage=e=>{const{type:r}=e.data,o=n[r];typeof o=="function"&&o(e.data)}}send(n){self.postMessage(n)}}let p=null;const mt=new dt,Be=()=>{const t=We();return[...He(t)].map(r=>r.toString(16).padStart(2,"0")).slice(0,6).join(":")},Je=t=>{let n="";const{data:e}=t;if(e instanceof ArrayBuffer){const o=new Uint8Array(e).slice(10);for(const i of o)n+=String.fromCharCode(i)}else n=e;return n},Le=Be(),Xe=1e4,Ze=1e3,ze={async createSocket(t){const{type:n,reqId:e,data:r}=t,o=Ge(()=>{console.warn("=> socket message timeout",r.url)},Xe),i=Ye(()=>{p&&p.readyState===p.OPEN&&p.send(Le)},Ze),{url:s}=r;p=new WebSocket(s),p.binaryType="arraybuffer",p.onopen=()=>{console.info(["=> socket open",s]),b.send({type:n,reqId:e}),b.send({type:"open",data:!0}),i.start()},p.onmessage=u=>{o.start(!0);const f=Je(u);f&&(b.send({type:"message",data:f}),mt.next(f))},p.onerror=()=>{i.stop(),o.stop(),console.error(["=> socket error",s]),b.send({type:"error",data:{url:s}})},p.onclose=u=>{const{reason:f,code:a}=u;i.stop(),o.stop(),b.send({type:"close",data:{reason:f,code:a}}),console.info(["=> socket closed",{url:s,reason:f,code:a}])}},closeSocket(){console.info(["=> active close socket."]),p&&(p.close(3001,"active disconnect"),p=null)},execCmd(t){const{type:n,reqId:e,data:r}=t;console.log(["=> execCmd",r]);let o,i=r.cmd;be(r.args)&&(i+=" "+r.args);const s=()=>new Promise(f=>{p==null||p.send(`${i}
`),r.type==="get"?o=mt.subscribe(a=>{if(a.startsWith(r.cmd)){console.log(["=> execCmd subscribe result",a,r.cmd]);const c=me(Se(a,r.cmd));f(c)}}):f(r)}),u=r.timeout??1500;$e(s,u,new Error(`get '${r.cmd}' data timeout.`)).then(f=>{b.send({type:n,reqId:e,data:f})}).catch(f=>{console.error(f),b.send({type:n,reqId:e,data:""})}).finally(()=>{o==null||o.unsubscribe(),console.log(["=> execCmd finally",r.cmd,e])})}},b=new qe;b.setup(ze)})();
