import{_ as B,b5 as X,u as Y,n as ee,bp as T,j as M,ah as N,B as te,d as se}from"../assets/index-83a10b2e.js";import{k as h,D as o,E as p,G as a,K as l,j as g,u as n,F as y,M as A,H as ne,b as C,f as m,I,J as P,Z as ae,L as oe,q as re,y as ie}from"./xcs-vue-family-70642f71.js";import{I as x}from"./index-e902da34.js";import{s as ce,f as H,a as j,b as le}from"./firmware-update-failed@2x-64908d38.js";import"./index-55948043.js";import"./xcs-canvas-5c2592d6.js";const de={class:"is-low"},ue={class:"text"},pe=h({__name:"IsLow",setup(r){return(i,e)=>{const d=x;return o(),p("section",de,[a("div",ue,l(i.$t("device.firmware.app_version_low")),1),g(d,{fit:"contain",position:"center",src:n(ce)},null,8,["src"])])}}});const _e=B(pe,[["__scopeId","data-v-9598607c"]]),fe={class:"update-info"},me={class:"text"},ve=h({__name:"Download",props:{percentage:null},setup(r){return(i,e)=>{const d=x;return o(),p("section",fe,[a("div",me,l(i.$t("device.firmware.downloading",{percent:r.percentage})),1),g(d,{fit:"contain",position:"center",src:n(H)},null,8,["src"])])}}}),we={class:"update-info"},ge={class:"info-header"},he={class:"info-content"},ye={class:"info-content-box"},$e={class:"info-footer"},ke=h({__name:"Info",props:{changeLog:null,currentVersion:null,latestVersion:null},setup(r){return(i,e)=>(o(),p("section",we,[a("div",ge,l(i.$t("device.firmware.need_update_firmware",{latestVersion:r.latestVersion})),1),a("div",he,[a("div",ye,l(r.changeLog),1)]),a("div",$e,l(i.$t("device.firmware.version")+r.currentVersion),1)]))}});const xe=B(ke,[["__scopeId","data-v-3279f7ec"]]),be=""+new URL("../assets/upload-turn-off-e21aa9e7.png",import.meta.url).href,Fe={class:"result"},Ce={class:"text"},Ie={class:"text"},Ue={key:0,class:"text"},De={class:"text"},Le=h({__name:"Result",props:{isDownload:{type:Boolean},isSuccess:{type:Boolean},supportUrl:null,isDSeries:{type:Boolean}},setup(r){const i=e=>{X(e)};return(e,d)=>{const c=x;return o(),p("section",Fe,[r.isDownload?(o(),p(y,{key:0},[a("div",Ce,l(e.$t("device.firmware.download_fail")),1),g(c,{fit:"contain",position:"center",src:n(j)},null,8,["src"])],64)):(o(),p(y,{key:1},[r.isSuccess?(o(),p(y,{key:0},[a("div",Ie,l(e.$t("device.firmware.succeeded")),1),r.isDSeries?(o(),p("div",Ue,l(e.$t("device.firmware.upload_off_tip")),1)):A("",!0),g(c,{fit:"contain",position:"center",src:r.isDSeries?n(be):n(le)},null,8,["src"])],64)):(o(),p(y,{key:1},[a("div",De,l(e.$t("device.firmware.failed")),1),g(c,{fit:"contain",position:"center",src:n(j)},null,8,["src"]),a("div",{class:"text",onClick:d[0]||(d[0]=u=>i(r.supportUrl))},l(e.$t("device.firmware.helper")),1)],64))],64))])}}});const V=B(Le,[["__scopeId","data-v-39f57439"]]),Ve=""+new URL("../assets/upload-turn-on-b108c861.png",import.meta.url).href,Be={class:"tips"},Se={class:"text"},Re=h({__name:"Tips",setup(r){return(i,e)=>{const d=x;return o(),p("section",Be,[a("div",Se,l(i.$t("device.firmware.upload_on_tip")),1),g(d,{fit:"contain",position:"center",src:n(Ve)},null,8,["src"])])}}}),Ee={class:"updating"},Te={class:"text"},Me={class:"text"},Ne=h({__name:"Updating",props:{percentage:null},setup(r){return(i,e)=>{const d=x;return o(),p("section",Ee,[a("div",Te,l(i.$t("device.firmware.updating_tip1",{percent:r.percentage})),1),a("div",Me,l(i.$t("device.firmware.updating_tip2")),1),g(d,{fit:"contain",position:"center",src:n(H)},null,8,["src"])])}}}),Pe={class:"firmware-container"},je={class:"firmware-container-header"},Ae={class:"firmware-container-content"},He={class:"firmware-container-footer"},Ze=h({__name:"Firmware",setup(r){const i={default:xe,tips:Re,downloading:ve,updating:Ne,downloadFail:V,updateFail:V,done:V},e=Y(),d=ee(),{t:c}=ne(),u=C("default"),K=m(()=>e.firmwareUpdating),U=C(0),b=C(!1),D=C(!1),S=m(()=>{var t;return((t=e.deviceFirmware)==null?void 0:t.appVersionLow)===!0}),q=m(()=>u.value==="default"?c("device.firmware.find_new_version"):c("device.firmware.update")),z=m(()=>{var t,s,f;return K.value?(f=(s=(t=e.ext)==null?void 0:t.config)==null?void 0:s.supportUrls)==null?void 0:f.firmware:""}),G=m(()=>!["updating","downloading"].includes(u.value)),J=m(()=>{var k;if(!e.ext)return!1;const{show:t,shouldUpdate:s,latestVersion:f,manualCheckUpdate:_}=e.ext.deviceFirmware||{},$=T.has({id:(k=e.ext)==null?void 0:k.id,version:f});return!!(t&&s&&(!$||_))}),O=m(()=>{var f;const[t]=d.langKey.split("-"),s=(f=e.deviceFirmware)==null?void 0:f.changeLog;return s?s[t]||s.en:"empty"}),v=t=>{U.value=Math.floor(t)},F=()=>{e.firmwareUpdating=!1,e.deviceFirmware.manualCheckUpdate=!1,e.deviceFirmware.show=!1},R=t=>{const s=e.ext;t&&s&&T.add({id:s.id,version:t}),F()},E=m(()=>{var s;return["D1","D1Pro"].includes(((s=e.ext)==null?void 0:s.id)||"")}),Z=async()=>{E.value?u.value="tips":await L()},L=async t=>{if(!t&&!e.connected){M(c("device.firmware.empty_ext"));return}const s=e.ext;if(s&&N.isFunction(s.apis.isDeviceBusy)){const _=await s.apis.isDeviceBusy();if(N.isError(_)||_){M(c("device.firmware.busy_tips"));return}}const{downloadUrl:f=""}=e.deviceFirmware;await e.updateFirmware({full:!1,baud:230400,downloadUrl:f,download:{start(){e.firmwareUpdating=!0,U.value=0,D.value=!0,u.value="downloading"},progress(_){console.debug(["=> download firmware progress",_]),v(_)},success(){v(0),u.value="updating",D.value=!1},fail(){v(0),b.value=!1,u.value="downloadFail"}},upload:{start(){v(0)},progress(_){console.debug(["=> upload firmware progress",_]),v(_)},success(){v(0),b.value=!0,u.value="done"},fail(){v(0),b.value=!1,u.value="updateFail"}}})},w=m(()=>[[{label:c("device.firmware.later_remind"),onClick:()=>{var t;R((t=e.deviceFirmware)==null?void 0:t.latestVersion)}},{label:c("device.firmware.update_now"),type:"primary",onClick:()=>Z()}],[],[{label:c("device.firmware.cancel"),onClick:()=>F()},{label:c("device.firmware.retry"),type:"primary",onClick:()=>L(!0)}],[{label:c("device.firmware.done"),type:"primary",onClick:()=>F()}],[{label:c("device.firmware.later_remind"),onClick:()=>{var t;R((t=e.deviceFirmware)==null?void 0:t.latestVersion)}},{label:c("setting.download_update"),onClick:()=>{var t;(t=window.MeApi)==null||t.updateAppVersion(d.downloadUrl)}}],[{label:c("device.firmware.tips_confirm"),type:"primary",onClick:()=>L()}]]),Q=m(()=>{if(S.value)return w.value[4];switch(u.value){case"default":return w.value[0];case"downloading":case"updating":return w.value[1];case"downloadFail":case"updateFail":return w.value[2];case"done":return w.value[3];case"tips":return w.value[5];default:return w.value[0]}});return(t,s)=>{const f=te,_=se;return o(),I(_,{show:n(J),round:"",closeable:n(G),"close-on-click-overlay":!1,style:{width:"90%"},onClosed:s[0]||(s[0]=$=>u.value="default"),onClickCloseIcon:F},{default:P(()=>{var $;return[a("section",Pe,[a("section",je,[a("h3",null,l(n(q)),1)]),a("section",Ae,[n(S)?(o(),I(_e,{key:0})):(o(),p(y,{key:1},[i[u.value]?(o(),I(ae(i[u.value]),{key:0,"is-download":D.value,"is-success":b.value,"change-log":n(O),"current-version":(($=n(e).info)==null?void 0:$.version)||"","latest-version":n(e).deviceFirmware.latestVersion,percentage:U.value,"support-url":n(z),"is-d-series":n(E)},null,8,["is-download","is-success","change-log","current-version","latest-version","percentage","support-url","is-d-series"])):A("",!0)],64))]),a("section",He,[(o(!0),p(y,null,oe(n(Q),(k,W)=>(o(),I(f,re({key:W,size:"small"},k),{default:P(()=>[ie(l(k.label),1)]),_:2},1040))),128))])])]}),_:1},8,["show","closeable"])}}});export{Ze as default};
