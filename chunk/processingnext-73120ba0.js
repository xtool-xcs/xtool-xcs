import{t as re,J as le,w as q,aN as _e,y as ue,aO as Y,_ as x,aP as H,u as de,j as pe,aQ as G,aR as ve,B as D,a6 as ee,m as te,aS as me,aD as se,M as U,ak as ge,aT as fe}from"../assets/index-83a10b2e.js";import{u as he}from"./systemback-e5f1562f.js";import{k as f,f as L,j as v,o as X,p as we,e as ye,b as $,D as n,E as b,s as Pe,v as be,M as V,F as O,u,I as l,a5 as K,H as J,J as w,Z as y,y as M,K as p,c as F,G as h,ab as Ce,w as z}from"./xcs-vue-family-70642f71.js";import{N as oe}from"./datasource-5dbe607a.js";import{N as W}from"./index-36e5bf24.js";import{D as Ie}from"./index-efc3e601.js";import{a7 as ke}from"./xcs-canvas-5c2592d6.js";import{N as xe}from"./spin-afa417d1.js";import{I as ne}from"./index-e902da34.js";import"./index-55948043.js";import"./index-ac8ea00e.js";import"./constant-2a798a0e.js";import"./light-87cce264.js";import"./fade-in.cssr-8e3c8f09.js";import"./use-style-1280d407.js";import"./loading-b06a4834.js";const[Se,Q]=re("progress"),Ae={color:String,inactive:Boolean,pivotText:String,textColor:String,showPivot:le,pivotColor:String,trackColor:String,strokeWidth:q,percentage:{type:q,default:0,validator:o=>+o>=0&&+o<=100}};var Me=f({name:Se,props:Ae,setup(o){const t=L(()=>o.inactive?void 0:o.color),e=()=>{const{textColor:s,pivotText:c,pivotColor:a,percentage:i}=o,r=c??`${i}%`;if(o.showPivot&&r){const _={color:s,left:`${+i}%`,transform:`translate(-${+i}%,-50%)`,background:a||t.value};return v("span",{style:_,class:Q("pivot",{inactive:o.inactive})},[r])}};return()=>{const{trackColor:s,percentage:c,strokeWidth:a}=o,i={background:s,height:_e(a)},r={width:`${c}%`,background:t.value};return v("div",{class:Q(),style:i},[v("span",{class:Q("portion",{inactive:o.inactive}),style:r},null),e()])}}});const ce=ue(Me);function $e(o){He(o),he(()=>!!o.handleBack()),X(()=>{o.onDestroy()})}function He(o){we(o.key,o)}function T(o){return ye(o)}const Te=f({__name:"ProcessViewHeader",props:{totalTime:null},setup(o){const t=o,e=$(!1),s=$(0);return L(()=>Y(t.totalTime)),(c,a)=>{const i=ce;return n(),b(O,null,[Pe(v(i,{"show-pivot":!1,percentage:s.value},null,8,["percentage"]),[[be,e.value]]),V("",!0)],64)}}});const Ge=x(Te,[["__scopeId","data-v-241f7b54"]]),Ee=f({__name:"PreviewHeader",setup(o){const t=T(H),{totalTime:e}=t,s=()=>{t.finishPage()};return(c,a)=>{const i=W,r=oe;return n(),b("div",null,[v(i,{fixed:"","left-arrow":"",placeholder:"",title:c.$t("device.process.process_preview"),onClickLeft:s},null,8,["title"]),u(t).isFortyWatt()?(n(),l(r,{key:0,class:"preview-notice",wrapable:"",scrollable:!1,mode:"closeable",text:c.$t("device.process.air_assist_set_tip_for_40w")},null,8,["text"])):V("",!0),v(Ge,{"total-time":u(e)},null,8,["total-time"])])}}});const Ne=x(Ee,[["__scopeId","data-v-b7381aee"]]),Be={class:"process-view-footer"},Ve=f({__name:"PreviewFooter",setup(o){const t=T(H),e=de(),s=K(),{t:c}=J(),a=$(""),{isCalculateGCode:i}=t,r=()=>{s.push({path:"editor",query:{from:"preview"}}),t.exitCalculateGcode(),t.clearCacheCanvasShop()},_=async()=>{if(e.isFrameMode||e.isInProcessing){pe(c("device.setting.setting_error_in_processing"));return}t.changePage(G.UPLOAD);const C=window.dataLayer;window.MeApi&&(a.value=await window.MeApi.app.getAppVersion()),ve({extId:C[0].deviceInfo.extId,xcs_version:a.value})},P=L(()=>{const C=Ie[e.ext.id||""];return(C==null?void 0:C.PreviewSettingPop)||""});return(C,N)=>{const g=D,I=ee;return n(),b("div",Be,[v(I,{size:"10px",direction:"vertical",fill:""},{default:w(()=>[(n(),l(y(u(P)),{ref:"previewSetting","calculate-gcodeing":u(i)},null,8,["calculate-gcodeing"])),v(g,{style:{width:"100%"},plain:"",type:"success",disabled:u(t).isFrameMode(),onClick:r},{default:w(()=>[M(p(C.$t("mobile.process.go_canvas_adjustment")),1)]),_:1},8,["disabled"]),v(g,{type:"primary",style:{width:"100%"},disabled:u(t).isFrameMode()||u(i),onClick:_},{default:w(()=>[M(p(C.$t("device.process.send_gcode")),1)]),_:1},8,["disabled"])]),_:1})])}}});const Fe=x(Ve,[["__scopeId","data-v-f29e69ec"]]),Le={class:"process-view-canvas"},Ue=f({__name:"ProcessViewCanvasF1",setup(o){const t=T(H),e=$(),s=async()=>{const m=await t.calculateGCode();console.log(["=> handleGenGcode gcode",m])},c=async()=>{let d=await t.getCanvasShot();if(d){e.value.appendChild(d);const{width:S,height:A}=ke(d.width/2,d.height/2,e.value.clientWidth,e.value.clientHeight);d.style.width=`${S}px`,d.style.height=`${A}px`}};F(async()=>{await s(),e.value.innerHTML="",c(),a()}),F(()=>{i()});const a=()=>{e.value.addEventListener("touchstart",C),e.value.addEventListener("touchmove",I),e.value.addEventListener("touchend",B)},i=()=>{e.value.removeListener("touchstart",C),e.value.removeListener("touchmove",I),e.value.removeListener("touchend",B),N.value=0,g.value=0,P=1};let r=1,_={x:0,y:0},P=1;const C=m=>{if(m instanceof TouchEvent){const d=m.changedTouches;if(d.length===2){const S=d[0],A=d[1];r=k(S,A),_=E(S,A)}}},N=$(0),g=$(0),I=m=>{if(m instanceof TouchEvent){const d=m.changedTouches;if(d.length===2){const S=d[0],A=d[1],j=k(S,A),R=E(S,A);r<=1&&(r=j),P+=j/r-1,P<=.3&&(P=.3),r=j,(_.x===0||_.y===0)&&(_=R);const ae=R.x-_.x,ie=R.y-_.y;N.value=N.value+ie,g.value=g.value+ae,e.value.style.transform=`scale(${P})`,_=R}}},B=()=>{r=1,_={x:0,y:0}},k=(m,d)=>{const S=m.pageX-d.pageX,A=m.pageY-d.pageY;return Math.hypot(S,A)},E=(m,d)=>{const S=(m.pageX+d.pageX)/2,A=(m.pageY+d.pageY)/2;return{x:S,y:A}};return(m,d)=>(n(),b("div",Le,[v(u(xe),{show:u(t).isCalculateGCode.value},{default:w(()=>[h("div",{ref_key:"canvasPreviewWrapper",ref:e,class:"canvas-container-box"},null,512)]),_:1},8,["show"])]))}});const Z=x(Ue,[["__scopeId","data-v-ce137c77"]]),De={class:"preview-container"},Oe=f({__name:"Preview",setup(o){const t=()=>Z;return(e,s)=>(n(),b("div",De,[(n(),l(y(Ne))),(n(),l(y(t()))),(n(),l(y(Fe),{style:{position:"fixed",bottom:"0",width:"100%"}}))]))}}),Re="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACYAAAAiCAYAAAAzrKu4AAAAAXNSR0IArs4c6QAABBlJREFUWEfNl01sFGUYx///2V1LKUnVMtMYYqI7S6v2AIlArB8BEmPC7hY02iAGA0qoFzXhgh5UWj14IOHSmIia+sGFpsbIurMXo5ZEKDGWC9gK3WmM6GFnpTaSWim772O27a792I+ZXarOYQ7vPM//+e3/neeZd4n/6cVauX5ria7LZqUXggdJjGo+vrL2cvy7WnVrBnOC4U8FeDIPQjKp161u48jATC1wNYGlQx1blcoOLgMgDjfbiaP/CZgcOaKlT3w/LJCNSwFI/LG63t+y5mIsVS1c1Y6lzUiXEjleqjDBPmPcOvCvgk0EOxtvcGoMAr0MmKLGzXoyfr4auKocSwUjxwA5VKkgwW+NceuRSnHFnnsGS7fubJVM5oIIAv90ImwRDpHSLgJzYSGN3KPb1kmvcJ7BHDOcEMGOQiFyyGBwO5O91yX0Up0j499ApH0B9BXdaGjl0MC0FzhPYI7ZsUMkm1jsiNal2/H382tpM3pQiXpvEYSm9TQn490rAib3dwXSv/9yQYDWhQVI7WnDjvfn1xwzultELdk6/umn/54m+9QVt3CuHUuHwoeUwrHlM8sNGEDypGFbe24q2LVQpz6tpsYEaKwWbDaP/oeb7dgZN3CuHEuZkeMQ6Sra1q62ci6T5LC+d9MW9vSoSnAVwVIt0Q3MyHmBaLWCzcJpPGAkrb6awRwzPCiCrSUnvAfH5n1LaQHfev1S7Fo5uLKOOaHoU6LUQFkBz2CARu2obscPVwUm2/avcn52RgHcdbPBQM4QvjbDjiVL7kSpB44Zfk0Eb1V8F6pwbL4TYs22tcsT2OxxOaMuAWhYMTAAfp//saax2JdFm6rYYioYOQHI3kpQcyPA3YAtqkWMGHdu3sDBnsyy+bh04Wqo44Gsyp4VoOIoyeVq5Bu6bRW2PG1GXlcib7r5UfOz7WXDtnrLgokIHTN6DpAtroXBSdG427ilftCZmd5GJf0CudVtPoCJVfUN6xt/GJhYmLPIFceM7BORjzyIFkIJiFuXi7jzjjGeeLEomHNf5xr8NXVZgDu8gpE4DfAMIA+VG8alO5BZP7Hxdtu6mI8pOOYEo28L1KueoTR8aCQTz+fznFC4TxSe86oD8qtm23p0Edjk+kjwupIRCOq8Cvo1X3tT8otz+byroWh7RqmzXnVy8T4Nj69NJk7NNkXuljIjn0HkiWrENI279KQVy+emQ5GdSsmsuNeLhK3TbMsd05k2I9uVyNdeRQqWk6OBQCB824+f/zTZ2nH3TEZZInJvtXoa547qTJmRdyHyQrVCc7ZTgfIrhOtKHY/c6pP4wLATB1n0z4NblRWII7nfsK2PKZ2dPmd46hMAz6xAHdeSJG6IsN94dtO+3Am3MC5yUx/d3a4+Q66reQns7haSkk/5G9XayjKlEdNBAAAAAElFTkSuQmCC",We={class:"fireTips"},je={class:"title"},Qe={style:{padding:"20px","text-align":"center"}},ze=f({__name:"InProcessingFooter",setup(o){const t=K(),e=$(!1),s=$(!1),c=$(!1),a=T(H),{isProcessingPaused:i}=a,r=$("");F(()=>{var E;const B=((E=document.querySelector(".process-view-canvas"))==null?void 0:E.scrollHeight)||275,k=window.innerHeight-46-46-B;k<260?r.value="190px":k>=260&&k<310?r.value=`${k-16}px`:r.value="310px"});const _=()=>{a.setMinimize(),t.back()},P=async()=>{s.value=!0,await a.pauseProcessing(),s.value=!1},C=async()=>{s.value=!0,a.showPressButtonModal(),s.value=!1},N=async()=>{c.value=!0,await a.cancelProcessing(),a.finishPage(),c.value=!1};return(g,I)=>{const B=ne,k=D,E=te;return n(),b("div",null,[h("div",{class:"in-processing-button-content",style:Ce({"--max-height":r.value})},[h("div",We,[v(B,{width:"19",height:"17","preview-disabled":!0,src:u(Re),style:{"align-items":"center","margin-right":"4px"}},null,8,["src"]),M(" "+p(g.$t("device.process.fire_warning_tips")),1)]),h("div",je,p(g.$t("ipad.editor.process_notice")),1),u(a).isDeviceInProcessing()?(n(),b(O,{key:0},[u(i)?(n(),l(k,{key:0,type:"primary",block:"",class:"action-button",loading:s.value,onClick:C},{default:w(()=>[M(p(g.$t("device.process.continue")),1)]),_:1},8,["loading"])):(n(),l(k,{key:1,type:"primary",plain:"",block:"",class:"action-button",loading:s.value,onClick:P},{default:w(()=>[M(p(g.$t("device.process.pause")),1)]),_:1},8,["loading"]))],64)):V("",!0),v(k,{type:"default",block:"",class:"action-button",loading:c.value,onClick:I[0]||(I[0]=m=>e.value=!0)},{default:w(()=>[M(p(g.$t("device.process.cancel_processing")),1)]),_:1},8,["loading"]),u(a).isDeviceInProcessing()?(n(),l(k,{key:1,type:"default",block:"",class:"action-button",onClick:_},{default:w(()=>[M(p(g.$t("device.process.minimize")),1)]),_:1})):V("",!0)],4),v(E,{show:e.value,"onUpdate:show":I[1]||(I[1]=m=>e.value=m),"show-cancel-button":"",width:"310px","confirm-button-text":g.$t("device.common.ok"),"cancel-button-text":g.$t("device.common.cancel"),onCancel:I[2]||(I[2]=()=>e.value=!1),onConfirm:N},{default:w(()=>[h("div",Qe,p(g.$t("device.process.confirm_cancel_task")),1)]),_:1},8,["show","confirm-button-text","cancel-button-text"])])}}});const Ye=x(ze,[["__scopeId","data-v-50eeff57"]]),Xe={class:"text-tnum in-processing-content"},Ke=f({__name:"InProcessingHeader",setup(o){const t=T(H),e=L(()=>Y(Math.ceil(t.useTime.value/1e3)));return(s,c)=>{const a=W,i=oe;return n(),b(O,null,[v(a,{title:s.$t("device.process.processing"),class:"process-bar",fixed:"",placeholder:""},null,8,["title"]),h("h3",Xe,[h("p",null,p(s.$t("mobile.process.elapsed_time"))+p("  "+u(e)),1)]),u(t).overTemperature()?(n(),l(i,{key:0,class:"process-temp-tip",mode:"closeable",wrapable:"",scrollable:!1,text:s.$t("device.process.over_temperature_tip")},null,8,["text"])):V("",!0)],64)}}});const Je=x(Ke,[["__scopeId","data-v-e270ce58"]]),Ze={class:"dialog-content"},qe=["src"],et={class:"title"},tt={class:"fireTips"},st=f({__name:"PressButtonRemind",setup(o){const t=T(H),e=me(),s=()=>{t.closePressButtonModal()},c=()=>e.getSelectDeviceInfo().processImg;return(a,i)=>{const r=D,_=te;return n(),l(_,{show:u(t).pressButtonRemindVisible.value,"message-align":"center","show-confirm-button":!1,"close-on-click-overlay":!0},{default:w(()=>[h("div",Ze,[h("img",{src:c(),width:"300"},null,8,qe),h("div",et,p(a.$t("device.process.file_done_and_start")),1),h("div",tt,"⚠️"+p(a.$t("device.process.fire_warning_tips")),1),v(r,{type:"primary",onClick:s},{default:w(()=>[M(p(a.$t("device.common.complete")),1)]),_:1})])]),_:1},8,["show"])}}});const ot=x(st,[["__scopeId","data-v-7569082c"]]),nt=f({__name:"Processing",setup(o){const t=()=>Z;return(e,s)=>(n(),b("div",null,[(n(),l(y(Je))),(n(),l(y(t()))),(n(),l(y(Ye),{style:{position:"fixed",bottom:"0",width:"100%"}})),(n(),l(y(ot)))]))}}),ct={class:"process-action"},at=f({__name:"UploadFooter",setup(o){const t=T(H),{uploadPercentage:e}=t,s=$(!0);z(e,i=>{i>0&&(s.value=!1)});let c;F(()=>{c=setTimeout(()=>{s.value=!1},6e3)}),X(()=>{clearTimeout(c)});const a=async()=>{await t.cancelUploadGCode(),t.changePage(G.PREVIEW)};return(i,r)=>{const _=D,P=ee;return n(),l(P,{direction:"vertical",fill:!0},{default:w(()=>[h("section",ct,[v(_,{type:"default",block:"",disabled:u(e)<=0||s.value,class:"action-button",onClick:a},{default:w(()=>[M(p(i.$t("device.common.cancel")),1)]),_:1},8,["disabled"])])]),_:1})}}});const it=x(at,[["__scopeId","data-v-c9df2e29"]]),rt={class:"process-view-header"},lt=f({__name:"UploadHeader",setup(o){const{t}=J(),e=T(H),{uploadPercentage:s}=e;return F(async()=>{try{await e.uploadGCode(),e.changePage(G.INPROCESSING),e.showPressButtonModal()}catch{se(t("device.process.gcode_upload_fail")),e.changePage(G.PREVIEW)}}),(c,a)=>{const i=W,r=ce;return n(),b(O,null,[v(i,{title:c.$t("mobile.device.start_processing"),class:"process-bar",fixed:"",placeholder:""},null,8,["title"]),v(r,{"show-pivot":!1,percentage:u(s)},null,8,["percentage"]),h("div",rt,[h("span",null,p(c.$t("device.process.sending_the_file")+Math.ceil(u(s)))+"% ",1)])],64)}}});const _t=x(lt,[["__scopeId","data-v-f36bab02"]]),ut=f({__name:"Upload",setup(o){const t=()=>Z;return(e,s)=>(n(),b("div",null,[(n(),l(y(_t))),(n(),l(y(t()))),(n(),l(y(it),{style:{position:"fixed",bottom:"0",width:"100%"}}))]))}}),dt=""+new URL("../assets/task-done@2x-79702d93.png",import.meta.url).href,pt={class:"processing-success-content"},vt=f({__name:"ProcessingSuccess",setup(o){const t=T(H),e=L(()=>Y(Math.ceil(t.useTime.value/1e3)));return(s,c)=>{const a=ne;return n(),b("div",pt,[v(a,{src:u(dt),height:"50%",width:"50%",class:"processing-success-content-img"},null,8,["src"]),h("span",null,p(s.$t("device.process.complete")),1),h("span",null,p(s.$t("device.process.actual_processing_time",{time:u(e)})),1)])}}});const mt=x(vt,[["__scopeId","data-v-1632380b"]]),gt={class:"processing-success-buttons"},ft=f({__name:"ProcessingSuccessFooter",setup(o){const t=T(H),e=()=>{t.finishPage()},s=()=>{t.changePage(G.PREVIEW)};return(c,a)=>{const i=D;return n(),b("div",gt,[v(i,{type:"primary",class:"margin-bottom-8",block:"",plain:"",onClick:e},{default:w(()=>[M(p(c.$t("device.process.complete")),1)]),_:1}),u(U).size!==0?(n(),l(i,{key:0,type:"primary",class:"margin-bottom-8",block:"",plain:"",onClick:s},{default:w(()=>[M(p(c.$t("device.modal.redo")),1)]),_:1})):V("",!0)])}}});const ht=x(ft,[["__scopeId","data-v-4a93eb73"]]),wt={};function yt(o,t){const e=W;return n(),l(e,{title:o.$t("device.process.processing"),class:"process-bar",fixed:"",placeholder:""},null,8,["title"])}const Pt=x(wt,[["render",yt]]),bt=f({__name:"Finish",setup(o){return(t,e)=>(n(),b(O,null,[(n(),l(y(Pt))),(n(),l(y(mt))),(n(),l(y(ht),{style:{position:"fixed",bottom:"0",width:"100%"}}))],64))}}),Lt=f({__name:"ProcessingNext",setup(o){const{t}=J(),e=K(),s=ge(),c=new fe;$e(c);const a={[G.PREVIEW]:Oe,[G.UPLOAD]:ut,[G.INPROCESSING]:nt,[G.FINISH]:bt},i=L(()=>a[s.currentPage]);z(()=>c.showCancelProcessing.value,()=>{se(t("device.process.cancel_processing"))}),z(()=>c.closePage.value,_=>{const P=e.currentRoute.value.name;_&&P==="processing"&&e.back()}),F(()=>{s.isMinimize=!1,window.MeApi.openNative.needBackgroundTask(!0),r(!0)}),X(()=>{window.MeApi.openNative.needBackgroundTask(!1)});const r=_=>{_?U.activeCanvas(U.id):U.inactiveCanvas(U.id)};return(_,P)=>(n(),l(y(u(i))))}});export{Lt as default};
