var xe=Object.defineProperty;var Me=(o,e,t)=>e in o?xe(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var I=(o,e,t)=>(Me(o,typeof e!="symbol"?e+"":e,t),t),Q=(o,e,t)=>{if(!e.has(o))throw TypeError("Cannot "+t)};var Z=(o,e,t)=>(Q(o,e,"read from private field"),t?t.call(o):e.get(o)),J=(o,e,t)=>{if(e.has(o))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(o):e.set(o,t)},ee=(o,e,t,p)=>(Q(o,e,"write to private field"),p?p.call(o,t):e.set(o,t),t);var fe=(o,e,t)=>(Q(o,e,"access private method"),t);import{bQ as be,bV as H,bW as Oe,bw as b,bu as r,bX as x,bx as we,b8 as G,by as ke,br as L,bt as $,bs as Ge,bB as S,bY as te,bZ as j,b_ as oe,b$ as se,bv as Ve,bJ as z,bK as O,bI as Fe,c0 as Be,c1 as Ue,c2 as We,c3 as Xe,bE as He,bq as ae,c4 as $e,c5 as V,c6 as P,c7 as ze,c8 as Ye,c9 as Ke,ca as qe,bM as je}from"../assets/index-83a10b2e.js";import{C as Y,s as Qe,b as Re,l as Ae,B as k,_ as le,q as K,e as Ze,m as Je,O as et}from"./xcs-canvas-5c2592d6.js";import{D as tt}from"./devicedata-18553816.js";import{k as ye,f as q,I as Le,q as Ne,u as ce,D as Ce,H as ot,b as ie,af as F,w as Te,o as st,a3 as de}from"./xcs-vue-family-70642f71.js";import{B as at,c as it}from"./params-f8cc805d.js";import{p as nt}from"./urlparam-4b6ed041.js";import{D as rt}from"./device-845a051d.js";class ct{constructor(e){I(this,"name");I(this,"type",be);I(this,"container");I(this,"roundRect");I(this,"createDisplayFn");this.name=e}createContainer(){const e=this.createDisplayFn("RECT");return e.interactive=!1,e}async init(){}createRoundRect(){return this.createDisplayFn("RECT")}initViewportDisplay(e){this.createDisplayFn=e;const t=this.createRoundRect();this.roundRect=t;const p=this.createContainer();return this.container=p,this.container.addChild(t),{display:this.container,targetContainer:"bgLayer"}}updateRoundRect({fillColor:e,fillAlpha:t,width:p,height:a,radius:_}){this.roundRect.clear().beginFill(e,t).drawRect(0,0,p,a).endFill(),this.roundRect.beginHole().drawRoundedRect(0,0,p,a,_).endHole()}destroy(){var e;(e=this.container)==null||e.destroy(!0)}}const lt=""+new URL("../assets/auto-focus-check@2x-def7818e.png",import.meta.url).href,dt=""+new URL("../assets/complete-calibration@2x-09fe1aa2.png",import.meta.url).href,ut=""+new URL("../assets/cover-4965a145.png",import.meta.url).href,pt=""+new URL("../assets/f1-extend-frame-tip@2x-8b8c84b7.png",import.meta.url).href,mt=""+new URL("../assets/f1-ready-83067df4.png",import.meta.url).href,Et=""+new URL("../assets/initial-install@2x-caad5f67.png",import.meta.url).href,gt=""+new URL("../assets/lock-screw@2x-5aa1a1c2.png",import.meta.url).href,_t=""+new URL("../assets/projection@2x-255ccc8d.png",import.meta.url).href,M={cover:ut,f1ExtendFrameTip:pt,f1GoToOriginTipImg:lt,initialInstallImg:Et,lockScrewImg:gt,projectionImg:_t,completeCalibrationImg:dt,readyImg:mt},{LASER_PLANE:ht,LASER_CYLINDER:ft,FREE_PLANE:Rt,LASER_EXTENDER:Tt}=H,{VECTOR_ENGRAVING:B,FILL_VECTOR_ENGRAVING:U,VECTOR_CUTTING:ne,BITMAP_ENGRAVING:W}=Oe,It={speed:{[ht]:[{type:B,min:1,max:4e3,defaultValue:1},{type:U,min:1,max:4e3,defaultValue:1},{type:ne,min:1,max:20,defaultValue:1},{type:W,min:1,max:4e3,defaultValue:1}],[ft]:[{type:B,roller:!0,min:1,max:25,defaultValue:1},{type:U,roller:!0,min:1,max:400,defaultValue:1},{type:W,roller:!0,min:1,max:400,defaultValue:1},{type:B,catch:!0,min:1,max:120,defaultValue:1},{type:U,catch:!0,min:1,max:400,defaultValue:1},{type:W,catch:!0,min:1,max:400,defaultValue:1}],[Rt]:[{type:B,min:1,max:4e3,defaultValue:1},{type:U,min:1,max:4e3,defaultValue:1},{type:ne,min:1,max:20,defaultValue:1},{type:W,min:1,max:4e3,defaultValue:1}],[Tt]:[{type:B,min:1,max:160,defaultValue:1},{type:U,min:1,max:160,defaultValue:1},{type:ne,min:1,max:20,defaultValue:1},{type:W,min:1,max:160,defaultValue:1}]}},St=[{code:"Qx06 0",msg:"qx06_0"},{code:"Qx10 2",msg:"qx10_2"},{code:"Qx14 1",msg:"qx14_1"},{code:"Qx14 2",msg:"qx14_2"},{code:"Qx14 3",msg:"qx14_3"},{code:"Qx14 4",msg:"qx14_4"},{code:"Qx14 5",msg:"qx14_5"},{code:"Qx14 6",msg:"qx14_6"},{code:"Qx14 7",msg:"qx14_7"},{code:"Qx16",msg:"qx16"},{code:"Wx13",msg:"wx13"},{code:"Qx21 1",msg:"qx21_1"},{code:"Qx20 1",msg:"qx20_1"},{code:"Qx20 2",msg:"qx20_2"},{code:"Qx20 3",msg:"qx20_3"},{code:"Qx20 4",msg:"qx20_4"},{code:"Qx20 5",msg:"qx20_5"}],At=`# F1 BITMAP HEAD
# motion_start
# motionConfig=\${motionConfig}
\${enableRelative ? 'G90' : ''}
\${startY ? 'G0Y' + startY : ''}
\${enableRelative ? 'G91' : ''}
\${lightModeCommand}
`,yt=`# F1 BITMAP TAIL
# motion_end
`,Lt=`
# F1 HEAD
G0 F180000
M4 S0
G1 F180000
\${isWalkBorder ? 'M114 S1': 'G0 X0 Y0'}

\${uMultipleCommand}
<% if(useUAxis) { %>
G100
<% } %>
<% if(isExpand) { %>
M110U1
M111S3
<% if(isWalkBorder) { %>
M105A0B-3
G0 U-\${startU}
G101
<% } %>
<% if(!isWalkBorder) { %>
G0 X57.5
<% } %>
<% } %>
`,Nt=`# F1 TAIL
<% if(useUAxis) { %>
G101
<% } %>
G90
G0 S0
G0 F180000
G1 F180000
M6 P1
`,Ct=`
# F1 VECTOR HEAD
# motion_start
# motionConfig=\${motionConfig}
\${lightModeCommand}
G90
`,Dt=`# F1 VECTOR TAIL
# motion_end
`,w={gCodeTail:Nt,gCodeHead:Lt,bitmapHead:At,vectorHead:Ct,bitmapTail:yt,vectorTail:Dt},vt={head(o){const e=Y(w.gCodeHead),{processMode:t,lightModeCommand:p,isWalkBorder:a,useUAxis:_,uMultiple:h=1}=o;return e({lightModeCommand:p,isWalkBorder:a,isExpand:t===b.LASER_EXTENDER,startU:o.origin.x.toFixed(),uMultipleCommand:_?`M535U${h}`:null,useUAxis:_})},tail(o){const e=Y(w.gCodeTail),{useUAxis:t}=o;return e({useUAxis:t})},vectorHead(o){const e=Y(w.vectorHead),t={color:o.color};return e({motionConfig:JSON.stringify(t),lightModeCommand:o.canvasLightSource==="red"?"G22":"G21"})},vectorTail(){return w.vectorTail},bitmapHead(o){const e=Y(w.bitmapHead),t={color:o.color};return e({...o,enableRelative:o.enableRelative,motionConfig:JSON.stringify(t),lightModeCommand:o.canvasLightSource==="red"?"G22":"G21",startY:o.start.y})},bitmapTail(){return w.bitmapTail}},Pt=[{name:"captureGlobalImage",url:"/camera/snap",timeout:6e4,port:"8329",responseType:"blob",params:{stream:"0"}},{name:"captureLocalImage",url:"/camera/snap",timeout:6e4,port:"8329",responseType:"blob",params:{stream:"1"}},{name:"deviceInfo",list:[{url:"/device/machineInfo",transformResult(o){const{deviceName:e,mac:t,ip:p,sn:a,machineType:_,machineSubType:h,laserPower:s,firmware:i}=o,n=i.package_version||i.master_h3_laserservice;return{name:e,version:n,ip:p["wlan0-ip"],snCode:a,power:s??0,mac:t,machineType:_,machineSubType:h}}},{url:"/device/workingInfo",transformResult(o){const{timeSystemWork:e,numOfflineWorking:t,numOnlineWorking:p,timeModeWorking:a}=o,h=Number((parseInt(a)/60/60).toFixed(1))||1,s=Number(t+p),i=Number((parseInt(e)/60/60).toFixed(1));return{workTime:h,workTimes:s,standByTime:i}}},{url:"/cnc/status",transformResult(o){const{des:e,mode:t,subMode:p}=o;return{currentStatus:t,des:e,subMode:p}}}],transformResult([o,e,t]){return{...o,...e,...t}}},{name:"setDeviceName",type:"post",url:"/device/machineInfo"},{name:"getConfigs",type:"post",url:"/config/get"},{name:"setConfigs",type:"post",url:"/config/set"},{name:"queryRunningStatus",url:"/device/runningStatus",transformResponse(o){var t,p;const e=JSON.parse(o);return(p=(t=e==null?void 0:e.data)==null?void 0:t.curMode)==null?void 0:p.mode}},{name:"uploadGcode",type:"post",url:"/processing/upload",timeout:0,port:"8080",params:{gcodeType:"processing",fileType:"txt"}},{name:"cancelPrint",url:"/processing/stop"},{name:"pausePrint",url:"/processing/pause"},{name:"listWifi",url:"/net/get_ap_list",transformResult(o){return o.sort((e,t)=>t.level-e.level),Array.from(new Set(o.map(e=>e.ssid)))}},{name:"configWifi",url:"/net/set_wifi",method:"POST"},{name:"ip",url:"/net/ifconfig",transformResult(o){const e=o.find(t=>t.iface==="wlan0");return e?e.ip:""}},{name:"exportLog",url:"/dev/log",timeout:0,responseType:"arraybuffer"},{name:"uploadWalkBorder",url:"/processing/upload",type:"post",timeout:6e3,params:{gcodeType:"frame",fileType:"txt",autoStart:"1",loopPrint:"1"},transformRequest(o){return o==null?void 0:o.gcode}},{name:"stopWalkBorder",url:"/processing/stop",type:"post"},{name:"focusControl",url:"/focus/control",timeout:Number.MAX_SAFE_INTEGER,type:"post"},{name:"updateFirmwareHandshake",url:"/upgrade_version",port:"8087",params:{force_upgrade:"1"}},{name:"updateFirmware",url:"/package",type:"post",port:"8087",timeout:0,params:{action:"burn"}},{name:"version",url:"/system",params:{action:"version_v2"},transformResult(o){return o.package_version}},{name:"addonStatus",list:[{url:"/peripheral/ext_purifier",transformResult(o){const{current:e,exist:t,power:p,state:a}=o;return{purifierCurrent:e,purifierExist:t,purifierPower:p,purifierState:a}}},{url:"/peripheral/gap",transformResult(o){const{state:e}=o;return{gapStatus:e==="on"}}},{url:"/peripheral/machine_lock",transformResult(o){const{state:e}=o;return{UsbKeyLockStatus:e==="on"}}}],transformResult([o,e,t]){return{...o,...e,...t}}},{name:"extenderControl",url:"/extender/control",timeout:Number.MAX_SAFE_INTEGER,type:"post"}],xt={power:{min:1,max:10,enable:!0,default:10},speed:{min:1,max:12e3,enable:!0,default:12e3},platformSpeed:{min:10,max:160,enable:!0,default:20},enableOutline:!0,enable:!0,disableInPreviewHeader:!0},Mt={[r.LASER_PLANE]:{power:10,speed:12e3,mode:x.RECT},[r.LASER_CYLINDER]:{power:10,speed:1e4,mode:x.SCAN},[r.FREE_PLANE]:{power:10,speed:12e3,mode:x.RECT},[r.LASER_EXTENDER]:{power:10,speed:12e3,mode:x.RECT,platformSpeed:20}},bt={[x.RECT]:12e3,[x.OUTLINE]:8e3,[x.SCAN]:1e4},Ot={canStopWalkBorder:!0,showTotalTime:!1,walkBorder:{default:xt,defaultWalkBorderParams:Mt,defaultSpeedByMode:bt},buildParams:{delta:.1,neg_sign:0,swap_xy:0,enableRelative:!0,accel:2e3,overScanRequired:!1},preview:{extendDirection:{[b.LASER_CYLINDER]:we.BOTTOM}}},X={...ke,auto_measure:"device.common.auto_measure",focal_length_is_empty:"device.process.focal_length_is_empty",gap_check_close:"device.process.gap_check_close_tips",go_to_close:"device.process.go_to_close"},wt={[b.LASER_PLANE]:{collisionRules:{checkSizeType:"totalSize",ignoredDirection:[],handler:()=>({type:G.text,text:X.element_out_zoom})}},[b.LASER_CYLINDER]:{collisionRules:{checkSizeType:"totalSize",ignoredDirection:["top","bottom"],handler:()=>({type:G.text,text:X.element_out_zoom})},integrityDataRules:{requireKeys:["uMultiple"],handler:()=>({type:G.text,text:X.catch_data_empty})}},[b.FREE_PLANE]:{collisionRules:{checkSizeType:"totalSize",ignoredDirection:[],handler:()=>({type:G.text,text:X.element_out_zoom})}},[b.LASER_EXTENDER]:{collisionRules:{checkSizeType:"totalSize",ignoredDirection:[],handler:()=>({type:G.text,text:X.element_out_zoom})}}},kt={id:"F1",name:"xTool F1",cover:M.cover,readyImg:M.readyImg,productID:"MF1",firmwareContentId:"xcs-f1-firmware",canUseSocket:!0,connectType:"wifi",deviceExceptions:St,protocols:{network:Pt},processingArea:{base:{width:115,height:115,angle:0},data:[{key:H.LASER_PLANE,width:115,height:115,angle:0,gridOption:{cellSize2:115}},{key:H.FREE_PLANE,width:100,height:100,angle:0,offsetX:7.5,offsetY:7.5},{key:H.LASER_CYLINDER,width:115,height:115,angle:0,gridOption:{cellSize2:115}},{key:H.LASER_EXTENDER,width:400,height:115,angle:0}]},gcodeHooks:vt,calculateTime:{accelX:1/0,accelY:1/0,thresholdAngle:175},process:Ot,supportUrls:{firmware:"https://s.xtool.com/doc/f1/firmware",faqUrl:"",laserFaq:""},checkRules:wt,sendBorderWithProcess:!0,useCheckButtonInProcess:!0,deviceMetaData:It,f1GoToOriginTipImg:M.f1GoToOriginTipImg,f1ExtendInstallCalibrationImgs:{initialInstallImg:M.initialInstallImg,lockScrewImg:M.lockScrewImg,projectionImg:M.projectionImg,completeCalibrationImg:M.completeCalibrationImg}},Ie=kt;class Gt extends tt{onProcessingLightSource({canvasId:e,displays:t,value:p}){const a=this.data.value.get(e);if(a){const _=[];if(t.forEach(h=>{const s=a.displays.get(h);s&&(Qe(s,"processingLightSource",p),s.processingType===L.VECTOR_CUTTING&&s.type!==$.BITMAP&&_.push(h))}),p==="red"&&!Re(_)){const h=this.getDeviceModeData(a.mode);if(h){const s=h.processingTypes.filter(n=>n!==L.VECTOR_CUTTING),i=Re(s)?L.VECTOR_ENGRAVING:s[0];this.onProcessingTypeChange({canvasId:e,displays:_,value:i})}}}}onLightSourceModeChange({canvasId:e,value:t}){console.log(["=> onLightSourceModeChange",{canvasId:e,value:t}]);const p=this.data.value.get(e);if(p){this.onGeneralChange({canvasId:e,value:t,id:"lightSourceMode"});const a=t==="red"?t:"blue";this.onProcessingLightSource({canvasId:e,displays:Array.from(p.displays.keys()),value:a})}}onDeviceModeChange(e,t,p){super.onDeviceModeChange(e,t,p),this.onLightSourceModeChange({canvasId:e,value:"blue"})}}const Vt={[L.VECTOR_CUTTING]:{processingLightSource:"blue",power:1,speed:16,repeat:1},[L.VECTOR_ENGRAVING]:{processingLightSource:"blue",power:1,speed:20,repeat:1},[L.FILL_VECTOR_ENGRAVING]:{processingLightSource:"blue",power:1,speed:80,repeat:1,density:100,bitmapScanMode:"zMode",bitmapEngraveMode:"normal",dotDuration:10},[L.BITMAP_ENGRAVING]:{processingLightSource:"blue",power:1,powerMinMaxRange:[1,10],speed:80,repeat:1,bitmapMode:"grayscale",dpi:500,bitmapScanMode:"zMode",bitmapEngraveMode:"dot",dotDuration:100}},De=[{value:L.VECTOR_ENGRAVING,label:"device.processing_type.line_engrave",color:16421416,fillColor:"#f9932b",isFill:!1,imageType:$.VECTOR,modes:[r.LASER_PLANE,r.LASER_CYLINDER,r.FREE_PLANE,r.SUPER_LASER_PLANE,r.LASER_EXTENDER]},{value:L.FILL_VECTOR_ENGRAVING,label:"device.processing_type.fill_engrave",color:16421416,fillColor:"#f9932b",isFill:!0,modes:[r.LASER_PLANE,r.LASER_CYLINDER,r.FREE_PLANE,r.SUPER_LASER_PLANE,r.LASER_EXTENDER],imageType:$.VECTOR},{value:L.VECTOR_CUTTING,label:"device.processing_type.line_cut",color:10036991,fillColor:"#9928ff",isFill:!1,modes:[r.LASER_PLANE,r.FREE_PLANE,r.SUPER_LASER_PLANE,r.LASER_EXTENDER],imageType:$.VECTOR},{value:L.BITMAP_ENGRAVING,label:"device.processing_type.engrave",color:16421416,fillColor:"#f9932b",isFill:!0,modes:[r.LASER_PLANE,r.LASER_CYLINDER,r.FREE_PLANE,r.SUPER_LASER_PLANE,r.LASER_EXTENDER],imageType:$.BITMAP}],Ft=ye({__name:"ProcessingDataForm",props:{ext:null,deviceInfo:null,elementValues:null,deviceValues:null,selectedTypes:null},setup(o){const e=o,t=q(()=>e.elementValues.processingType===L.VECTOR_CUTTING),p=()=>{const s=e.deviceValues.mode,i=e.selectedTypes[0];return Ae(De,{imageType:i,modes:[s]})},a=q(()=>({name:"processingLightSource",label:"device.common.laser_light_mode",widget:"radioGroup",widgetAttrs:{options:[{value:"blue",label:"device.common.blue_light"},{value:"red",label:"device.common.red_light",disabled:t.value}]}})),_=q(()=>({name:"power",label:"device.common.power",unitExtra:"(%)",widget:"slider",widgetAttrs:{showInput:!0,min:1,max:100,digits:0},visible:!(e.elementValues.bitmapEngraveMode==="dot"&&e.elementValues.bitmapMode==="grayscale"),inputWrapperStyle:{marginTop:"-4px"}})),h=q(()=>({[L.VECTOR_ENGRAVING]:["processIgnore","processingType","materialType",a.value,_.value,"speed","repeat"],[L.FILL_VECTOR_ENGRAVING]:["processIgnore","processingType","materialType",a.value,_.value,"speed","repeat","density","bitmapScanMode"],[L.VECTOR_CUTTING]:["processIgnore","processingType","materialType",a.value,_.value,"speed","repeat"],[L.BITMAP_ENGRAVING]:["processIgnore","processingType","materialType",a.value,"dotDuration",_.value,"powerRange","repeat","dpi","bitmapMode","bitmapScanMode"]}));return(s,i)=>{const n=Ge;return Ce(),Le(n,Ne({ext:o.ext,"fields-map":ce(h),"element-values":o.elementValues,"device-values":o.deviceValues,"device-info":o.deviceInfo,"selected-types":o.selectedTypes,"type-options":p},s.$attrs),null,16,["ext","fields-map","element-values","device-values","device-info","selected-types"])}}}),Bt={[r.LASER_PLANE]:{material:0,lightSourceMode:"blue",thickness:null,perimeter:null,diameter:null},[r.LASER_CYLINDER]:{material:0,lightSourceMode:"blue",thickness:null,focalLength:null,rotaryAttachmentType:"roller",perimeter:null,diameter:null},[r.FREE_PLANE]:{material:0,lightSourceMode:"blue",thickness:null,focalLength:null,perimeter:null,diameter:null},[r.LASER_EXTENDER]:{material:0,lightSourceMode:"blue",thickness:null,perimeter:null,diameter:null}},Ut=[{icon:"ext-laser-plane",label:"device.mode.laser_flat",value:r.LASER_PLANE},{icon:"ext-laser-cylinder",label:"device.mode.laser_cylindrical",value:r.LASER_CYLINDER},{icon:"ext-pass-through",label:"device.mode.open_plane",value:r.FREE_PLANE},{icon:"ext-pass-through",label:"device.mode.laser_extender",value:r.LASER_EXTENDER}],Wt=ye({__name:"ProcessingModeForm",props:{ext:null,deviceValues:null,deviceInfo:null,isInProcessing:{type:Boolean},isFrameMode:{type:Boolean},handler:{type:Function},unit:null},emits:["pushMessage","extendCalibrationModal"],setup(o,{emit:e}){const t=o,{t:p}=ot(),a="device.laser_extend.extend_install_calibration_entry",_=ie(t.ext.isInitiatedOrigin),h=ie(!1),s=ie(0),i=(l,u)=>{const{ext:m}=t,{defaultWalkBorderParams:N}=m.config.process.walkBorder;switch(l){case"mode":{const v=n(u);t.handler(l,{value:u,processingTypeList:v}),m.walkBorderParams=N[u],u===r.LASER_EXTENDER?m.appContext.showMessage({type:"info",key:a,options:{duration:0},render:{textI18nKey:a,link:{labelI18nKey:"device.common.on",closable:!0,onClose:()=>{m.appContext.destroyMessage(a,!0)},onClick:async()=>{m.appContext.destroyMessage(a,!0),e("extendCalibrationModal",!0)}}}}):m.appContext.destroyMessage(a,!0),m.deviceInfo={walkBorderParams:Object.assign(m.deviceInfo.walkBorderParams||{},{...N[u]})};break}case"initFocusBtn":{if(t.isInProcessing||t.isFrameMode){m.appContext.showMessage({contentI18nKey:"device.process.device_is_working"});return}t.ext.autoFocus(t.deviceValues.mode===r.LASER_EXTENDER?te:j);break}default:{t.handler(l,u);break}}},n=l=>{const u=l||t.deviceValues.mode;return Ae(De,m=>m.modes.includes(u))},c=Ut.map(({icon:l,label:u,value:m})=>({icon:l,label:u,value:m})),d=F(()=>t.unit),E=F(()=>({name:"thickness",label:"device.common.thickness",widget:"unitInput",widgetAttrs:{size:"small",showButton:!1,max:t.deviceValues.mode===r.LASER_EXTENDER?oe*d.value.scale:se*d.value.scale,min:0,onkeyup:l=>{let u=parseFloat(l.target._value);if(l.keyCode===13&&!isNaN(u)){if(t.isInProcessing||t.isFrameMode){e("pushMessage","info","device.process.device_is_working"),t.handler("thickness",s.value);return}const m=g(t.deviceValues.mode,u);t.ext.autoFocus(m),s.value=u}},onBlur:l=>{if(t.isInProcessing||t.isFrameMode){e("pushMessage","info","device.process.device_is_working"),t.handler("thickness",s.value);return}let u=parseFloat(l.target._value);if(isNaN(u)){t.handler("thickness",s.value);return}const m=g(t.deviceValues.mode,u);t.ext.autoFocus(m),s.value=u}}})),g=(l,u)=>{const m=d.value.scale,N=l===r.LASER_EXTENDER,v=N?oe*m:se*m,y=N?te:j;return u<0&&(u=0),u>v&&(u=v),y+u/m},R=F(()=>({name:"initAutoFocus",label:"device.common.thickness",widget:"text",value:p("device.auto_focus.init_before_auto_focus"),inputWrapperStyle:{display:"block"},widgetAttrs:{style:{display:"inline-block","margin-right":"4px"}},suffix:{name:"initFocusBtn",label:"device.auto_focus.init",widget:"button",widgetAttrs:{disabled:h.value,text:!0,color:"#00ad21"}}})),T=F(()=>_.value?E.value:R.value),A=F(()=>({[r.LASER_PLANE]:["mode","material",T.value],[r.LASER_CYLINDER]:["mode","material","rotaryAttachmentType","catchMode"],[r.FREE_PLANE]:["mode","material"],[r.LASER_EXTENDER]:["mode","material",T.value]})),f=({key:l,value:u})=>{if(l==="thickness"){const m=[r.LASER_PLANE,r.LASER_EXTENDER],{mode:N}=t.deviceValues;if(k(m,N)){const v=N===r.LASER_EXTENDER?te:j,y=N===r.LASER_EXTENDER?oe:se;let C=u-v;C=C<0?0:C>y?y:C,t.handler(l,C),s.value=C}}},D=({isInitiatingOrigin:l,isInitiatedOrigin:u})=>{_.value=u,h.value=l};return Te(()=>t.ext,()=>{t.ext.on(S.UPDATE_INIT_ORIGIN_STATUS,l=>{D(l)}),t.ext.on(S.UPDATE_PROCESSING_MODE_DATA,l=>f(l))},{immediate:!0}),Te(()=>t.deviceValues.mode,l=>{l===r.LASER_EXTENDER&&t.ext.appContext.showMessage({type:"info",key:a,options:{duration:0},render:{textI18nKey:a,link:{labelI18nKey:"device.common.on",closable:!0,onClose:()=>{t.ext.appContext.destroyMessage(a,!0)},onClick:async()=>{t.ext.appContext.destroyMessage(a,!0),e("extendCalibrationModal",!0)}}}})}),st(()=>{t.ext.off(S.UPDATE_PROCESSING_MODE_DATA,l=>f(l)),t.ext.off(S.UPDATE_INIT_ORIGIN_STATUS,l=>{D(l)})}),(l,u)=>{const m=Ve;return Ce(),Le(m,Ne({ext:o.ext,"device-values":o.deviceValues,"mode-options":ce(c),"device-info":o.deviceInfo,"fields-map":ce(A),handler:i,"process-types":n},l.$attrs),null,16,["ext","device-values","mode-options","device-info","fields-map"])}}}),Xt=de({loader:()=>le(()=>import("./devicesettings-8c0c941d.js"),["./devicesettings-8c0c941d.js","../assets/index-83a10b2e.js","./index-55948043.js","./xcs-vue-family-70642f71.js","./xcs-canvas-5c2592d6.js","./setting.vue_vue_type_style_index_0_lang-315c55c2.js","./setting.vue_vue_type_script_setup_true_lang-0ee96bfb.js","./modal-c96d5b67.js","./button-00b27872.js","./light-87cce264.js","./space-5433d955.js","./use-style-1280d407.js","./loading-b06a4834.js","./scrollbar-5a89bf25.js","./fade-in.cssr-8e3c8f09.js","./image-bad03660.js","./spin-afa417d1.js","./text-3b674000.js","./light-28752129.js","./checkbox-9495194d.js","./inputnumber-fff11604.js","./headers-069f588a.js"],import.meta.url)}),Ht=de({loader:()=>le(()=>import("./walkbordersettings-caa7468b.js"),["./walkbordersettings-caa7468b.js","../assets/index-83a10b2e.js","./index-55948043.js","./xcs-vue-family-70642f71.js","./xcs-canvas-5c2592d6.js"],import.meta.url)}),$t=de({loader:()=>le(()=>import("./walkbordertipmodal-d8353689.js"),["./walkbordertipmodal-d8353689.js","../assets/index-83a10b2e.js","./index-55948043.js","./xcs-vue-family-70642f71.js","./xcs-canvas-5c2592d6.js","./setting.vue_vue_type_style_index_0_lang-315c55c2.js","./modal-c96d5b67.js","./button-00b27872.js","./light-87cce264.js","./space-5433d955.js","./use-style-1280d407.js","./loading-b06a4834.js","./scrollbar-5a89bf25.js","./fade-in.cssr-8e3c8f09.js","./image-bad03660.js","./spin-afa417d1.js","./checkbox-9495194d.js","./devicedata-18553816.js","./params-f8cc805d.js","./urlparam-4b6ed041.js","./device-845a051d.js"],import.meta.url)}),zt={DeviceSetting:Xt,WalkBorderSettings:Ht,WalkBorderTipModal:$t,ProcessingModeForm:Wt,ProcessingDataForm:Ft},{LASER_CYLINDER:Yt,LASER_PLANE:Kt,FREE_PLANE:qt,LASER_EXTENDER:jt}=b;class Qt extends at{parse(){var _;const{offsetX:e,startX:t=0}=this.processingArea||{},p=this.config.processingArea.base.height,a=super.parse();switch(this.deviceData.mode){case Kt:case qt:return a.id=0,a.funcName=z.plane,a.keys=[O.x,O.y],a;case Yt:{a.id=4,a.swap_xy=0,a.start.x=t+Math.abs(e||0),a.start.y=p/2;const{rotaryAttachmentType:h}=(_=this.deviceData)==null?void 0:_.data.LASER_CYLINDER;return a.rotateMultiple=h===Fe.ROLLER?-1:1,a.funcName=z.cylinder,a.funcArgs=[a.start.y,a.start.x,a.rotateMultiple],a.useUAxis=!0,a.uMultiple=Math.abs(it(this.deviceData)),a.keys=[O.x,O.u],a}case jt:{a.id=6,a.isVertical=!0;let h=z.expand;return this.isWalkBorder&&(h=z.plane,a.offset.x=57.5),a.funcName=h,a.useUAxis=!0,a.uMultiple=1,a.rotateMultiple=-1,a.keys=[O.u,O.y],a}default:return a}}}const re="F1-canvas-plugin",Zt=["AXIS_HOME_STARTED","AXIS_HOME_FINISHED"],Jt=!0,Se=.001;function eo(o){var e,t,ve,a;return a=class extends o{constructor(...s){super(Ie,...s);J(this,t);I(this,"processingTypes",Be);I(this,"processingModes",Ue.filter(s=>!{}.VITE_PAD||s.value!==r.LASER_EXTENDER));J(this,e,void 0);I(this,"walkBorderTipVisible",!1);I(this,"walkBorderGcode","");I(this,"zCoord",null);I(this,"isInitiatedOrigin",!1);I(this,"isInitiatingOrigin",!1);I(this,"printType","normal");I(this,"isProcessV2",!0);I(this,"isWorkPrepare",!1);I(this,"deviceDataValues",Bt);I(this,"elementDataValues",Vt);this.deviceData=new Gt(We,Xe,()=>this.getProcessingModes,this.processingTypes,this.config.processingArea)}get getProcessingModes(){let s=!1;const n=this.deviceData.data.value.get(this.canvasId);if(n){const{mode:c}=n;n.data[c]&&(s=n.data[c].lightSourceMode==="red")}return this.processingModes.map(c=>({...c,processingTypes:K(c.processingTypes)?c.processingTypes(s):c.processingTypes}))}get ui(){return zt}get projectData(){const{power:s}=this.deviceInfo??{};return Ze({id:Ie.productID,power:s,data:this.deviceData.data.value,materialList:[]})}get walkBorderParams(){return this._walkBorderParams}set walkBorderParams(s){this._walkBorderParams=s}initProcessParams(s){this.processParams=new Qt(s)}doUpdateFirmware(){throw new Error("Method not implemented.")}async uploadGCode(s){const{onProgress:i,isFullPath:n=!1}=s||{},{platformSpeed:c=20}=this._walkBorderParams;if(this.printInfo){const{processMode:d}=this.printInfo.params,E={loopPrint:d===r.LASER_CYLINDER?"0":"1",gcodeType:d===r.LASER_EXTENDER?"frameExt":"frame",operate:"upload"};d===r.LASER_EXTENDER&&(E.uMoveSpeed=c*60),await this.apis.uploadWalkBorder({data:{gcode:this.walkBorderGcode},params:E,onUploadProgress:({loaded:g,total:R})=>{const T=Number((g/R).toFixed(2));console.log({percent:T})}})}if(this.uploadGcodeHelper){const d=await this.builder.gcode(),{baseUrl:E,url:g,params:R={}}=await this.apis.uploadGcode({method:"info"}),T=`${E}${g}${nt(R)}`;try{return(await super.uploadByBuilder({url:T,path:d,options:{isFullPath:n,onProgress:f=>{K(i)&&i(f)},onCancel:f=>{ee(this,e,f)}}})).code===0?Promise.resolve(!0):Promise.reject(!1)}catch(A){return console.log("uploadGcode by builder error",A),Promise.reject(!1)}}else{const d=await this.builder.gcode(),{signal:E,cancel:g}=He();return ee(this,e,g),this.apis.uploadGcode({data:d,signal:E,onUploadProgress:R=>{const T=R.loaded/R.total;K(i)&&i(T)}})}}startProcessing(){return this.uploadGCode()}async focusControl(s){var i;(i=this.apis)!=null&&i.focusControl&&await this.apis.focusControl(s)}cancelUploadGCode(){var s,i;K(Z(this,e))&&Z(this,e).call(this),window.MeApi&&((i=(s=window.MeApi)==null?void 0:s.fileHelper)!=null&&i.cancelUploadGcode)&&window.MeApi.fileHelper.cancelUploadGcode()}handleDeviceFormValueChanged(s,i){var E,g;const n=(E=this.dataSource)==null?void 0:E.canvasManager.canvas;if(n)if(i.mode===r.LASER_PLANE){let R=n.getPluginByName(re);R||(R=new ct(re),n.registerPlugin(R));const{current:T}=this.getCurrentArea(""),{width:A,height:f}=T,{TIPS_TYPE:{fillColor:D,fillAlpha:l}}=rt;R.updateRoundRect({fillColor:D,fillAlpha:l,width:A,height:f,radius:20})}else n.unRegisterPluginByName(re);const{mode:c}=i,{mode:d}=s;if(c===r.LASER_CYLINDER&&d!==r.LASER_CYLINDER){const{defaultWalkBorderParams:R}=this.config.process.walkBorder;this.deviceInfo={...this.deviceInfo,walkBorderParams:Object.assign(((g=this.deviceInfo)==null?void 0:g.walkBorderParams)||{},{...R[c]})}}}pauseProcessing(){return this.apis.pausePrint()}cancelProcessing(){return this.apis.cancelPrint()}async startWalkBorder(s){const{platformSpeed:i=20}=this._walkBorderParams,{processMode:n}=this.printInfo.params,c={loopPrint:n===r.LASER_CYLINDER?"0":"1",gcodeType:n===r.LASER_EXTENDER?"frameExt":"frame"};n===r.LASER_EXTENDER&&(c.uMoveSpeed=i*60),await this.apis.uploadWalkBorder({data:{gcode:s},params:c,onUploadProgress:({loaded:d,total:E})=>{const g=Number((d/E).toFixed(2));console.log({percent:g})}}),this.printInfo.params.processMode===r.LASER_EXTENDER?this.emit(S.UPDATE_WALK_BORDER_TIP_MODAL_VISIBLE,!0):this.emit(S.UPDATE_WALK_BORDER_TIP_MODAL_VISIBLE,!1)}stopWalkBorder(){return this.apis.stopWalkBorder()}updateWalkBorderGcode(s){this.walkBorderGcode=s}updateOriginInitStatus(s,i){this.isInitiatedOrigin=s,this.isInitiatingOrigin=i}async onConnected(){const s=await this.apis.addonStatus(),i=await this.checkIsHomed(),n=await this.getZCoord();this.addonStatus={...this.addonStatus,...s},this.isInitiatedOrigin=i;const{power:c,speed:d}=this.config.process.walkBorder.default;this.walkBorderParams={speed:d.default,power:c.default,mode:x.RECT},this.info.currentStatus===ae.IDLE&&this.appContext.resetProcessingState(),this.emit(S.UPDATE_INIT_ORIGIN_STATUS,{isInitiatingOrigin:!1,isInitiatedOrigin:this.isInitiatedOrigin}),this.emit(S.UPDATE_PROCESSING_MODE_DATA,{key:"thickness",value:n})}exportLog(){return super.exportLog("xcs_f1_log.gz")}moduleMonitor(s,i,n){switch(s){case"GAP":this.addonStatus={...this.addonStatus,gapStatus:i==="OPEN"};break;case"MACHINE_LOCK":this.addonStatus={...this.addonStatus,UsbKeyLockStatus:i==="CLOSE"};break;case"WIFI":this.emit(S.UPDATE_WIFI_CONFIG_CONNECTED,i==="CONNNECT");break;case"LASER_HEAD":const{z:c}=n;Je(c)&&this.emit(S.UPDATE_PROCESSING_MODE_DATA,{key:"thickness",value:n.z});break}}infoMonitor(s,i){switch(s){case $e:this.addonStatus={...this.addonStatus,purifierExist:i==="CONNNECT"};break}}deviceCmdParsing(s){try{const i=JSON.parse(s),{info:n,level:c,module:d,type:E}=i;if(console.log(" socket 信息",c,d,E,n),this.infoMonitor(n,E),this.moduleMonitor(d,E,n),c==="warnning"){const g=et(ze,{code:d});if(g){this.emit(Ye.Error,g),this.emit(ae.CANCEL_PROCESS);return}}d==="STATUS_CONTROLLER"&&fe(this,t,ve).call(this,i)}catch(i){console.error(`F1 socket 数据返回异常${i}`)}}async initDeviceInfo(){var pe,me,Ee,ge,_e,he;const s=await this.apis.deviceInfo({},!1),i=await this.apis.getConfigs({data:{alias:"config",type:"user",kv:["workingMode","homeAfterPowerOn","purifierTimeout","flameAlarm","gapCheck","motionOpenOnDelayTime","motionCornerDelayTime","motionJumpDelayTime"]}}),{motionOpenOnDelayTime:n="",motionCornerDelayTime:c="",motionJumpDelayTime:d=""}=i,E=n.match(/K\d*[0-9]/)||[],g=n.match(/T\d*[0-9]/)||[],R=c.match(/C\d*[0-9]/)||[],T=n.match(/P\d*[0-9]/)||[],A=d.match(/P\d*[0-9]/)||[],f=d.match(/D\d*[0-9]/)||[],D=Number(((pe=E[0])==null?void 0:pe.slice(1))||0),l=Number(((me=g[0])==null?void 0:me.slice(1))||0),u=Number(((Ee=R[0])==null?void 0:Ee.slice(1))||0),m=Number(((ge=T[0])==null?void 0:ge.slice(1))||0),N=Number(((_e=A[0])==null?void 0:_e.slice(1))||0),v=Number(((he=f[0])==null?void 0:he.slice(1))||0);let{currentStatus:y}=s;const{des:C,subMode:Pe}=s;C==="frame"||C==="frameExt"?y=y==="Work"?"FRAME_WORKING":y:y==="Work"?(y=P[Pe],this.emit(S.UPDATE_DEVICE_INFO,{currentStatus:y})):(y="IDLE",this.emit(S.UPDATE_DEVICE_INFO,{currentStatus:P[y]}));const ue={...s,...i,openLightDelay:D,cornerDelay:u,closeLightDelay:l,closeLightLocalDelay:m,jumpLocalDelay:N,jumpLengthDelay:v,currentStatus:y};return this.deviceInfo=ue||{},this.addonStatus={...this.addonStatus,gapCheck:i.gapCheck},ue}updateWalkBorderTipShow(s,i){localStorage.setItem("WALK_BORDER_TIP_MODAL_NEVER_REMAIN",i?"1":"0"),this.emit(S.UPDATE_WALK_BORDER_TIP_MODAL_VISIBLE,!1)}async generalBuildData(s,i){const{x:n,y:c,height:d,width:E}=this.printInfo.totalSize,{processMode:g}=this.printInfo.params;let T=(({x:A,y:f,width:D,height:l})=>{const u=A+D,m=f+l;return`M${A}, ${f}L${u}, ${f}L${u}, ${m}L${A}, ${m}Z`})(this.printInfo.totalSize);if(g===r.LASER_CYLINDER){const A=document.createElement("canvas");A.width=120,A.height=120;const f=A.getContext("2d");f&&(f.fillStyle="rgba(178, 249, 178, 0.8)",f.rect(n,c,E,d),f.fill(),T=f.getImageData(n,c,E,d));const D=(v,y)=>{const C=v*y/10;return C%1>.1?Math.ceil(C):Math.floor(C)},l=5,u=new Ke,m=D(d,l),N=D(E,l);return T=await u.resize({id:"",bitmapMode:qe.Grayscale,imgData:T,oWidth:E,oHeight:d,destWidth:N,destHeight:m}),{data:{source:T,bitmapMode:"grayscale",density:l||10,destHeight:m,destWidth:N,elementProcessType:"FILL_VECTOR_ENGRAVING",height:d,isFill:!0,isOneWayScan:!1,power:s,repeat:1,speed:i,width:E,x:n<Se&&n>0?0:n,y:c<Se&&c>0?0:c},params:{...this.printInfo.params,isWalkBorder:!0,isVector:!1}}}return{data:{source:T,power:s,speed:i,repeat:1},params:{...this.printInfo.params,isWalkBorder:!0,isVector:!0}}}async getZCoord(){return(await this.apis.focusControl({data:{action:"coord"}})).value||0}async checkIsHomed(){return!!(await this.apis.focusControl({data:{action:"has_homed"}})).state}goToZCoord(){this.emit(S.UPDATE_AUTO_FOCUS_REMAIN_MODAL_VISIBLE,!1),this.apis.focusControl({data:{action:"goTo",autoHome:1,z:this.zCoord,stopFirst:1,F:300}})}async autoFocus(s){const i=await this.checkIsHomed();if(this.zCoord=s,!i){this.emit(S.UPDATE_AUTO_FOCUS_REMAIN_MODAL_VISIBLE,!0);return}this.goToZCoord()}mapPower(s){const{power:i}=s;return{...s,power:i*.2+4}}buildProcessGcode(...s){var c;if(!this.printInfo)return Promise.resolve();const i=this.printInfo.printData;let n=!1;return i.length&&i.forEach(d=>{const{groupKey:E,redCanvasList:g}=d.params;d.list.length&&E===je.BITMAP_ENGRAVING&&(g!=null&&g.length)&&(n=!0)}),n&&((c=this.apis)==null||c.focusControl({data:{action:"light_source",switch:"red",power:0}})),super.buildProcessGcode(s)}dispose(){this.deviceData.dispose(),super.dispose()}},e=new WeakMap,t=new WeakSet,ve=function(s){const{info:i,type:n}=s;if(k(Zt,n)){const c=n===P.AXIS_HOME_STARTED,d=n===P.AXIS_HOME_FINISHED;c&&this.updateOriginInitStatus(!1,!0),d&&this.updateOriginInitStatus(!0,!1),this.emit(S.UPDATE_INIT_ORIGIN_STATUS,{isInitiatingOrigin:c,isInitiatedOrigin:d}),this.emit(S.UPDATE_PROCESSING_MODE_DATA,{key:"thickness",value:j})}else if(n!==ae.MODE_CHANGE){let c="";k(V,n)&&(k(i,"framing")&&k([V.WORK_STARTED,V.WORK_FINISHED,V.WORK_STOPED],n)&&!this.isWorkPrepare?c=n===V.WORK_STARTED?P.FRAME_WORKING:P.IDLE:k(i,"working")&&(c=P[n],this.isWorkPrepare=c===P.WORK_PREPARED)),c&&(this.deviceInfo={...this.deviceInfo,currentStatus:c},this.emit(S.UPDATE_DEVICE_INFO,{currentStatus:c}))}},a}const uo=Object.freeze(Object.defineProperty({__proto__:null,DeviceExt:eo,v2:Jt},Symbol.toStringTag,{value:"Module"}));export{pt as e,uo as i};
