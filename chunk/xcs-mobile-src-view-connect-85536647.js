import{r as U,B as q,a6 as P,_ as T,I as R,u as L,j as z,aU as O,aV as j,b as F}from"../assets/index-83a10b2e.js";import{N as H}from"./index-36e5bf24.js";import{P as K}from"./index-67d54223.js";import{u as G,_ as J}from"./connectconfirm.vue_vue_type_script_setup_true_lang-a878591c.js";import{k as w,D as d,E as f,j as o,J as h,y as I,K as u,I as $,M as S,G as s,s as Q,v as X,b as D,H as A,f as V,e as Y,F as k,L as Z,q as ee,u as _,c as ne,o as te,a5 as oe,a4 as ce}from"./xcs-vue-family-70642f71.js";import{T as se}from"./index-ef61d1b8.js";import{i as ie}from"./xcs-canvas-5c2592d6.js";import{I as W}from"./index-e902da34.js";import"./index-55948043.js";const ae={class:"button-wrap"},re=w({__name:"BottomButton",props:{isShowAdd:{type:Boolean},loading:{type:Boolean}},emits:["refresh"],setup(i,{emit:e}){const t=()=>{e("refresh")},n=()=>{U.push("/new-device")},p=()=>{window.MeApi.app.openBrowser("https://s.xtool.com/doc/device/not-found-the-device")};return(a,m)=>{const r=q,g=P;return d(),f("div",ae,[o(g,{direction:"vertical",fill:""},{default:h(()=>[o(r,{loading:i.loading,class:"btn",type:"primary",size:"small",onClick:t},{default:h(()=>[I(u(a.$t("component.button.refresh")),1)]),_:1},8,["loading"]),i.isShowAdd?(d(),$(r,{key:0,class:"btn",plain:"",size:"small",type:"primary",onClick:n},{default:h(()=>[I(u(a.$t("mobile.connect.add_new_device")),1)]),_:1})):S("",!0),s("a",{target:"_blank",onClick:p},u(a.$t("component.link.device_not_found")),1)]),_:1})])}}});const E=T(re,[["__scopeId","data-v-9a10a570"]]),le={class:"device-wrap"},_e={class:"device-info"},de={class:"device-name"},ue={class:"device-ip"},pe=w({__name:"DeviceItem",props:{product:null,name:null,id:null,ip:null,version:null,isConnected:{type:Boolean}},setup(i){return(e,t)=>{const n=se,p=R;return d(),f("div",le,[o(n,{class:"device",type:"primary"},{default:h(()=>[I(u(i.product),1)]),_:1}),s("div",_e,[s("div",de,u(i.name||i.product),1),s("div",ue,u(i.ip),1)]),Q(o(p,{class:"device-status",name:"success"},null,512),[[X,i.isConnected]])])}}}),me={class:"connect-tip"},fe={class:"device-wrap-container"},ve=w({__name:"ConnectDevices",setup(i){const e=L(),t=D(!1),{t:n}=A(),{showConnectToast:p,successToastAction:a,failToastAction:m,closeConnectToast:r}=G(),g=V(()=>{const l=e.info;return e.connected?l==null?void 0:l.ip:""}),x=Y("$sensors"),y=()=>{const l=window.dataLayer[0].deviceInfo.snCode;x.loginWithKey("identity_SN",l)},C=async l=>{if(t.value||ie(l))return;if(!e.supportDevices.includes(l.product)){z(n("mobile.toast.device_not_supported"));return}let v=0;try{t.value=!0,p();const c=e.connectConfirmVisible;e.connectConfirmVisible=!1,v=setTimeout(()=>{throw r(),new Error("connect fail")},8e3),await e[c?"loadConnectedExt":"beforeLoadExt"](l),clearTimeout(v),e.connectConfirmVisible?r():a()}catch{m()}finally{t.value=!1,r(),clearTimeout(v);const c=window.dataLayer,b=D(""),N=c.findLast(M=>Object.keys(M).includes("deviceInfo")).deviceInfo;window.MeApi&&(b.value=window.MeApi.app.getAppVersion()),y(),console.log(" => deviceContent",c),O({extId:N.extId,xcs_version:b.value,firm_version:c[0].version,is_success:c[1].content.result==="success",connect_type:N.connectType})}},B=()=>{e.findDeviceByWifi()};return(l,v)=>(d(),f(k,null,[s("div",me,u(l.$t("mobile.connect.connect_tip")),1),s("section",fe,[(d(!0),f(k,null,Z(_(e).wifiDevices,c=>(d(),$(pe,ee({key:c.id,"is-connected":_(g)===c.ip&&_(e).ext},c,{onClick:b=>C(c)}),null,16,["is-connected","onClick"]))),128))]),o(E,{loading:_(e).wifiDevicesLoading,"is-show-add":!1,onRefresh:B},null,8,["loading"]),o(_(J),{confirm:()=>C(_(e).connectDeviceData)},null,8,["confirm"])],64))}});const he=""+new URL("../assets/pic-connect-search-empty-0cb82b83.png",import.meta.url).href,we={class:"connect-wrap"},ye={class:"connect-tip"},ge=w({__name:"ConnectEmpty",setup(i){const e=L(),t=()=>{e.findDeviceByWifi()};return(n,p)=>{const a=W;return d(),f(k,null,[s("div",we,[o(a,{class:"connect-img",fit:"contain",src:_(he)},null,8,["src"]),s("div",ye,[s("ul",null,[s("li",null,u(n.$t("mobile.connect.connect_device_step_1")),1),s("li",null,u(n.$t("mobile.connect.connect_device_step_2")),1),s("li",null,u(n.$t("mobile.connect.connect_device_step_3")),1)])])]),o(E,{"is-show-add":!0,onRefresh:t})],64)}}});const Ce=T(ge,[["__scopeId","data-v-6390d8ac"]]),be=""+new URL("../assets/pic-connect-search-47da9048.png",import.meta.url).href,$e={class:"connect-wrap"},ke={class:"connect-tip"},Be={class:"connect-searching"},Se=w({__name:"ConnectSearch",setup(i){return(e,t)=>{const n=W;return d(),f("div",$e,[s("div",ke,u(e.$t("mobile.connect.make_sure_is_same_wifi")),1),o(n,{class:"connect-img",fit:"contain",src:_(be)},null,8,["src"]),s("div",Be,u(e.$t("mobile.connect.find_device_in_the_same_wifi")),1),o(E,{loading:!1,"is-show-add":!1})])}}});const De=T(Se,[["__scopeId","data-v-d2a5d484"]]),xe=w({__name:"ConnectStatus",setup(i){const e=L(),{t}=A(),n=V(()=>e.wifiDevices.length>0?1:e.wifiDevicesLoading?0:2);ne(()=>{e.findDeviceByWifi(),p()}),te(()=>{j.stopWifiList(),e.clearConnectConfirmState()});const p=async()=>{var a,m;if(window.MeApi)try{const r=await((a=window.MeApi.wifi)==null?void 0:a.isWifiOpen());console.log("wifi open:"+r),r||(await F({title:t("mobile.connect.not_open_wifi"),message:t("mobile.connect.not_open_wifi_tip"),confirmButtonText:t("mobile.common.go_to_setting"),cancelButtonText:t("mobile.common.not_yet")}),(m=window.MeApi.wifi)==null||m.openWifiPage())}catch(r){console.log(r)}};return(a,m)=>(d(),f(k,null,[_(n)===0?(d(),$(De,{key:0})):S("",!0),_(n)===1?(d(),$(ve,{key:1})):S("",!0),_(n)===2?(d(),$(Ce,{key:2})):S("",!0)],64))}}),We=w({__name:"Connect",setup(i){const{t:e}=A(),t=ce(),n=oe(),p=()=>n.back(),a=()=>n.push({path:"/new-device",query:t.query}),m=D(!1),r=D(null),g=V(()=>[{id:1,text:e("mobile.connect.ip_connect")}]),x=y=>{console.dir(y.text),y.id===1&&n.push({path:"/ip-connect",query:t.query})};return(y,C)=>{const B=R,l=K,v=P,c=H;return d(),f(k,null,[o(c,{"left-arrow":"",title:y.$t("component.button.select_device"),onClickLeft:p},{right:h(()=>[o(v,{size:18},{default:h(()=>[o(B,{name:"add-o",size:"24",onClick:a}),o(l,{show:m.value,"onUpdate:show":C[0]||(C[0]=b=>m.value=b),actions:_(g),placement:"bottom-end",onSelect:x},{reference:h(()=>[o(B,{name:"ellipsis",size:"24"})]),_:1},8,["show","actions"])]),_:1})]),_:1},8,["title"]),o(_(xe),{ref_key:"connectPage",ref:r},null,512)],64)}}});export{We as default};
