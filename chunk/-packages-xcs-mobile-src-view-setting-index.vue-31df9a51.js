import{t as xe,J as ne,w as Ze,R as Qe,x as he,av as $e,T as et,aw as tt,v as ot,ap as at,aq as nt,ar as st,ax as lt,O as ct,U as rt,ao as Le,K as it,ay as Oe,az as ut,d as Ce,a5 as ve,I as ke,y as Pe,G as De,aA as Ae,N as Ee,F as Ne,as as dt,aB as vt,u as Ie,s as we,j as ye,aC as pt,aD as Ve,ag as mt,Q as ft,a as Re,B as je,a6 as Me,_ as se,e as Te,M as W,h as _t,P as gt,n as ht,c as wt,b as Fe,r as be,f as yt,aE as bt,aF as St,Y as xt,al as Se,ah as re,i as Ct,A as kt,aG as Pt,aH as It,m as Mt,aI as Tt,aJ as Ot,ak as Et,aK as $t,aL as Lt}from"../assets/index-83a10b2e.js";import{D as Dt}from"./index-efc3e601.js";import{d as At,b as Nt,r as Vt,a7 as Rt}from"./xcs-canvas-5c2592d6.js";import{k as U,b as C,f as L,j as i,r as jt,t as Ft,s as zt,v as Bt,q as ze,H as le,w as Y,D as I,I as N,J as M,G as F,u as t,E as q,F as pe,L as Ut,K,y as Be,c as Ue,Z as He,af as ie,n as Ht,l as Wt,o as qt,A as Kt,i as Gt,a5 as Jt,a4 as Xt,a6 as Yt,ac as Zt,ad as Qt}from"./xcs-vue-family-70642f71.js";import{L as eo}from"./index-606f09ea.js";import{I as to}from"./index-e902da34.js";import{E as oo}from"./index-6a076302.js";import{N as We}from"./index-36e5bf24.js";import{u as ao}from"./datasource-5dbe607a.js";import{P as no}from"./index-67d54223.js";import{u as so}from"./systemback-e5f1562f.js";import"./index-55948043.js";import"./index-ac8ea00e.js";import"./constant-2a798a0e.js";const[qe,ue]=xe("dropdown-menu"),lo={overlay:ne,zIndex:Ze,duration:Qe(.2),direction:he("down"),activeColor:String,closeOnClickOutside:ne,closeOnClickOverlay:ne},Ke=Symbol(qe);var co=U({name:qe,props:lo,setup(d,{slots:h}){const a=$e(),O=C(),e=C(),n=C(0),{children:P,linkChildren:b}=et(Ke),k=tt(O),_=L(()=>P.some(f=>f.state.showWrapper)),w=L(()=>{if(_.value&&ot(d.zIndex))return{zIndex:+d.zIndex+1}}),T=()=>{d.closeOnClickOutside&&P.forEach(f=>{f.toggle(!1)})},s=()=>{if(e.value){const f=st(e);d.direction==="down"?n.value=f.bottom:n.value=lt.value-f.top}},l=()=>{_.value&&s()},g=f=>{P.forEach((c,v)=>{v===f?c.toggle():c.state.showPopup&&c.toggle(!1,{immediate:!0})})},r=(f,c)=>{const{showPopup:v}=f.state,{disabled:y,titleClass:S}=f;return i("div",{id:`${a}-${c}`,role:"button",tabindex:y?void 0:0,class:[ue("item",{disabled:y}),{[ct]:!y}],onClick:()=>{y||g(c)}},[i("span",{class:[ue("title",{down:v===(d.direction==="down"),active:v}),S],style:{color:v?d.activeColor:""}},[i("div",{class:"van-ellipsis"},[f.renderTitle()])])])};return b({id:a,props:d,offset:n,updateOffset:s}),at(O,T),nt("scroll",l,{target:k,passive:!0}),()=>{var f;return i("div",{ref:O,class:ue()},[i("div",{ref:e,style:w.value,class:ue("bar",{opened:_.value})},[P.map(r)]),(f=h.default)==null?void 0:f.call(h)])}}});const[ro,de]=xe("dropdown-item"),io={title:String,options:it(),disabled:Boolean,teleport:[String,Object],lazyRender:ne,modelValue:Oe,titleClass:Oe};var uo=U({name:ro,inheritAttrs:!1,props:io,emits:["open","opened","close","closed","change","update:modelValue"],setup(d,{emit:h,slots:a,attrs:O}){const e=jt({showPopup:!1,transition:!0,showWrapper:!1}),{parent:n,index:P}=rt(Ke);if(!n)return;const b=c=>()=>h(c),k=b("open"),_=b("close"),w=b("opened"),T=()=>{e.showWrapper=!1,h("closed")},s=c=>{d.teleport&&c.stopPropagation()},l=(c=!e.showPopup,v={})=>{c!==e.showPopup&&(e.showPopup=c,e.transition=!v.immediate,c&&(n.updateOffset(),e.showWrapper=!0))},g=()=>{if(a.title)return a.title();if(d.title)return d.title;const c=d.options.find(v=>v.value===d.modelValue);return c?c.text:""},r=c=>{const{activeColor:v}=n.props,y=c.value===d.modelValue,S=()=>{e.showPopup=!1,c.value!==d.modelValue&&(h("update:modelValue",c.value),h("change",c.value))},o=()=>{if(y)return i(ke,{class:de("icon"),color:v,name:"success"},null)};return i(ve,{role:"menuitem",key:c.value,icon:c.icon,title:c.text,class:de("option",{active:y}),style:{color:y?v:""},tabindex:y?0:-1,clickable:!0,onClick:S},{value:o})},f=()=>{const{offset:c}=n,{zIndex:v,overlay:y,duration:S,direction:o,closeOnClickOverlay:$}=n.props,D=ut(v);return o==="down"?D.top=`${c.value}px`:D.bottom=`${c.value}px`,zt(i("div",ze({style:D,class:de([o]),onClick:s},O),[i(Ce,{show:e.showPopup,"onUpdate:show":E=>e.showPopup=E,role:"menu",class:de("content"),overlay:y,position:o==="down"?"top":"bottom",duration:e.transition?S:0,lazyRender:d.lazyRender,overlayStyle:{position:"absolute"},"aria-labelledby":`${n.id}-${P.value}`,closeOnClickOverlay:$,onOpen:k,onClose:_,onOpened:w,onClosed:T},{default:()=>{var E;return[d.options.map(r),(E=a.default)==null?void 0:E.call(a)]}})]),[[Bt,e.showWrapper]])};return Le({state:e,toggle:l,renderTitle:g}),()=>d.teleport?i(Ft,{to:d.teleport},{default:()=>[f()]}):f()}});const vo=Pe(uo),po=Pe(co),[mo,ae,fo]=xe("search"),_o=De({},Ae,{label:String,shape:he("square"),leftIcon:he("search"),clearable:ne,actionText:String,background:String,showAction:Boolean});var go=U({name:mo,props:_o,emits:["blur","focus","clear","search","cancel","clickInput","clickLeftIcon","clickRightIcon","update:modelValue"],setup(d,{emit:h,slots:a,attrs:O}){const e=$e(),n=C(),P=()=>{a.action||(h("update:modelValue",""),h("cancel"))},b=o=>{o.keyCode===13&&(dt(o),h("search",d.modelValue))},k=()=>d.id||`${e}-input`,_=()=>{if(a.label||d.label)return i("label",{class:ae("label"),for:k()},[a.label?a.label():d.label])},w=()=>{if(d.showAction){const o=d.actionText||fo("cancel");return i("div",{class:ae("action"),role:"button",tabindex:0,onClick:P},[a.action?a.action():o])}},T=()=>{var o;return(o=n.value)==null?void 0:o.blur()},s=()=>{var o;return(o=n.value)==null?void 0:o.focus()},l=o=>h("blur",o),g=o=>h("focus",o),r=o=>h("clear",o),f=o=>h("clickInput",o),c=o=>h("clickLeftIcon",o),v=o=>h("clickRightIcon",o),y=Object.keys(Ae),S=()=>{const o=De({},O,Ee(d,y),{id:k()}),$=D=>h("update:modelValue",D);return i(Ne,ze({ref:n,type:"search",class:ae("field"),border:!1,onBlur:l,onFocus:g,onClear:r,onKeypress:b,onClickInput:f,onClickLeftIcon:c,onClickRightIcon:v,"onUpdate:modelValue":$},o),Ee(a,["left-icon","right-icon"]))};return Le({focus:s,blur:T}),()=>{var o;return i("div",{class:ae({"show-action":d.showAction}),style:{background:d.background}},[(o=a.left)==null?void 0:o.call(a),i("div",{class:ae("content",d.shape)},[_(),S()]),w()])}}});const ho=Pe(go);const wo=""+new URL("../assets/xtool-selected-cover@2x-821dd94a.png",import.meta.url).href,yo={class:"search-group"},bo={key:0,class:"empty-data"},So={key:1},xo={class:"material-name"},Co=U({__name:"MoreMaterial",props:{show:{type:Boolean}},emits:["update:show"],setup(d,{emit:h}){const a=d,O=(m,x)=>`${m}?x-oss-process=image/resize,w_${x}/format,webp`,e=C(!1),n=C(!1),P=C(!1),b=C(!1),k=C(!1),_=C(!1),w=vt(),T=Ie(),{pagination:s,onlineMaterials:l,processingTypes:g,formValues:r,categoryList:f}=we(w),{info:c}=we(T),{t:v,locale:y}=le(),S=L(()=>y.value==="zh-CN"?"zh":"en"),o=L(()=>{const m=f.value.slice(0);return m.unshift({value:0,text:v("device.material.all_material_category")}),m}),$=L(()=>l.value.slice(0)),D=L(()=>{var m;return((m=c.value)==null?void 0:m.power)||0}),E=L(()=>{var x;const m=T.ext;return m!=null&&m.v2?(x=m==null?void 0:m.config)==null?void 0:x.productID:m==null?void 0:m.productID}),R=L(()=>g.value.join(","));Y(()=>a.show,m=>{m&&w.getMaterialCategoryList()}),Y(()=>r.value,m=>{a.show&&me({deviceMode:E.value,laserPower:D.value,processingTypes:R.value,current:1,pageSize:s.value.pageSize,isSupport:m.isSupport,q:m.search,categoryId:m.categoryId})},{deep:!0});const G=()=>{if(s.value.total>0){const m=Math.ceil(s.value.total/s.value.pageSize);let x=s.value.current;x<m?(x++,s.value=Object.assign(s.value,{current:x}),z({deviceMode:E.value,laserPower:D.value,processingTypes:R.value,current:x,pageSize:s.value.pageSize,isSupport:r.value.isSupport,q:r.value.search,categoryId:r.value.categoryId},!0)):k.value=!0}},z=async(m,x)=>{x?(_.value=!1,b.value=!0):(b.value=!1,_.value=!0);try{Vt(m.laserPower)&&(m.laserPower=m.laserPower.join(","));const{list:B=[],pagination:H}=await pt(m);n.value=!1,P.value=!1;const te=x?$.value.concat(B):B;l.value=te,s.value=Object.assign(s.value,{current:H.current,total:H.total})}catch(B){n.value=!1,P.value=!1,l.value=[],B.message==="Network Error"?n.value=!0:B.response?P.value=!0:Ve(v("device.material.request_failed"))}finally{x?b.value=!1:_.value=!1,k.value=!1,e.value=!0}},me=At(z,300),Z=()=>{z({deviceMode:E.value,laserPower:D.value,processingTypes:R.value,current:s.value.current,pageSize:s.value.pageSize,isSupport:r.value.isSupport,q:r.value.search,categoryId:r.value.categoryId})},fe=()=>{J()},Q=m=>{ee(),w.selectOnlineMaterial(m),w.sortLocalMaterial(m.id)},ee=()=>{g.value=[],h("update:show",!1)},J=()=>{l.value=[],r.value=Object.assign(r.value,{search:"",categoryId:0,isSupport:!0}),b.value=!1,k.value=!1,_.value=!1,s.value=Object.assign(s.value,{current:1,total:0}),e.value=!1,n.value=!1,P.value=!1};return(m,x)=>{const B=ke,H=We,te=ho,u=vo,p=mt,V=ve,X=po,oe=oo,ce=ft,_e=to,ge=Re,j=je,Ge=Me,Je=eo,Xe=Ce;return I(),N(Xe,{show:d.show,position:"top",style:{"min-height":"100%"},title:t(v)("mobile.device.select_material"),onOpened:Z,onClosed:fe},{default:M(()=>[F("div",yo,[i(H,{title:t(v)("mobile.device.select_material"),fixed:"",placeholder:"",onClickRight:ee},{right:M(()=>[i(B,{name:"cross",size:"18px"})]),_:1},8,["title"]),i(te,{modelValue:t(r).search,"onUpdate:modelValue":x[0]||(x[0]=A=>t(r).search=A),placeholder:t(v)("device.material.input_placeholder")},null,8,["modelValue","placeholder"]),i(X,null,{default:M(()=>[i(u,{modelValue:t(r).categoryId,"onUpdate:modelValue":x[1]||(x[1]=A=>t(r).categoryId=A),options:t(o)},null,8,["modelValue","options"]),i(u,{ref:"item",title:t(v)("mobile.device.filter")},{default:M(()=>[i(V,{center:"",title:t(v)("device.material.supported_only")},{"right-icon":M(()=>[i(p,{modelValue:t(r).isSupport,"onUpdate:modelValue":x[2]||(x[2]=A=>t(r).isSupport=A)},null,8,["modelValue"])]),_:1},8,["title"])]),_:1},8,["title"])]),_:1})]),t(Nt)(t($))?(I(),q("div",bo,[n.value?(I(),N(oe,{key:0,image:"network",description:t(v)("device.material.network_error_1")},null,8,["description"])):P.value?(I(),N(oe,{key:1,image:"error",description:t(v)("device.material.server_error")},null,8,["description"])):e.value?(I(),N(oe,{key:2,image:"search",description:t(v)("device.material.no_content_found")},null,8,["description"])):(I(),N(ce,{key:3,type:"spinner",class:"list-loading"}))])):(I(),q("div",So,[_.value?(I(),N(ce,{key:0,type:"spinner",class:"list-loading"})):(I(),N(Je,{key:1,loading:b.value,"onUpdate:loading":x[4]||(x[4]=A=>b.value=A),finished:k.value,"finished-text":t(v)("mobile.material.no_more"),"loading-text":t(v)("device.status.loading"),onLoad:G},{default:M(()=>[(I(!0),q(pe,null,Ut(t($),A=>(I(),N(V,{key:A.id,style:{"align-items":"center"}},{title:M(()=>[i(Ge,{style:{display:"flex"}},{default:M(()=>[i(_e,{src:A.image?O(A.image,512):t(wo),width:60,height:60,"preview-disabled":""},null,8,["src"]),F("span",xo,K(A.name[t(S)]),1),i(j,{tag:"a",href:A.helpUrl,target:"_blank","text-color":"#fff",size:"small",style:{padding:"0",border:"none"}},{default:M(()=>[i(ge,{name:"example-question",style:{"font-size":"18px",color:"#00c800"}})]),_:2},1032,["href"])]),_:2},1024)]),value:M(()=>[A.isSupport?(I(),N(j,{key:0,size:"small",plain:"",hairline:"",type:"success",onClick:Ye=>Q(A)},{default:M(()=>[Be(K(t(v)("device.material.use")),1)]),_:2},1032,["onClick"])):(I(),q("div",{key:1,style:{"text-align":"center","text-decoration":"underline"},onClick:x[3]||(x[3]=Ye=>t(ye)(t(v)("device.material.not_supported_yet_tips")))},[F("span",null,K(t(v)("device.material.not_supported_yet")),1)]))]),_:2},1024))),128))]),_:1},8,["loading","finished","finished-text","loading-text"]))]))]),_:1},8,["show","title"])}}});const ko=se(Co,[["__scopeId","data-v-b85b8b4d"]]),Po=U({__name:"MultiCanvas",setup(d){const h=Te(),a=h.canvasList,O=(l,g)=>{var r;return(r=l.filter(f=>f.id===g)[0])==null?void 0:r.title.replace("{panel}",e("canvas.panel"))},{t:e}=le(),n=C(!1),P=O(a,W.id),b=C(e(P??"")),k=C([]);Ue(()=>{k.value[0]=W.id});const _=()=>{n.value=!0},w=L(()=>a.map(l=>({value:l.id,text:l.title.replace("{panel}",e("canvas.panel"))}))),T=async l=>{n.value=!1;let g=l.selectedOptions[0].value;if(k.value[0]===g)return;const r=_t({overlay:!0,duration:0});await h.changeCanvasId(g),r.close(),b.value=l.selectedOptions[0].text,k.value[0]=g},s=()=>{n.value=!1};return(l,g)=>{const r=ve,f=gt,c=Ce;return I(),q(pe,null,[i(r,{"is-link":"",title:t(e)("canvas.panel"),value:b.value,class:"setting-title-wrap",onClick:_},null,8,["title","value"]),i(c,{show:n.value,"onUpdate:show":g[0]||(g[0]=v=>n.value=v),position:"bottom",round:"","close-on-click-overlay":!1,"safe-area-inset-bottom":""},{default:M(()=>[i(f,{"model-value":k.value,title:t(e)("canvas.panel"),columns:t(w),"confirm-button-text":l.$t("common.msg.ok"),"cancel-button-text":l.$t("common.msg.cancel"),onCancel:s,onConfirm:T},null,8,["model-value","title","columns","confirm-button-text","cancel-button-text"])]),_:1},8,["show"])],64)}}});const Io=se(Po,[["__scopeId","data-v-32d4bea6"]]),Mo={style:{display:"flex","align-items":"center"}},To={class:"custom-title"},Oo=U({__name:"SettingContent",setup(d){const{updateCanvasId:h,deviceValues:a,deviceDataHandler:O}=ao(),{t:e}=le(),n=Ie(),P=Te(),b=ht(),k=L(()=>n.info),_=L(()=>n.isInProcessing),w=C(!1),T=L(()=>n.ext),s=L(()=>T.value?T.value.ui.ProcessingModeForm:{ProcessingModeForm:""}),l=L(()=>n.dataSource),g=L(()=>P.currentId),r=L(()=>b.unit),f=y=>{console.log(y)};Y([()=>g.value,()=>l.value],async()=>{await new Promise(y=>{let S=0;const o=setInterval(()=>{(W.getCanvas(g.value)||S>15)&&(clearInterval(o),y("success")),S++},200)}),h(g.value)},{immediate:!0});const c=()=>{},v=async()=>{var y,S;if(window.MeApi&&await wt())try{if(!await((y=window.MeApi.permission)==null?void 0:y.isGrantedInternetPermission())){await Fe({title:e("mobile.common.local_network_title"),message:e("mobile.common.local_network_tip"),confirmButtonText:e("mobile.common.go_to_setting"),cancelButtonText:e("mobile.common.not_yet")}),(S=window.MeApi.permission)==null||S.openLocationPage();return}}catch(o){console.log(o);return}n.connected?be.push("/device?redirect=process-setting"):be.push("/connect?redirect=process-setting")};return(y,S)=>{const o=Re,$=ve,D=ko,E=Me;return I(),N(E,{direction:"vertical",fill:!0,class:"processing-setting"},{default:M(()=>{var R,G;return[F("section",null,[i($,{"is-link":"",value:(R=t(n).info)==null?void 0:R.name,onClick:v},{title:M(()=>[F("div",Mo,[F("span",To,K(t(e)("mobile.device.connect_device")),1),t(n).connected?(I(),N(o,{key:0,size:"20",name:"connected",color:"#28BE44"})):(I(),N(o,{key:1,size:"20",name:"un-connected",color:"#747a7a"}))])]),_:1},8,["value"])]),F("section",null,[i(Io),(I(),N(He(t(s)),{key:`${(G=t(T))==null?void 0:G.id}-${t(g)}`,ext:t(T),"canvas-id":t(g),"device-info":t(k),"device-values":t(a),"is-in-processing":t(_),handler:t(O),unit:t(r),onPushMessage:c,onExtendCalibrationModal:f,onShowMoreMaterial:S[0]||(S[0]=z=>w.value=z)},null,40,["ext","canvas-id","device-info","device-values","is-in-processing","handler","unit"])),i(D,{show:w.value,"onUpdate:show":S[1]||(S[1]=z=>w.value=z)},null,8,["show"])])]}),_:1})}}});const Eo=se(Oo,[["__scopeId","data-v-7f376fc2"]]),$o=U({__name:"SettingHeader",setup(d){const h=Jt(),{t:a}=le(),O=Xt(),e=yt(),{path:n,status:P,fileName:b}=we(e);let k;const _=C(""),w=C(b.value),T=C(""),s=C(""),l=C(!1),g=C(!1),r=C(!1),f=[{value:"save",text:a("common.menu.file_save")},{value:"saveAs",text:a("common.menu.file_save_as")}],c=/[`#%^/\\]/,v=new RegExp(c),y=C(null),S=50;let o=b.value;const $=ie(()=>{const u=_.value!=="";return u&&Ht().then(()=>{setTimeout(()=>{y.value.focus()},1)}),u}),D=ie(()=>_.value==="editor"?a("mobile.projects.rename_title"):_.value==="save"||_.value==="newFileSave"?a("mobile.device.file_save"):_.value==="saveAs"?a("mobile.device.file_save_as"):""),E=ie(()=>{if(bt(n.value)){let p=Pt.replace(".xcs","");return n.value=p,p}return!n.value&&O.query.path?b.value?b.value:St(O.query.path.toString()):decodeURIComponent(e.projectName)}),R=ie(()=>e.editStatusProjectPath);Ue(()=>{xt(),k=setInterval(()=>{e.autoSaveTmp()},6e4),Se.setSave(e.autoSaveTmp),G()});const G=()=>{so(()=>(Z(!1),!0))};Y(()=>e.saveConfirm,u=>{u&&Z(!0)}),Y(()=>P.value,u=>{z(u)}),Wt(()=>{clearInterval(k)});const z=u=>{const p={saving:()=>{l.value=!0},saved:()=>{l.value=!1,Ot({message:a("mobile.common.save_success")})},openError:()=>{l.value=!1,Ve(a("mobile.common.save_fail"))}};p[u]&&p[u]()},me=()=>{_.value="editor",w.value=E.value},Z=u=>{e.hasProjectChanged().then(p=>{console.log("[ hasChanged ] >",p.valueOf()),console.log("[ originalPath ] > ",T.value),p||o&&E.value!==o?Fe({message:a("mobile.common.save_notice_title"),confirmButtonText:a("mobile.common.yes"),cancelButtonText:a("mobile.common.no"),beforeClose:fe,closeOnClickOverlay:!0}).then(()=>{R.value&&x()?(s.value="save",J(()=>{Q(u)})):(r.value=!u,_.value="newFileSave",w.value=E.value)}).catch(()=>{Q(u)}):Q(u)})},fe=u=>{var p,V;return!u&&re.isFunction((p=e.confirm)==null?void 0:p.no)&&((V=e.confirm)==null||V.no("ignore")),!0},Q=u=>{var p,V;u?re.isFunction((p=e.confirm)==null?void 0:p.no)&&((V=e.confirm)==null||V.no()):ee()},ee=()=>{clearInterval(k),Se.removeSave(),T.value="",Ct(),e.projectClear(),e.isBackProjects?h.replace("/projects"):h.replace("/")},J=async u=>{if(console.log("[ editStatusProjectPath ] >",R.value),console.log("[ projectName ]> ",E.value),R.value){if(_.value==="editor")return;if(s.value==="save"&&x()||_.value==="editor")try{m(u)}catch(p){console.log("[fileHelper delete error]",p)}else m(u,!0)}else _.value==="editor"||m(u)},m=(u,p=!1)=>{e.saveProject(p).then(()=>{var V,X;u&&u(),e.saveConfirm&&re.isFunction((V=e.confirm)==null?void 0:V.no)&&((X=e.confirm)==null||X.no()),o=b.value}).catch(()=>{})},x=()=>R.value?w.value===E.value:!1,B=({value:u})=>{console.log(u),s.value=u;const p={save:()=>J(),saveAs:()=>{_.value="saveAs",w.value=E.value}};R.value&&x()?p[u]&&p[u]():(r.value=!1,w.value=E.value,u==="save"?_.value="newFileSave":_.value="saveAs")},H=()=>{let u=v.test(w.value)?w.value.replace(c,""):w.value;b.value=u,n.value=`${u.trim().slice(0,S)}${It}`,r.value?J(()=>{ee()}):J(),_.value=""},te=()=>{var u,p;_.value="",e.saveConfirm&&re.isFunction((u=e.confirm)==null?void 0:u.no)&&((p=e.confirm)==null||p.no())};return qt(()=>{kt()}),(u,p)=>{const V=ke,X=no,oe=We,ce=Ne,_e=Mt,ge=Tt;return I(),q(pe,null,[i(oe,{fixed:"",placeholder:"","left-arrow":"","right-text":t(a)("common.menu.file_save"),onClickLeft:p[1]||(p[1]=j=>Z(!1)),onClickRight:p[2]||(p[2]=j=>g.value=!0)},{title:M(()=>[F("div",{class:"fileâ€”name-ellipsis",onDblclick:me},K(t(E)),33)]),right:M(()=>[i(X,{show:g.value,"onUpdate:show":p[0]||(p[0]=j=>g.value=j),actions:f,placement:"bottom-end",onSelect:B},{reference:M(()=>[i(V,{size:"24",name:"ellipsis"})]),_:1},8,["show"])]),_:1},8,["right-text"]),i(_e,{show:t($),"onUpdate:show":p[4]||(p[4]=j=>Gt($)?$.value=j:null),title:t(D),"show-cancel-button":"","confirm-button-disabled":!w.value,"confirm-button-text":t(a)("common.msg.ok"),"cancel-button-text":t(a)("common.msg.cancel"),onConfirm:H,onCancel:te},{default:M(()=>[i(ce,{ref_key:"autoFocus",ref:y,modelValue:w.value,"onUpdate:modelValue":p[3]||(p[3]=j=>w.value=j),modelModifiers:{trim:!0},maxlength:S,class:"save-as-name",clearable:"",placeholder:t(a)("mobile.device.input_file_name"),onKeyup:Kt(H,["enter"])},null,8,["modelValue","placeholder","onKeyup"])]),_:1},8,["show","title","confirm-button-disabled","confirm-button-text","cancel-button-text"]),i(ge,{show:l.value,"onUpdate:show":p[5]||(p[5]=j=>l.value=j),duration:0,overlay:!0,type:"loading",message:t(a)("mobile.common.saving")},null,8,["show","message"])],64)}}});const Lo=se($o,[["__scopeId","data-v-15a56c2a"]]),Do=d=>(Zt("data-v-f607a3ff"),d=d(),Qt(),d),Ao={class:"canvas-container"},No={class:"canvas-edit-bar"},Vo=Do(()=>F("div",{style:{height:"100px"}},null,-1)),Ro=U({__name:"index",setup(d){const{t:h}=le(),a=Ie(),O=Te(),e=C(!1),n=C(),P=L(()=>{var l;const s=Dt[((l=a.ext)==null?void 0:l.id)||""];return s!=null&&s.CheckButton?s.CheckButton:je}),b=async()=>{var g,r,f,c,v;await new Promise(y=>{let S=0;const o=setInterval(async()=>{var $;if(W.canvas){const{canvas:D}=await(($=W.canvas)==null?void 0:$.getDisplayLayerShot({scaleNum:2}))||{};(D.width>1||S>15||W.canvas.exportCanvasJSON().length===0)&&(clearInterval(o),y("success")),S++}},200)});const{canvas:l}=await((g=W.canvas)==null?void 0:g.getDisplayLayerShot({scaleNum:2}))||{};if(l){(r=n.value)!=null&&r.innerHTML&&(n.value.innerHTML=""),(f=n.value)==null||f.appendChild(l);const{width:y,height:S}=Rt(l.width/2,l.height/2,((c=n.value)==null?void 0:c.clientWidth)??0,((v=n.value)==null?void 0:v.clientHeight)??0);l.style.width=`${y}px`,l.style.height=`${S}px`}};Y(()=>O.currentId,s=>{console.log("editorStore.currentId="+s),b()},{immediate:!0});const k=Et(),_=C(""),w=async()=>{const s=a.ext;e.value=!0;try{const[l,g]=await Promise.allSettled([s.checkDeviceOnline(),k.checkProcess()]),[r,f]=[l,g].map(c=>c.status==="fulfilled"?c.value:null);if(r||f){ye(h((r||f).text));return}if(T())return;Se.saveTmp(),window.MeApi&&(_.value=await window.MeApi.app.getAppVersion()),$t({extId:s.processParams.config.id,xcs_version:_.value,processing_mode:s.processParams.processingArea.key}),be.push("/processing")}catch(l){console.log(l)}finally{e.value=!1}},T=()=>{if(a.extId!==Lt.D1Pro)return!1;const{dataSource:s}=a,{gMode:l,power:g}=a.ext.info,r=O.currentId;return(s==null?void 0:s.projectData.get(r)).mode==="LASER_CYLINDER"&&l===0&&g===40?(ye(h("device.process.cylinder_red_cross_warning_tip")),!0):!1};return(s,l)=>{const g=Yt("router-link"),r=Me;return I(),q(pe,null,[i(Lo),i(Eo),F("div",Ao,[i(g,{class:"canvas-image",to:"/editor"},{default:M(()=>[F("div",No,K(t(h)("mobile.device.enter_canvas")),1),F("div",{ref_key:"canvasPreviewWrapper",ref:n,class:"canvas-container-box"},null,512)]),_:1}),Vo]),i(r,{direction:"vertical",class:"start-button-wrapper","margin-bottom":"43px"},{default:M(()=>[(I(),N(He(t(P)),{type:"primary",class:"start-button",block:"",loading:e.value,ext:t(a).ext,onClick:w},{default:M(()=>[Be(K(t(h)("mobile.device.start_processing")),1)]),_:1},8,["loading","ext"]))]),_:1})],64)}}});const Qo=se(Ro,[["__scopeId","data-v-f607a3ff"]]);export{Qo as default};
