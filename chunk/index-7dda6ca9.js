var Ot=Object.defineProperty;var Nt=(a,e,i)=>e in a?Ot(a,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[e]=i;var O=(a,e,i)=>(Nt(a,typeof e!="symbol"?e+"":e,i),i),Be=(a,e,i)=>{if(!e.has(a))throw TypeError("Cannot "+i)};var V=(a,e,i)=>(Be(a,e,"read from private field"),i?i.call(a):e.get(a)),z=(a,e,i)=>{if(e.has(a))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(a):e.set(a,i)},b=(a,e,i,u)=>(Be(a,e,"write to private field"),u?u.call(a,i):e.set(a,i),i);var ke=(a,e,i)=>(Be(a,e,"access private method"),i);import{C as wt,a as xt}from"./index-17630698.js";import{bL as pt,bQ as _t,bq as Q,bw as F,bM as je,bx as Le,b8 as G,by as Mt,bu as S,_ as Vt,bN as at,br as H,bs as bt,bt as we,bB as J,bv as Gt,bc as Ut,ah as xe,bJ as Fe,bK as he,S as Bt,bE as kt,bD as Qe,bR as st,bS as Ft,bT as Qt,bU as Yt}from"../assets/index-83a10b2e.js";import{C as be,l as At,_ as Ht,a as zt,i as mt,q as Pe,e as Kt,w as Wt}from"./xcs-canvas-5c2592d6.js";import{i as Xt,a as Re,d as jt}from"./image-c9c8ff8c.js";import{k as ge,H as Ue,b as ve,f as _e,I as me,J as N,u as R,D as te,j as L,G as gt,K as k,y as B,E as ht,a0 as $t,a1 as Jt,ak as qt,q as Rt,c as Zt,o as ea,a3 as ta}from"./xcs-vue-family-70642f71.js";import{N as ae}from"./text-3b674000.js";import{N as X}from"./button-00b27872.js";import{N as Y}from"./space-5433d955.js";import{S as fe,M as aa}from"./setting.vue_vue_type_style_index_0_lang-315c55c2.js";import{a as sa,_ as ia}from"./setting.vue_vue_type_script_setup_true_lang-0ee96bfb.js";import{X as oa}from"./modal-c96d5b67.js";import{u as Ct}from"./use-message-cd8b9f19.js";import{N as na}from"./inputnumber-fff11604.js";import{a as ra,N as Z}from"./grid-9031c693.js";import{B as ca}from"./params-f8cc805d.js";import{D as la}from"./device-845a051d.js";import{p as ua}from"./urlparam-4b6ed041.js";const Ce="DEVICE_CACHE_DATA";function da(a){const e=a.length/4,i=new Uint8ClampedArray(e);for(let u=0;u<a.length;u+=4){const r=a[u],d=a[u+1],I=a[u+2],P=a[u+3],f=Ea({R:r,G:d,B:I,A:P});i[u>>2]=pa(f.R,f.G,f.B)}return i}function Ea(a,e={R:255,G:255,B:255}){const i=a.A/255;return{R:(1-i)*e.R+i*a.R,G:(1-i)*e.G+i*a.G,B:(1-i)*e.B+i*a.B}}function pa(a,e,i){return .3*a+.6*e+.1*i>>0}const _a=`# P2 BITMAP HEAD
G4 P0.1
M15 S\${airPumpValue}
\${enableRelative?'G90':''}
\${startY? 'G0 Y' + startY : ''}
\${enableRelative?'G91':''}
# motion_start
# motionConfig=\${motionConfig}
`,Aa=`# P2 BITMAP TAIL
# motion_end
`,ma=`
# P2 HEAD
G0 F9600
G0 X0 Y0

M4 S0
G1 F1000
M19 S1
M18 S0

G4 P0.1
M104 X0

M15 S\${airPumpValue}

# motion_start
# motionConfig=\${motionConfig}

\${motionCode}

# motion_end

G0 S0
M3 S0
G0 Z0
G0 X0 Y0
G0 F10000
G1 F10000
G4 P0.1
M6 P1
`,ga=`
# P2 HEAD
G0 F9600
G0 X0 Y0
<% if(isFeeder) { %>
G0 Y\${start.y}
<% } %>
M4 S0
G1 F1000
M19 S1
M18 S0
<% if(isFeeder) { %>
M32U1000
M35U160
<% } %>
`,ha=`# P2 TAIL
G90
G0 S0
M3 S0
G0 Z0
G0 X0 Y0
G0 U0
G0 F10000
G1 F10000
G4 P0.1
M6 P1
`,Ra=`
# P2 VECTOR HEAD
G4 P0.1
G90
M15 S\${airPumpValue}
# motion_start
# motionConfig=\${motionConfig}
`,Ca=`# P2 VECTOR TAIL
# motion_end
`,ce={gCodeTail:ha,gCodeHead:ga,bitmapHead:_a,vectorHead:Ra,bitmapTail:Aa,vectorTail:Ca,curveVector:ma};function Ia(){return new Worker(""+new URL("../assets/cameraWorker-6abf1d17.js",import.meta.url).href)}class Sa extends pt{constructor(){super(Ia)}async correctedImage(e){const{rgbaArr:i,points:u,correctW:r,correctH:d,correctValue:I,isLocal:P}=e,f={rgbaArr:i,points:u,correctValue:I,isLocal:P},T=await this.request({type:"correctedImage",data:f});if(!T){console.log("P2 图像校准失败");return}const{buffer:t}=T,s=new ImageData(t,r,d);return await Xt(s)}async measurement(e){const i=performance.now();let u=await this.request({type:"measure",data:e});const r=performance.now();return console.log(["=> work time",r-i]),u=JSON.parse(u),u}}var ee,ue,de,Ee,pe,Oe,ie,Ne;class fa{constructor(e){z(this,ee,void 0);z(this,ue,"");z(this,de,"");z(this,Ee,"");z(this,pe,"");z(this,Oe,void 0);z(this,ie,void 0);z(this,Ne,void 0);b(this,ee,e)}clean(){var e;b(this,ue,""),b(this,de,""),b(this,Ee,""),b(this,pe,""),(e=V(this,ie))==null||e.destroy(),b(this,ie,void 0)}get cameraTool(){return V(this,ie)||b(this,ie,new Sa),V(this,ie)}get localImgData(){return V(this,Oe)}set localImgData(e){b(this,Oe,e)}get globalImageData(){return V(this,Ne)}set globalImageData(e){b(this,Ne,e)}set apis(e){b(this,ee,e)}async getLocalCalibrationData(){return V(this,ue)||b(this,ue,await V(this,ee).getLocalCalibrationData()),V(this,ue)}async getGlobalCalibrationData(){return V(this,de)||b(this,de,await V(this,ee).getGlobalCalibrationData()),V(this,de)}async getLocalIrData(){return V(this,pe)||b(this,pe,await V(this,ee).getLocalIrData()),V(this,pe)}async getGlobalIrData(){return V(this,Ee)||b(this,Ee,await V(this,ee).getGlobalIrData()),V(this,Ee)}}ee=new WeakMap,ue=new WeakMap,de=new WeakMap,Ee=new WeakMap,pe=new WeakMap,Oe=new WeakMap,ie=new WeakMap,Ne=new WeakMap;class Ta{constructor(e){O(this,"name");O(this,"type",_t);O(this,"createDisplayFn");O(this,"viewport");O(this,"container");O(this,"bg");O(this,"rect");this.name=e}async init(e){this.viewport=e}destroy(){this.container.destroy(!0)}initViewportDisplay(e){return this.createDisplayFn=e,this.container=this.createDisplayFn("RECT"),this.bg=this.createDisplayFn("RECT"),this.rect=this.createDisplayFn("RECT"),this.container.addChild(this.bg,this.rect),this.container}updateRect(e){const{width:i=this.bg.width,height:u=this.bg.height}=e;this.bg.clear().beginFill(0,.35).drawRect(0,0,i,u).endFill()}updateHole(e){this.bg.beginHole().drawRect(e.x,e.y,e.width,e.height).endHole(),this.rect.clear().drawRect(e.x,e.y,e.width,e.height)}}class La{constructor(e){O(this,"name");O(this,"type",_t);O(this,"createDisplayFn");O(this,"viewport");O(this,"container");O(this,"mask");this.name=e}async init(e){this.viewport=e}destroy(){this.container.destroy(!0)}initViewportDisplay(e){return this.createDisplayFn=e,this.container=this.createDisplayFn("RECT"),this.mask=this.createDisplayFn("RECT"),this.container.addChild(this.mask),{display:this.container,targetContainer:"bgLayer"}}updateMask({fillColor:e,fillAlpha:i,width:u,height:r}){this.mask.clear().beginFill(e,i).drawRect(0,0,u,r).endFill()}}const Pa="data:image/png;base64,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",Da=""+new URL("../assets/p2-ready-04577b61.png",import.meta.url).href,it={cover:Pa,readyImg:Da},It=""+new URL("../assets/camera-b2b9822d.png",import.meta.url).href,ya="data:image/png;base64,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";var p=(a=>(a.LASER_PLANE="LASER_PLANE",a.LASER_CYLINDER="LASER_CYLINDER",a.FREE_PLANE="FREE_PLANE",a.PASS_THROUGH="PASS_THROUGH",a.SUPER_LASER_PLANE="SUPER_LASER_PLANE",a.KNIFE_CUT="KNIFE_CUT",a.PRINTER_KNIFE_CUT="PRINTER_KNIFE_CUT",a.LASER_CONVEYOR_FEEDER="LASER_CONVEYOR_FEEDER",a.CURVE_PROCESS="CURVE_PROCESS",a))(p||{}),x=(a=>(a.VECTOR_CUTTING="VECTOR_CUTTING",a.VECTOR_ENGRAVING="VECTOR_ENGRAVING",a.FILL_VECTOR_ENGRAVING="FILL_VECTOR_ENGRAVING",a.BITMAP_ENGRAVING="BITMAP_ENGRAVING",a.KNIFE_CUTTING="KNIFE_CUTTING",a))(x||{}),Te=(a=>(a.BITMAP="BITMAP",a.VECTOR="VECTOR",a))(Te||{});const va={WORK_PREPARED:Q.BEFORE_START,WORK_STARTED:Q.START_PROCESS,WORK_PAUSED:Q.PAUSE_PROCESS,WORK_STOPED:Q.CANCEL_PROCESS,WORK_FINISHED:Q.FINISH_PROCESS,CLEAN_START:Q.DRAIN,IDLE:Q.IDLE};var ye=(a=>(a.DRAWER="DRAWER",a.GAP="GAP",a.STATUS_CONTROLLER="STATUS_CONTROLLER",a))(ye||{}),St=(a=>(a.Error="error",a))(St||{});const{LASER_PLANE:Oa,LASER_CYLINDER:Na,FREE_PLANE:wa,PASS_THROUGH:xa,CURVE_PROCESS:Ma,LASER_CONVEYOR_FEEDER:Va}=p,{VECTOR_ENGRAVING:oe,FILL_VECTOR_ENGRAVING:ne,VECTOR_CUTTING:De,BITMAP_ENGRAVING:re}=x,ba={speed:{[Oa]:[{type:oe,min:1,max:250,defaultValue:1},{type:ne,min:1,max:600,defaultValue:1},{type:De,min:1,max:250,defaultValue:1},{type:re,min:1,max:600,defaultValue:1}],[Na]:[{type:oe,roller:!0,min:1,max:25,defaultValue:1},{type:ne,roller:!0,min:1,max:250,defaultValue:1},{type:re,roller:!0,min:1,max:250,defaultValue:1},{type:oe,catch:!0,min:1,max:120,defaultValue:1},{type:ne,catch:!0,min:1,max:250,defaultValue:1},{type:re,catch:!0,min:1,max:250,defaultValue:1}],[wa]:[{type:oe,min:1,max:250,defaultValue:1},{type:ne,min:1,max:600,defaultValue:1},{type:De,min:1,max:250,defaultValue:1},{type:re,min:1,max:600,defaultValue:1}],[Va]:[{type:oe,min:1,max:160,defaultValue:1},{type:ne,min:1,max:600,defaultValue:1},{type:De,min:1,max:160,defaultValue:1},{type:re,min:1,max:600,defaultValue:1}],[xa]:[{type:oe,min:1,max:250,defaultValue:1},{type:ne,min:1,max:600,defaultValue:1},{type:De,min:1,max:250,defaultValue:1},{type:re,min:1,max:600,defaultValue:1}],[Ma]:[{type:oe,min:1,max:30,defaultValue:1},{type:ne,min:1,max:30,defaultValue:1},{type:De,min:1,max:250,defaultValue:1},{type:re,min:1,max:30,defaultValue:1}]}},m=".",g={Qx30_0:`FIRMWARE${m}NOT_MATCHED${m}`,Qx30_1:`BOARDS${m}ELEMENT_NOT_FOUND${m}`,Qx30_1_1:`BOARDS${m}ELEMENT_NOT_FOUND${m}motion_gd450`,Qx30_1_2:`BOARDS${m}ELEMENT_NOT_FOUND${m}ui_gd330`,Qx30_1_3:`BOARDS${m}ELEMENT_NOT_FOUND${m}wcb_gd330`,Qx16:`CONTROLLER${m}TMP_HIGH${m}`,Qx16_1:`CONTROLLER${m}TMP_HIGH${m}MASTER`,Qx01_2:`WATER_TMP${m}ELEMENT_NOT_FOUND${m}`,Qx01_1:`WATER_TMP${m}TMP_HIGH${m}`,Qx01_0:`WATER_TMP${m}TMP_LOW${m}`,Qx30_2:`WATER_LINE${m}VALUE_LOW${m}`,Qx08_0:`WATER_PUMP${m}CUR_LOW${m}`,Qx08_1:`WATER_PUMP${m}CUR_HIGH${m}`,Qx08_2:`WATER_PUMP${m}CUR_ABNORMAL${m}`,Qx30_3:`WATER_FAN${m}CUR_ABNORMAL${m}`,Qx30_4:`WATER_FLOW${m}VALUE_LOW${m}`,Qx14_4:`MOTOR_DRIVER${m}ELEMENT_ABNORMAL${m}M23 S135`,Qx14_5:`MOTOR_DRIVER${m}ELEMENT_ABNORMAL${m}M23 S136`,Qx14_6:`MOTOR_DRIVER${m}ELEMENT_ABNORMAL${m}M23 S137`,Qx14_7:`MOTOR_DRIVER${m}ELEMENT_ABNORMAL${m}M23 S138`,Qx14:`MOTOR_LIMIT${m}ELEMENT_NOT_FOUND${m}`,Qx14_1:`MOTOR_LIMIT${m}OPERATION_FAILED${m}M23 S140`,Qx14_2:`MOTOR_LIMIT${m}OPERATION_FAILED${m}M23 S141`,Qx14_3:`MOTOR_LIMIT${m}OPERATION_FAILED${m}M23 S142`,Qx14_8:`MOTOR_LIMIT${m}OPERATION_FAILED${m}M23 S143`,Qx30_5:`MOTOR_LIMIT${m}OPERATION_FAILED${m}M23 S148`,Qx30_6:`MOTOR_LIMIT${m}OPERATION_FAILED${m}M23 S149`,Qx30_7:`MOTOR_LIMIT${m}OPERATION_FAILED${m}M23 S150`,Qx30_8:`MOTOR_LIMIT${m}OPERATION_FAILED${m}M23 S151`,Qx32_0:`SMOKING_FAN${m}CUR_LOW${m}`,Qx32_1:`SMOKING_FAN${m}CUR_HIGH${m}`,Qx17_0:`CAMERA${m}ELEMENT_NOT_FOUND${m}`,Qx17_1:`CAMERA${m}OPERATION_FAILED${m}`,Qx31_1:`ELECTRONICLOCK${m}OPERATION_FAILED${m}NOT OPEN`,Qx31_0:`ELECTRONICLOCK${m}OPERATION_FAILED${m}NOT CLOSE`,Qx31_2:`AIRPUMP${m}CUR_ABNORMAL${m}`},Ga={[g.Qx30_0]:{code:g.Qx30_0,msg:"qx30_0"},[g.Qx30_1]:{code:g.Qx30_1,msg:"qx30_1"},[g.Qx30_1_1]:{code:g.Qx30_1,msg:"qx30_1"},[g.Qx30_1_2]:{code:g.Qx30_1,msg:"qx30_1"},[g.Qx30_1_3]:{code:g.Qx30_1,msg:"qx30_1"},[g.Qx16]:{code:g.Qx16,msg:"qx16"},[g.Qx16_1]:{code:g.Qx16,msg:"qx16"},[g.Qx01_2]:{code:g.Qx01_2,msg:"qx01_2"},[g.Qx01_1]:{code:g.Qx01_1,msg:"qx01_1"},[g.Qx01_0]:{code:g.Qx01_0,msg:"qx01_0"},[g.Qx30_2]:{code:g.Qx30_2,msg:"qx30_2"},[g.Qx08_0]:{code:g.Qx08_0,msg:"qx08_0"},[g.Qx08_1]:{code:g.Qx08_1,msg:"qx08_1"},[g.Qx08_2]:{code:g.Qx08_2,msg:"qx08_2"},[g.Qx30_3]:{code:g.Qx30_3,msg:"qx30_3"},[g.Qx30_4]:{code:g.Qx30_4,msg:"qx30_4"},[g.Qx14_4]:{code:g.Qx14_4,msg:"qx14_4"},[g.Qx14_5]:{code:g.Qx14_5,msg:"qx14_5"},[g.Qx14_6]:{code:g.Qx14_6,msg:"qx14_6"},[g.Qx14_7]:{code:g.Qx14_7,msg:"qx14_7"},[g.Qx14]:{code:g.Qx14_8,msg:"qx14"},[g.Qx14_1]:{code:g.Qx14_1,msg:"qx14_1"},[g.Qx14_2]:{code:g.Qx14_2,msg:"qx14_2"},[g.Qx14_3]:{code:g.Qx14_3,msg:"qx14_3"},[g.Qx14_8]:{code:g.Qx14_8,msg:"qx14_8"},[g.Qx30_5]:{code:g.Qx30_5,msg:"qx30_5"},[g.Qx30_6]:{code:g.Qx30_6,msg:"qx30_6"},[g.Qx30_7]:{code:g.Qx30_7,msg:"qx30_7"},[g.Qx30_8]:{code:g.Qx30_8,msg:"qx30_8"},[g.Qx32_0]:{code:g.Qx32_0,msg:"qx32_0"},[g.Qx32_1]:{code:g.Qx32_1,msg:"qx32_1"},[g.Qx17_0]:{code:g.Qx17_0,msg:"qx17_0"},[g.Qx17_1]:{code:g.Qx17_1,msg:"qx17_1"},[g.Qx31_1]:{code:g.Qx31_0,msg:"qx31_1"},[g.Qx31_0]:{code:g.Qx31_1,msg:"qx31_0"},[g.Qx31_2]:{code:g.Qx31_2,msg:"qx31_2"}},{VECTOR_CUTTING:Ua,VECTOR_ENGRAVING:Ba}=je,ka={head(a){const e=be(ce.gCodeHead),i=a.processMode===F.LASER_CONVEYOR_FEEDER;return e({focalLen:a.focalLen,isFeeder:i,...a})},tail(){return ce.gCodeTail},vectorHead(a){let e;const{cut:i=100,engrave:u=100}=a.airPumpConfig;a.groupKey===Ua&&(e=Math.round(i*2.55)),a.groupKey===Ba&&(e=Math.round(u*2.55));const r=be(ce.vectorHead),d={color:a.color};return r({motionConfig:JSON.stringify(d),airPumpValue:e})},vectorTail(){return ce.vectorTail},bitmapHead(a){const{engrave:e=100}=a.airPumpConfig,i=Math.round(e*2.55),u=be(ce.bitmapHead),r={color:a.color};return u({enableRelative:a.enableRelative,motionConfig:JSON.stringify(r),startY:a.start.y,airPumpValue:i,...a})},bitmapTail(){return ce.bitmapTail}},Fa=[{name:"captureGlobalImage",url:"/camera/snap",timeout:6e4,port:"8329",responseType:"blob",params:{stream:"0"}},{name:"captureLocalImage",url:"/camera/snap",timeout:6e4,port:"8329",responseType:"blob",params:{stream:"1"}},{name:"setExposure",url:"/camera/exposure",type:"post",port:"8329",params:{stream:"0"},data:{value:80}},{name:"deviceInfo",list:[{url:"/device/machineInfo",transformResult(a){const{deviceName:e,mac:i,ip:u,sn:r,machineType:d,machineSubType:I,laserPower:P,firmware:f}=a,T=f.package_version||f.master_h3_laserservice;return{name:e,version:T,ip:u["wlan0-ip"],snCode:r,power:P,mac:i,machineType:d,machineSubType:I}}},{url:"/device/workingInfo",transformResult(a){const{timeSystemWork:e,timeModeWorking:i,numOfflineWorking:u,numOnlineWorking:r}=a,I=Number((parseInt(i)/60/60).toFixed(1))||1,P=Number((parseInt(e)/60/60).toFixed(1)),f=Number(u+r);return{workTime:I,workTimes:f,standByTime:P}}},{type:"post",url:"/config/get",data:{alias:"config",type:"user",kv:["offlineProtoModeEnable","offlineProtoProModeEnable","offlineOptionModeEnable","flameAlarm","fillLightBrightness","purifierTimeout","motionPowerCut"]},transformResult(a){const e=[],{offlineProtoModeEnable:i,offlineProtoProModeEnable:u,offlineOptionModeEnable:r,flameAlarm:d}=a,I={offlineProtoModeEnable:i,offlineProtoProModeEnable:u,offlineOptionModeEnable:r};return Object.keys(I).forEach(P=>{I[P]&&e.push(P)}),{...a,offlineSelectKeys:e,flameAlarm:d,fillLight:Number(a.fillLightBrightness)/255*100>>0||0,purifierTimeout:a.purifierTimeout,motionPowerCut:a.motionPowerCut||""}}}],transformResult([a,e,i,u]){return{...a,...e,...i,...u}}},{name:"setDeviceName",type:"post",url:"/device/machineInfo"},{name:"getConfigs",type:"post",url:"/config/get"},{name:"setConfigs",type:"post",url:"/config/set"},{name:"queryRunningStatus",url:"/device/runningStatus",transformResponse(a){return JSON.parse(a)}},{name:"processing",url:"/processing/progress",timeout:Number.MAX_SAFE_INTEGER,transformResponse(a){return console.log(a),a.msg==="Success"}},{name:"turnLight",url:"/peripheral/fill_light",type:"post",data:{action:"set_bri",idx:0,value:255}},{name:"offLight",url:"/peripheral/fill_light",type:"post",data:{action:"set_bri",idx:0,value:0}},{name:"getGlobalCalibrationData",url:"/file",timeout:3e4,responseType:"text",params:{action:"download",filename:"global_calib.json"}},{name:"getLocalCalibrationData",url:"/file",timeout:3e4,responseType:"text",params:{action:"download",filename:"local_calib.json"}},{name:"getLocalIrData",url:"/file",timeout:3e4,responseType:"text",params:{action:"download",filename:"local_ir.txt"}},{name:"getGlobalIrData",url:"/file",timeout:3e4,params:{action:"download",filename:"global_ir.txt"}},{name:"resetLaserHead",url:"/peripheral/laser_head",timeout:3e4,type:"post",data:{action:"go_to",waitTime:0,x:0,y:0}},{name:"getLaserPosition",url:"/peripheral/laser_head",timeout:3e4,type:"post",data:{action:"get_coord",waitTime:0}},{name:"setLaserHead",url:"/peripheral/laser_head",timeout:3e4,type:"post",data:{action:"go_to"}},{name:"turnOnGlobalIrLed",type:"post",url:"/peripheral/ir_led",data:{action:"on",index:2}},{name:"turnOffGlobalIrLed",type:"post",url:"/peripheral/ir_led",data:{action:"off",index:2}},{name:"turnOnLocalIrLed",type:"post",url:"/peripheral/ir_led",data:{action:"on",index:1}},{name:"turnOffLocalIrLed",type:"post",url:"/peripheral/ir_led",data:{action:"off",index:1}},{name:"uploadGcode",type:"post",url:"/processing/upload",timeout:0,port:"8080",params:{gcodeType:"processing",fileType:"txt"}},{name:"cancelPrint",url:"/processing/stop"},{name:"pausePrint",url:"/processing/pause"},{name:"listWifi",url:"/net/get_ap_list",transformResult(a){return a.sort((e,i)=>i.level-e.level),Array.from(new Set(a.map(e=>e.ssid)))}},{name:"configWifi",url:"/net/set_wifi",method:"POST"},{name:"ip",url:"/net/ifconfig",transformResult(a){const e=a.find(i=>i.iface==="wlan0");return e?e.ip:""}},{name:"exportLog",url:"/dev/log",timeout:0,responseType:"arraybuffer"},{name:"drawerStatus",url:"/peripheral/drawer",transformResult(a){return a.state==="off"}},{name:"updateFirmwareHandshake",url:"/upgrade_version",port:"8087",params:{force_upgrade:"1",machine_type:"MXP"}},{name:"updateFirmware",url:"/package",type:"post",port:"8087",timeout:0,params:{action:"burn"}},{name:"version",url:"/system",params:{action:"version_v2"},transformResult(a){return a.package_version}},{name:"command",url:"/cnc/cmd"},{name:"isIdle",url:"/processing/print_type",transformResponse(a){var i;const e=JSON.parse(a);return["P_IDLE","P_SLEEP"].includes((i=e==null?void 0:e.data)==null?void 0:i.mode)}},{name:"isMeasuring",url:"/processing/print_type",transformResponse(a){var i;const e=JSON.parse(a);return((i=e==null?void 0:e.data)==null?void 0:i.mode)==="P_MEASURE"}},{name:"isCover",url:"/peripheral/gap",transformResponse(a){var i;const e=JSON.parse(a);return((i=e==null?void 0:e.data)==null?void 0:i.state)==="off"}},{name:"lockCover",url:"/peripheral/digital_lock",type:"post",port:"8080"},{name:"modeSwitch",url:"/device/modeSwitch",type:"post",port:"8080"}],Qa=""+new URL("../assets/drain-c443e893.png",import.meta.url).href,Ya={power:{min:1,max:10,default:10,enable:!0},speed:{min:1,max:200,default:160,enable:!0},enableOutline:!1,enable:!1},ft={walkBorder:{default:Ya},showTotalTime:!1,buildParams:{delta:.1,neg_sign:0,swap_xy:0,accel:2e3,enableRelative:!0,overScanRequired:!0},enableRepeatProcess:{[F.LASER_CONVEYOR_FEEDER]:!1},preview:{extendDirection:{[F.LASER_CYLINDER]:Le.RIGHT}},rightSideBar:{[Q.DRAIN]:{title:"device.p2.drain",tips:"device.p2.drain_info",img:Qa}}},U={...Mt,auto_measure:"device.common.auto_measure",thickness_is_empty:"device.process.thickness_is_empty",focal_length_is_empty:"device.process.focal_length_is_empty",drawer_is_open:"device.process.drawer_is_open",drawer_is_close:"device.process.drawer_is_close"},Ha={[F.LASER_PLANE]:{collisionRules:{checkSizeType:"totalSize",ignoredDirection:[],handler:()=>({type:G.text,text:U.element_out_zoom})},integrityDataRules:{requireKeys:["focalLen"],handler:a=>{if(a==="focalLen")return{type:G.text,text:U.thickness_is_empty}}},addonStatusRules:{addonCheckLists:["drawer"],rules:{drawer:{checkKey:"drawerStatus",func:a=>a.isCheckDrawer===!1?null:a.drawerStatus,correctStatus:"CLOSE",handler:()=>({type:G.text,text:U.drawer_is_open})}}}},[F.LASER_CYLINDER]:{collisionRules:{checkSizeType:"totalSize",ignoredDirection:["right"],handler:()=>({type:G.text,text:U.element_out_zoom})},integrityDataRules:{requireKeys:["focalLen","rotateMultiple"],handler:a=>a==="focalLen"?{type:G.text,text:U.focal_length_is_empty}:{type:G.text,text:U.catch_data_empty}}},[F.FREE_PLANE]:{collisionRules:{checkSizeType:"totalSize",ignoredDirection:[],handler:()=>({type:G.text,text:U.element_out_zoom})},integrityDataRules:{requireKeys:["focalLen"],handler:a=>{if(a==="focalLen")return{type:G.text,text:U.focal_length_is_empty}}},addonStatusRules:{addonCheckLists:["drawer"],rules:{drawer:{checkKey:"drawerStatus",correctStatus:"OPEN",func:(a,e)=>e?a.isCheckDrawer===!1?null:a.drawerStatus:"OPEN",handler:()=>({type:G.text,text:U.drawer_is_close})}}}},[F.PASS_THROUGH]:{collisionRules:{checkSizeType:"totalSize",ignoredDirection:[Le.BOTTOM],handler:()=>({type:G.text,text:U.element_out_zoom})},integrityDataRules:{requireKeys:["focalLen"],handler:a=>{if(a==="focalLen")return{type:G.text,text:U.focal_length_is_empty}}},addonStatusRules:{addonCheckLists:["drawer"],rules:{drawer:{checkKey:"drawerStatus",correctStatus:"OPEN",func:a=>a.isCheckDrawer===!1?null:a.drawerStatus,handler:()=>({type:G.text,text:U.drawer_is_close})}}}},[F.LASER_CONVEYOR_FEEDER]:{collisionRules:{checkSizeType:"totalSize",ignoredDirection:["bottom"],handler:()=>({type:G.text,text:U.element_out_zoom})},integrityDataRules:{requireKeys:["focalLen"],handler:a=>{if(a==="focalLen")return{type:G.text,text:U.focal_length_is_empty}}},addonStatusRules:{addonCheckLists:["drawer"],rules:{drawer:{checkKey:"drawerStatus",correctStatus:"OPEN",func:(a,e)=>e?a.isCheckDrawer===!1?null:a.drawerStatus:"OPEN",handler:()=>({type:G.text,text:U.drawer_is_close})}}}},[F.CURVE_PROCESS]:{collisionRules:{checkSizeType:"totalSize",ignoredDirection:[],handler:()=>({type:G.text,text:U.element_out_zoom})}}},Ye={localCameraOffset:{x:125,y:20},globalCorrectImgSize:{width:2440,height:1220},localCorrectImgSize:{width:2800,height:2e3}},Ae={width:140,height:100},za={x:100,y:0,width:Ae.width,height:Ae.height,color:16777215,offsetX:-70,offsetY:-50,alpha:0,angle:0,showStar:!1,limitBounds:{topLeft:{x:55,y:0}},icon:{url:It,angle:0,x:0,y:0,width:140,height:100}},Ka={x:100,y:0,width:45,height:30,color:16777215,offsetX:-22.5,offsetY:-15,alpha:0,angle:0,showStar:!1,limitBounds:{topLeft:{x:55,y:0}},icon:{url:ya,x:0,y:0,width:45,height:30}},Wa={[p.LASER_CONVEYOR_FEEDER]:{limitBounds:{topLeft:{x:55,y:0},bottomRight:{x:500,y:305}}}},Xa={[p.LASER_CYLINDER]:{x:100,y:100,width:Ae.height,height:Ae.width,offsetX:-50,offsetY:-70,angle:0,limitBounds:{topLeft:{x:0,y:55}},icon:{url:It,x:100,y:0,angle:90,width:140,height:100}},[p.LASER_CONVEYOR_FEEDER]:{limitBounds:{topLeft:{x:5,y:0},bottomRight:{x:500,y:305}}},[p.FREE_PLANE]:{limitBounds:{topLeft:{x:5,y:0}}},[p.PASS_THROUGH]:{limitBounds:{topLeft:{x:5,y:0}}}},ja={id:"P2",name:"xTool P2",cover:it.cover,readyImg:it.readyImg,productID:"MP2",firmwareContentId:"xcs-p2-firmware",canUseSocket:!0,connectType:"wifi",deviceExceptions:Ga,protocols:{network:Fa},calculateTime:{accelX:3200,accelY:500,thresholdAngle:175},processingArea:{base:{width:610,height:305,angle:0},data:[{key:p.LASER_PLANE,width:600,height:305,angle:0},{key:p.LASER_CYLINDER,angle:90,width:250,height:500,offsetX:-55,offsetY:-50,startX:250/2},{key:p.LASER_CONVEYOR_FEEDER,width:500,height:3165,offsetX:-50,startY:160},{key:p.FREE_PLANE,width:500,height:250,offsetX:-50},{key:p.PASS_THROUGH,width:500,height:190,angle:0,offsetX:-50},{key:p.CURVE_PROCESS,width:500,height:250,angle:0,offsetX:-50}]},supportUrls:{firmware:"https://s.xtool.com/doc/p2/firmware",faqUrl:"https://s.xtool.com/doc/p2/lower-machine-error",laserFaq:"",curveHelp:"https://s.xtool.com/doc/p2/curve-measure"},gcodeHooks:ka,process:ft,checkRules:Ha,deviceMetaData:ba},Me=ja,$a=ge({__name:"DeviceAction",props:{ext:null,isInProcessing:{type:Boolean},mode:null},setup(a){const e=a,{t:i}=Ue(),u=ve(!1),r=ve(!1),d=_e(()=>e.mode===S.CURVE_PROCESS),I=async()=>{const f=e.ext;u.value=!0;try{const T=await f.takeGlobalPhoto();f.appContext.updateBackImg(T),await P(!0),f.appContext.showMessage({contentI18nKey:"device.status.take_picture_success"})}finally{u.value=!1}},P=async(f=!1)=>{r.value=!0;const T=e.ext,t=await T.takeLocalPhoto(f);if(!t){r.value=!1;return}const s=T.getLocalOption();T.appContext.updateLocalImg(t,s),r.value=!1};return(f,T)=>(te(),me(R(Y),{wrap:!1,size:8,vertical:!0},{default:N(()=>[L(R(X),{ghost:"",type:"primary",size:"tiny",loading:u.value,disabled:u.value||R(d),onClick:I},{default:N(()=>[L(R(Y),{wrap:!1,size:4},{default:N(()=>[L(R(fe),{name:"refresh-camera"}),gt("span",null,k(R(i)("device.common.refresh")),1)]),_:1})]),_:1},8,["loading","disabled"]),L(R(X),{style:{width:"12.5rem"},ghost:"",type:"primary",size:"tiny",loading:r.value,disabled:r.value||a.isInProcessing||R(d),onClick:T[0]||(T[0]=()=>{P(!1)})},{default:N(()=>[B(k(R(i)("device.ext.take_local_pic")),1)]),_:1},8,["loading","disabled"])]),_:1}))}}),Ja=(a,e)=>{let i;try{i=JSON.parse(a)}catch(u){i=e,console.debug("[JSON.parse]",a,u)}return i};p.LASER_PLANE+"",p.LASER_CYLINDER+"",p.LASER_CONVEYOR_FEEDER+"",p.PASS_THROUGH+"",p.FREE_PLANE+"",p.CURVE_PROCESS+"";const qa=[{type:x.VECTOR_ENGRAVING,label:"line_engrave",color:16421416,fillColor:"#f9932b",isFill:!1,modes:[p.LASER_PLANE,p.LASER_CYLINDER,p.FREE_PLANE,p.PASS_THROUGH,p.SUPER_LASER_PLANE,p.LASER_CONVEYOR_FEEDER,p.CURVE_PROCESS],imageType:Te.VECTOR,components:a=>a?["ignore","processingType","materialType","power","speed"]:["ignore","processingType","materialType","power","speed","repeat"]},{type:x.FILL_VECTOR_ENGRAVING,label:"fill_engrave",color:16421416,fillColor:"#f9932b",isFill:!0,modes:[p.LASER_PLANE,p.LASER_CYLINDER,p.FREE_PLANE,p.PASS_THROUGH,p.SUPER_LASER_PLANE,p.LASER_CONVEYOR_FEEDER,p.CURVE_PROCESS],imageType:Te.VECTOR,components:a=>a?["ignore","processingType","materialType","power","speed","density","bitmapScanMode"]:["ignore","processingType","materialType","power","speed","repeat","density","bitmapScanMode"]},{type:x.VECTOR_CUTTING,label:"line_cut",color:10036991,fillColor:"#9928ff",isFill:!1,modes:[p.LASER_PLANE,p.FREE_PLANE,p.PASS_THROUGH,p.SUPER_LASER_PLANE,p.LASER_CONVEYOR_FEEDER],imageType:Te.VECTOR,components:a=>a?["ignore","processingType","materialType","power","speed","enableBreakPoint"]:["ignore","processingType","materialType","power","speed","repeat","enableBreakPoint"]},{type:x.BITMAP_ENGRAVING,label:"engrave",color:16421416,fillColor:"#f9932b",isFill:!0,modes:[p.LASER_PLANE,p.LASER_CYLINDER,p.FREE_PLANE,p.PASS_THROUGH,p.SUPER_LASER_PLANE,p.LASER_CONVEYOR_FEEDER,p.CURVE_PROCESS],imageType:Te.BITMAP,components:["ignore","processingType","materialType","power","speed","repeat","bitmapMode","density","bitmapScanMode"]},{type:x.KNIFE_CUTTING,label:"cut",color:2597107,fillColor:"#27a1f2",isFill:!1,modes:[p.KNIFE_CUT,p.PRINTER_KNIFE_CUT],imageType:Te.VECTOR,components:["ignore","processingType","materialType","cutPressure","speed","repeat"]}],Za=[{value:p.LASER_PLANE,label:"device.mode.laser_flat",iconName:"ext-laser-plane",components:["deviceMode","material","thickness"],processingTypes:[x.VECTOR_ENGRAVING,x.FILL_VECTOR_ENGRAVING,x.VECTOR_CUTTING,x.BITMAP_ENGRAVING]},{value:p.LASER_CYLINDER,label:"device.mode.laser_cylindrical",iconName:"ext-laser-cylinder",components:["deviceMode","material","focalLength","rotaryAttachmentType","catchMode"],processingTypes:[x.VECTOR_ENGRAVING,x.FILL_VECTOR_ENGRAVING,x.BITMAP_ENGRAVING],hasCylinder:!0},{value:p.FREE_PLANE,label:"device.mode.open_plane",iconName:"ext-pass-through",components:["deviceMode","material","focalLength"],processingTypes:[x.VECTOR_ENGRAVING,x.FILL_VECTOR_ENGRAVING,x.BITMAP_ENGRAVING,x.VECTOR_CUTTING]},{value:p.PASS_THROUGH,label:"device.mode.pass_through",iconName:"ext-pass-through",components:["deviceMode","material","focalLength"],processingTypes:[x.VECTOR_ENGRAVING,x.FILL_VECTOR_ENGRAVING,x.BITMAP_ENGRAVING,x.VECTOR_CUTTING]},{value:p.LASER_CONVEYOR_FEEDER,label:"device.mode.laser_conveyor_feeder",iconName:"ext-laser-conveyor-feeder",components:["deviceMode","material","focalLength"],processingTypes:[x.VECTOR_ENGRAVING,x.FILL_VECTOR_ENGRAVING,x.BITMAP_ENGRAVING,x.VECTOR_CUTTING]},{value:p.CURVE_PROCESS,label:"device.mode.curve_process",iconName:"ext-curve-process",components:["deviceMode","curve"],processingTypes:[x.VECTOR_ENGRAVING,x.FILL_VECTOR_ENGRAVING,x.BITMAP_ENGRAVING]}],es=70.9;p.LASER_PLANE+"",p.LASER_CYLINDER+"",p.FREE_PLANE+"",p.PASS_THROUGH+"",p.LASER_CONVEYOR_FEEDER+"";const ts=620,as=308,Ge=25,ot=415,nt=232,ss=10,is=10,rt=4,se=25,$e=-50,os=25,ns=-60,Ve=10,rs=55,cs=-30,ls=100,Je=9600,He=60;var le=(a=>(a.SILVERY="#E3E4E4",a.GRAY="#92A399",a.GREEN="#28BE44",a.RED="#E9224A",a.BLUE="#00B1FF",a))(le||{});const Tt={row:3,col:3},qe=()=>({laserStartPosition:void 0,laserEndPosition:void 0,irLedStartPosition:void 0,irLedEndPosition:void 0,densityArea:void 0,curveRange:Tt,densityPoints:[]}),us=()=>({curveData:{tempData:qe(),laserStartPosition:void 0,laserEndPosition:void 0,irLedStartPosition:void 0,irLedEndPosition:void 0,densityArea:void 0,curveRange:Tt,densityPoints:[],smoothness:3,tension:3,remeasurePoints:[],previewDisabled:!0,needDangerTip:!1}}),ds={minor:{angle:[0,30],color:[.454,.478,.478,.45]},medium:{angle:[30,45],color:[.454,.478,.478,.45]},large:{angle:[45,90],color:[.765,0,0,.7]}},ze="p2-selection-plugin",Ke="LASER_CONVEYOR_FEEDER_PLUGIN",Es={breakPointSize:.5,breakPointCount:2,breakPointPower:0},We={open:5,close:1},Ze={[p.CURVE_PROCESS]:"device.measure.curve_mode_tip",[p.LASER_CYLINDER]:"device.p2.cylinder_alive_tip",[p.LASER_CONVEYOR_FEEDER]:"device.p2.remove_slat_tip",[p.FREE_PLANE]:"device.p2.remove_slat_tip"},ps=ge({__name:"LightPathTestModal",props:{ext:null,show:{type:Boolean}},emits:["update:show"],setup(a,{emit:e}){const i=a,{t:u}=Ue(),r=ve(100),d=Ct(),I=()=>{r.value=100,e("update:show",!1)},P=async()=>{const T=await i.ext.apis.isIdle(),t=await i.ext.apis.isCover();if(!T)return d.warning(u("device.process.device_is_working")),!1;if(!t)return d.warning(u("device.setting.pulse_tips")),!1;i.ext.apis.command({params:{cmd:"M36 S300 T200 P34567"}})},f=async(T,t)=>{if(!await i.ext.apis.isIdle())return d.warning(u("device.process.device_is_working")),!1;T===0&&t===0?i.ext.apis.resetLaserHead():i.ext.apis.command({params:{cmd:`G91 X${T} Y${t} F${Je}`}})};return(T,t)=>(te(),me(R(oa),{show:a.show,title:T.$t("device.setting.light_path_title"),type:R(aa).DEFAULT,"hide-footer":"","disabled-scroll":!0,closable:"",onClose:I},{default:N(()=>[L(R(Y),{vertical:"",size:30,class:"modal-container"},{default:N(()=>[L(R(Y),{align:"center",class:"modal-title",wrap:!1},{default:N(()=>[L(R(ae),null,{default:N(()=>[B(k(T.$t("device.setting.light_path_tips_1")),1)]),_:1}),L(R(sa),{href:T.$t("device.setting.light_path_helper_link"),target:"_blank",style:{"white-space":"nowrap"}},{default:N(()=>[B(k(T.$t("device.setting.click_view")),1)]),_:1},8,["href"])]),_:1}),L(R(Y),{vertical:""},{default:N(()=>[L(R(ae),{class:"content-title"},{default:N(()=>[B(k(T.$t("device.setting.light_path_check")),1)]),_:1}),L(R(Y),{justify:"space-between",align:"center",wrap:!1},{default:N(()=>[L(R(ae),null,{default:N(()=>[B(k(T.$t("device.setting.light_path_warn")),1)]),_:1}),L(R(X),{type:"primary",style:{width:"100px"},onClick:P},{default:N(()=>[B(k(T.$t("device.setting.pulse")),1)]),_:1})]),_:1})]),_:1}),L(R(Y),{justify:"space-between",align:"center",size:30},{default:N(()=>[L(R(Y),{vertical:"",size:20,style:{width:"300px"}},{default:N(()=>[L(R(Y),{vertical:""},{default:N(()=>[L(R(ae),{class:"content-title"},{default:N(()=>[B(k(T.$t("device.setting.move_laser_head")),1)]),_:1}),L(R(ae),null,{default:N(()=>[B(k(T.$t("device.setting.laser_head_tips")),1)]),_:1})]),_:1}),L(R(Y),{size:30},{default:N(()=>[L(R(Y),{vertical:"",size:10},{default:N(()=>[L(R(ae),{class:"content-title"},{default:N(()=>[B(k(T.$t("device.setting.move_distance")),1)]),_:1}),L(R(na),{value:r.value,"onUpdate:value":t[0]||(t[0]=s=>r.value=s),min:1,max:100,step:1,precision:0,"show-button":!1},{suffix:N(()=>[B("mm")]),_:1},8,["value"])]),_:1})]),_:1})]),_:1}),L(R(ra),{class:"btn-grid","x-gap":"6","y-gap":"6",rows:3,cols:3},{default:N(()=>[L(R(Z)),L(R(Z),null,{default:N(()=>[L(R(X),{type:"primary",onClick:t[1]||(t[1]=s=>f(0,-r.value))},{default:N(()=>[L(R(fe),{name:"move-arrow-up"})]),_:1})]),_:1}),L(R(Z)),L(R(Z),null,{default:N(()=>[L(R(X),{type:"primary",onClick:t[2]||(t[2]=s=>f(-r.value,0))},{default:N(()=>[L(R(fe),{name:"move-arrow-left"})]),_:1})]),_:1}),L(R(Z),null,{default:N(()=>[L(R(X),{type:"primary",onClick:t[3]||(t[3]=s=>f(0,0))},{default:N(()=>[L(R(fe),{name:"move-center"})]),_:1})]),_:1}),L(R(Z),null,{default:N(()=>[L(R(X),{type:"primary",onClick:t[4]||(t[4]=s=>f(r.value,0))},{default:N(()=>[L(R(fe),{name:"move-arrow-right"})]),_:1})]),_:1}),L(R(Z)),L(R(Z),null,{default:N(()=>[L(R(X),{type:"primary",onClick:t[5]||(t[5]=s=>f(0,r.value))},{default:N(()=>[L(R(fe),{name:"move-arrow-down"})]),_:1})]),_:1}),L(R(Z))]),_:1})]),_:1})]),_:1})]),_:1},8,["show","title","type"]))}});const _s=Vt(ps,[["__scopeId","data-v-fcbff879"]]),As=ge({__name:"DeviceSettings",props:{ext:null,show:{type:Boolean},laserFaq:null,info:null,exportLog:{type:Function},checkUpdateFirmware:{type:Function},setDeviceName:{type:Function},setFillLight:{type:Function},setFlameAlarm:{type:Function},setOfflineModeEnable:{type:Function},changeCheckDrawer:{type:Function},changeAirPumpConfig:{type:Function},setPurifierTimeout:{type:Function},setMotionPowerCut:{type:Function},exportGcode:{type:Function}},emits:["close","showWifiConfig","showConnector","showUploadGcode"],setup(a,{emit:e}){const i=a,u=ve(!1),{t:r}=Ue(),d=()=>{e("close")},I=_e(()=>{const{show:P,info:f}=i,{cover:T,name:t,snCode:s,version:n,power:o,workTime:c,type:E,workTimes:l,ip:_,standByTime:h,isCheckDrawer:C,airPumpConfig:D,fillLight:y,purifierTimeout:w,motionPowerCut:A}=f;return{show:P,close:d,info:{url:T,name:t,button:{label:r("device.setting.change"),id:"changeDevice",action:()=>{d(),e("showConnector")}}},list:[{id:"base",label:r("device.setting.basic"),formData:[{id:"name",label:r("device.setting.name"),type:"input",attrs:{size:"small",maxlength:15,defaultValue:t,onBlur:v=>{i.setDeviceName(v.target.value)}}},{id:"powerGroup",label:r("device.setting.model"),type:"group",spaceProps:{justify:"space-between"},children:[{id:"power",type:"text",value:o>0?`${o} W`:r("device.setting.unrecognized_laser_model")}]},{id:"snCode",label:r("device.setting.serial_num"),type:"text",value:s},{id:"firmwareVersionGroup",label:r("device.setting.firmware_version"),type:"group",spaceProps:{justify:"space-between"},children:[{id:"version",type:"text",value:n},{id:"firmwareVersionButton",type:"button",label:r("device.setting.check_firmware"),attrs:{size:"small",style:{minWidth:"72px"},onClick:i.checkUpdateFirmware}}]},{id:"wifiConfigGroup",label:r("device.connect.wifi_config"),type:"group",spaceProps:{justify:"space-between"},children:[{id:"wifiConnect",type:"text",value:_},{id:"wifiConfigButton",type:"button",hidden:{}.VITE_PAD,label:r("device.connect.wifi_config_button_label"),attrs:{size:"small",style:{minWidth:"72px"},disabled:E==="WIFI",onClick:()=>{e("showWifiConfig")}}}]}]},{id:"workInfo",label:r("device.setting.work_info"),formData:[{id:"workTime",label:r("device.setting.working_time"),type:"text",value:`${c} ${r("device.setting.hour")}`},{id:"workTimes",label:r("device.setting.operating_times"),type:"text",value:`${l} ${r("device.setting.time")}`},{id:"standbyTime",label:r("device.setting.standby_time"),type:"text",value:`${h} ${r("device.setting.hour")}`},{id:"workLogsGroup",label:r("device.setting.work_log"),type:"buttonGroup",attrs:{spaceProps:{vertical:!1,align:"center",justify:"space-between"},options:[{id:"workLogsButton",type:"button",label:r("device.common.export"),attrs:{size:"small",onClick:i.exportLog}}]}}]},{id:"deviceSetting",label:r("device.setting.setting"),formData:[{id:"switch",label:r("device.setting.check_drawer"),type:"switch",value:C,attrs:{size:"medium",justify:"space-between",onUpdateValue:v=>{i.changeCheckDrawer(v)}}},{id:"purifierTimeout",label:r("device.p2.exhaust"),type:"switch",value:w!==We.close,attrs:{size:"medium",justify:"space-between",onUpdateValue:v=>{const M=v?We.open:We.close;i.setPurifierTimeout(M)}}},{id:"lightPathTest",label:r("device.setting.light_path_title"),type:"buttonGroup",tips:{style:"font-size: 16px",content:{button:{label:r("device.setting.click_view"),href:r("device.setting.light_path_helper_link")}}},attrs:{spaceProps:{vertical:!1,align:"center",justify:"space-between"},options:[{id:"lightPathTestButton",type:"button",label:r("device.setting.test"),attrs:{size:"small",onClick:()=>{u.value=!0,d()}}}]}},{id:"import",label:r("device.setting.import_gcode"),type:"buttonGroup",attrs:{spaceProps:{vertical:!1,align:"center",justify:"space-between"},options:[{id:"importButton",type:"button",label:r("device.setting.import"),attrs:{size:"small",onClick:()=>{e("showUploadGcode")}}}]}},{id:"fillLight",label:r("device.setting.fill_light_brightness"),type:"number",value:y,attrs:{size:"small",showButton:!1,suffix:"%",min:0,max:100,step:1,fractionDigits:0,updateValueOnInput:!1,onUpdateValue:i.setFillLight}},{id:"airPump",label:r("device.setting.air_pump_title"),type:"group",children:[{id:"airPumpEngrave",label:r("device.processing_type.engrave"),type:"number",value:D.engrave,attrs:{size:"small",showButton:!1,suffix:"%",min:30,max:100,step:1,fractionDigits:0,updateValueOnInput:!1,onUpdateValue:v=>{i.changeAirPumpConfig("engrave",v)}}},{id:"airPumpCut",label:r("device.processing_type.cut"),type:"number",value:D.cut,attrs:{size:"small",showButton:!1,suffix:"%",min:30,max:100,step:1,fractionDigits:0,updateValueOnInput:!1,onUpdateValue:v=>{i.changeAirPumpConfig("cut",v)}}}]},{id:"motionPowerCut",label:r("device.p2.low_power"),type:"number",value:Number((A??"").split("M37S")[1])||5,attrs:{size:"small",showButton:!1,suffix:"%",min:1,max:10,step:1,fractionDigits:0,updateValueOnInput:!1,onUpdateValue:v=>{i.setMotionPowerCut(`M37S${v}`)}}},{id:"exportGcodeGroup",label:r("device.setting.export_gcode"),type:"buttonGroup",attrs:{spaceProps:{vertical:!1,align:"center",justify:"space-between"},options:[{id:"exportGcodeButton",type:"button",label:r("device.common.export"),attrs:{size:"small",onClick:()=>i.exportGcode()}}]}}]}]}});return(P,f)=>(te(),ht("div",null,[L(R(ia),$t(Jt(R(I))),null,16),L(_s,{show:u.value,"onUpdate:show":f[0]||(f[0]=T=>u.value=T),ext:a.ext},null,8,["show","ext"])]))}}),ct={SET_HAS_CLOSE_IMG:"setHasCloseImg",MAIN_WINDOW_LOADED:"mainWindowLoaded",DESTROY_STAGE:"destroyStage",UPDATE_EDIT_MODE:"updateEditMode",SET_EDIT_FILE:"setEditFile",SET_EDIT_FILE_STATUS:"setEditFileStatus",ALIGN_GRAPHICS:"alignGraphics",BOOL_OPERATION:"boolOperation",LAYER_OPERATION:"layerOperation",FLIP_OPERATION:"flipOperation",SET_START_LOADING:"setStartLoading",SET_PROCESS_STATUS:"setProcessStatus",SET_PROCESS_VISIBLE:"setProcessVisible",SET_UPLOAD_GCODE_PROGRESS:"setUploadGcodeProgress",SET_CONTINUE_VISIBLE:"setContinueVisible",SET_BEFORE_START_MODAL_VISIBLE:"setBeforeStartModalVisible",SET_CALCULATING_GCODE:"setCalculatingGcode",SET_PROCESS_TOTAL_TIME:"setProcessTotalTime",SET_PROCESS_TIME:"setProcessTime",PROCESSING_STATUS:"processingStatus",PROCESSING_SHOW:"processingShow",DISCONNECT_SHOW:"disconnectShow",TASK_CANCEL_SHOW:"taskCancelShow",UPDATE_PROCESSING_STATE:"update_processing_state",RESET_PROCESSING_STATE:"reset_processing_state",SET_DISPLAY_PANEL_ATTRS:"setDisplayPanelAttrs",UPDATE_DISPLAY_ATTR_VALUE:"updateDisplayAttrValue",ENABLE_DISPLAY_PANEL:"enableDisplayPanel",DISABLE_DISPLAY_PANEL:"disableDisplayPanel",DISPLAY_TOGGLE_LOCK_SCALE:"displayToggleLockScale",RESET_DISPLAY_PANEL_ATTRS:"resetDisplayPanelAttrs",UPDATE_BATCH_CREATE_LINER_ATTRS:"updateBatchCreateLinerAttrs",UPDATE_BATCH_CREATE_RADIAL_ATTRS:"updateBatchCreateRadialAttrs",EDITOR_SETUP:"editorSetup",EDITOR_DESERIALIZE:"editorDeserialize",EDITOR_LAYER_DATA_UPDATE:"editor_layer_data_update",CURRENT_LAYER_UPDATE:"current_layer_update",EDITOR_LAYER_RENAME:"editor_layer_rename",EDITOR_CANVAS_CREATED:"editorCanvasCreated",EDITOR_ADD_CANVAS:"editorAddCanvas",EDITOR_REMOVE_CANVAS:"editorRemoveCanvas",EDITOR_CHANGE_CANVAS:"editorChangeCanvas",EDITOR_RENAME_CANVAS:"editorRenameCanvas",EDITOR_INSERT_CANVAS:"editorInsertCanvas",EDITOR_COPY:"editorCopy",EDITOR_CUT:"editorCut",EDITOR_UNDO:"editorUndo",EDITOR_REDO:"editorRedo",EDITOR_SELECT_ALL:"editorSelectAll",EDITOR_SELECT_SPEC_DISPLAYS:"EDITOR_SELECT_SPEC_DISPLAYS",LAYER_SELECTED_REMOVE:"layerSelectedRemove",EDITOR_SET_ZOOM:"editorSetZoom",EDITOR_DELETE_SELECTED:"editorDeleteSelected",EDITOR_INCREASE_SCALED:"editorIncreaseScaled",EDITOR_SET_SCALED_FIT:"editorSetScaledFit",EDITOR_CANVAS_TRANSLATE_SELECTED:"editorCanvasTranslateSelected",EDITOR_CANVAS_BATCH_CREATE_FINISH:"editorCanvasBatchCreateFinish",EDITOR_VALIDATE_SELECTED:"editorValidateSelected",EDITOR_SAVE_BG_IMG:"editorSaveBgImg",EDITOR_SAVE_LOCAL_BG_IMG:"editorSaveLocalBgImg",RESET_CURRENT_STATE:"resetCurrentState",UPDATE_CURRENT_EDITOR_STATE:"updateCurrentEditorState",UPDATE_EDITOR_SELECTED:"updateEditorSelected",UPDATE_INSERT_GRAPHIC_VISIBLE:"updateInsertGraphicVisible",UPDATE_IMPORT_EXT_RES_VISIBLE:"updateImportedExtResVisible",INSERT_GRAPHIC:"insertGraphic",UPDATE_FIT_SIZE_VISIBLE:"updateFitSizeVisible",UPDATE_FIT_SIZE_DATA:"updateFitSizeData",UPDATE_LOSS_FONTS_VISIBLE:"updateLossFontsVisible",UPDATE_LOSS_FONTS_PROCESS_MODE:"updateLossFontsProcessMode",UPDATE_LOSS_FONTS_PROMISES:"updateLossFontsPromises",UPDATE_LOSS_FONTS_USE_LEGACY:"updateLossFontsUseLegacy",UPDATE_BACKGROUND_CONTEXT:"updateBackgroundContext",UPDATE_BACKGROUND_VISIBILITY:"UPDATE_BACKGROUND_VISIBILITY",SWITCH_BACKGROUND_CONTEXT:"backgroundContext",UPDATE_OUTLINE_LOADING:"updateOutlineLoading",UPDATE_OUTLINE_VISIBLE:"updateOutlineVisible",CLEAR_OUTLINE:"clearOutline",CANCEL_OUTLINE_GENERAL:"cancelOutlineGeneral",SET_LANG_KEY:"setLangKey",SET_LOG_LEVEL:"setLogLevel",SET_BATCH_CREATE_MODAL_LINER_VISIBLE:"setBatchCreateModalLinerVisible",SET_BATCH_CREATE_MODAL_RADIAL_VISIBLE:"setBatchCreateModalRadialVisible",SET_UPLOAD_GCODE_MODAL_VISIBLE:"setUploadGcodeModalVisible",SET_WALK_BORDER_TIP_MODAL_VISIBLE:"setWalkBorderTipModalVisible",SET_AUTO_FOCUS_REMAIN_MODAL_VISIBLE:"setAutoFocusRemainModalVisible",SET_EXTEND_INSTALL_CALIBRATION_MODAL_VISIBLE:"setExtendInstallCalibrationModalVisible",PROJECT_UPDATE_NAME:"projectUpdateName",PROJECT_SAVE_CONFIRM:"projectSaveConfirm",PROJECT_SAVE_STATUS:"projectSaveStatus",PROJECT_FILE_PATH:"projectFilePath",PROJECT_ID:"projectID",PROCESS_IMAGE:"processImage",UPDATE_IMAGE_PROCESS_VISIBLE:"updateImageProcessVisible",UPDATE_IMAGE_PROCESS_TOOL:"updateImageProcessTool",SAVE_IMAGE_PROCESS:"saveImageProcess",CANCEL_IMAGE_PROCESS:"cancelImageProcess",SETTING_VISIBLE:"settingVisible",SETTING_UPDATE_UNIT:"settingUpdateUnit",SETTING_SNAPPING:"SETTING_SNAPPING",SETTING_UPDATE_THEME:"settingUpdateTheme",SETTING_UPDATE_STATE:"settingUpdateState",SET_FIRMWARE_TOOL_VISIBLE:"setFirmwareToolVisible",SET_CAMERA_CORRECT_VISIBLE:"setCameraCorrectVisible",MATERIAL_LOADING:"materialLoading",PROJECT_LOADING:"projectLoading",SET_HOTKEY:"setHotkey",SET_RNDIS_VERIFY_STATUS:"setRndisVerifyStatus",SET_CH340_VERIFY_STATUS:"setCh340VerifyStatus",UPDATE_PAGE_NAME:"updatePageName",UPDATE_DETAIL_ID:"updateDetailId",UPDATE_FONT_LIST:"updateFontList",CONNECTOR_VISIBLE:"connectorVisible",CONNECTED_DEVICE:"connectedDevice",ERROR_MODAL_VISIBLE:"errorModalVisible",CONNECT_CONFIRM_VISIBLE:"connectConfirmVisible",CONNECT_DEVICE_DATA:"connectDeviceData",ADD_ERROR_MODAL_LIST:"addErrorModalList",DEL_ERROR_MODAL_LIST:"delErrorModalList",ADD_ERROR_IGNORE_LIST:"addErrorIgnoreList",CLEAR_ERROR_MODAL_LIST:"clearErrorModalList",CLEAR_ERROR_IGNORE_LIST:"clearErrorIgnoreList",CURVE_MODAL_VISIBLE:"curveModalVisible",CURVE_MODAL_STEP:"curveModalStep",SET_CURVE_DENSITY_POSITION:"setCurveDensityPosition",DEVICE_SETTING_VISIBLE:"deviceSettingVisible",UPDATE_DEVICE_INFO:"updateDeviceInfo",UPDATE_DEVICE_FIRMWARE_INFO:"updateDeviceFirmwareInfo",UPDATE_ONLINE_MATERIAL_LIST:"updateOnlineMaterialList",UPDATE_CATEGORY_LIST:"updateCategoryList",UPDATE_MATERIAL_FORM_VALUES:"updateMaterialFormValues",UPDATE_MATERIAL_PAGINATION:"updateMaterialPagination",UPDATE_MATERIAL_MODAL_VISIBLE:"updateMaterialModalVisible",UPDATE_LOCAL_MATERIAL_LIST:"updateLocalMaterialList",UPDATE_PROCESSING_PARAM_LIST:"updateProcessingParamList",UPDATE_IMPORT_PROCESSING_PARAM_VISIBLE:"updateProcessingParamVisible",UPDATE_PROCESS_TYPES:"updateProcessTypes",UPDATE_WIFI_CONFIG_STATE:"updateWifiConfigState",IS_TAKING_PICTURE:"isTakingPicture",UPDATE_TAKING_PICTURE_PROGRESS:"updateTakingPictureProgress",UPDATE_TAKING_PICTURE_STATUS:"updateTakingPictureStatus",UPDATE_FIRMWARE_UPDATING_STATUS:"updateFirmwareUpdateStatus",UPDATE_MANUAL_PICTURE_STATUS:"updateManualPicture",UPDATE_FRAMING_HISTORY:"updateFramingHistory",MESSAGE_VISIBLE:"messageVisible",PUSH_MESSAGE:"pushMessage",DESTROY_MESSAGE:"destroyMessage",SET_KEEP_ALIVE_MESSAGE:"SET_KEEP_ALIVE_MESSAGE",DESTROY_ALL_MESSAGE:"DESTROY_ALL_MESSAGE",TAKING_PICTURE_PROGRESS_MESSAGE:"takingPictureProgressMessage",ANNOUNCEMENT_VISIBLE:"announcementVisible",SAVE_PROCESSING_PARAM:"SAVE_PROCESSING_PARAM",UPDATE_DATA_SOURCE:"UPDATE_DATA_SOURCE",SELECT_PROCESSING_PARAM:"SELECT_PROCESSING_PARAM",REMOVE_PROCESSING_PARAM:"REMOVE_PROCESSING_PARAM",UPDATE_SELECTED_ONLINE_MATERIAL_HANDLER:"UPDATE_SELECTED_ONLINE_MATERIAL_HANDLER"},ms=gt("div",null,null,-1),gs=ge({__name:"FinishHeader",props:{ext:null,handler:null},setup(a){const e=a,i=qt(),u=_e(()=>{const{currentIndex:d,splitPackages:I}=e.ext.splitProcessData;return d+1===I.length}),r=()=>{e.ext.splitProcessData.updateCurrentIndex(),u.value?(i.commit(ct.RESET_PROCESSING_STATE,[]),e.handler.goTo("preview")):(i.commit(ct.RESET_PROCESSING_STATE,[at.visible,at.totalTime]),e.handler.goTo("pushMaterial"))};return(d,I)=>(te(),me(R(Y),{size:"medium",justify:"space-between",align:"center",style:{height:"100%"}},{default:N(()=>[ms,L(R(ae),null,{default:N(()=>[B(k(d.$t("device.pass_through.process_finish_header",{currStep:a.ext.splitProcessData.currentIndex+1,totalStep:a.ext.splitProcessData.splitPackages.length})),1)]),_:1}),L(R(X),{type:"primary",onClick:r},{default:N(()=>[B(k(R(u)?d.$t("device.common.complete"):d.$t("device.process.start_processing")),1)]),_:1})]),_:1}))}}),hs={key:1},Rs=ge({__name:"PreviewHeader",props:{processingState:null,ext:null},emits:["close","uploadGCode","exportGcode"],setup(a,{emit:e}){const i=()=>{e("uploadGCode")},u=()=>{e("close")};return(r,d)=>(te(),me(R(Y),{size:"medium",justify:"space-between",align:"center",style:{height:"100%"}},{default:N(()=>{var I;return[((I=a.ext.splitProcessData)==null?void 0:I.currentIndex)===0?(te(),me(R(X),{key:0,onClick:u},{default:N(()=>[B(k(r.$t("device.common.back")),1)]),_:1})):(te(),ht("div",hs)),L(R(ae),null,{default:N(()=>[B(k(r.$t("device.process.process_preview")),1)]),_:1}),L(R(Y),null,{default:N(()=>[L(R(X),{disabled:!a.processingState.isCalculatedGCode,onClick:d[0]||(d[0]=P=>r.$emit("exportGcode"))},{default:N(()=>[B(k(r.$t("device.common.export")),1)]),_:1},8,["disabled"]),L(R(X),{type:"primary",disabled:!a.processingState.isCalculatedGCode,onClick:i},{default:N(()=>[B(k(r.$t("device.process.start_processing")),1)]),_:1},8,["disabled"])]),_:1})]}),_:1}))}}),Cs=ge({__name:"ProcessingDataForm",props:{ext:null,deviceInfo:null,elementValues:null,deviceValues:null,selectedTypes:null,handler:{type:Function}},setup(a){const e=a,i=(d,I)=>{if(d==="enableBreakPoint"&&!I){const{breakPointSize:P,breakPointCount:f,breakPointPower:T}=Es;e.handler("breakPointSize",P),e.handler("breakPointCount",f),e.handler("breakPointPower",T)}e.handler(d,I)},u=()=>{const d=e.deviceValues.mode,I=e.selectedTypes[0];return At(Lt,{imageType:I,modes:[d]})},r=_e(()=>{const d=e.deviceValues.mode===S.CURVE_PROCESS,I={[H.VECTOR_ENGRAVING]:["processIgnore","processingType","materialType","power","speed","repeat"],[H.FILL_VECTOR_ENGRAVING]:d?["processIgnore","processingType","materialType","power","speed","repeat","density"]:["processIgnore","processingType","materialType","power","speed","repeat","density","bitmapScanMode"],[H.VECTOR_CUTTING]:["processIgnore","processingType","materialType","power","speed","repeat"],[H.BITMAP_ENGRAVING]:d?["processIgnore","processingType","materialType","power","speed","repeat","density"]:["processIgnore","processingType","materialType","power","speed","repeat","bitmapMode","density","bitmapScanMode"]};return e.deviceValues.mode===S.LASER_CONVEYOR_FEEDER&&(I[H.VECTOR_CUTTING]=I[H.VECTOR_CUTTING].concat(["enableBreakPoint","breakPointSize","breakPointCount","breakPointPower"])),I});return(d,I)=>{const P=bt;return te(),me(P,Rt({ext:a.ext,"fields-map":R(r),"element-values":a.elementValues,"device-values":a.deviceValues,"device-info":a.deviceInfo,"selected-types":a.selectedTypes,"type-options":u,handler:i},d.$attrs),null,16,["ext","fields-map","element-values","device-values","device-info","selected-types"])}}}),Is={[H.VECTOR_CUTTING]:{power:1,speed:16,repeat:1,enableBreakPoint:!1,breakPointSize:.5,breakPointCount:2,breakPointPower:0},[H.VECTOR_ENGRAVING]:{power:1,speed:20,repeat:1},[H.FILL_VECTOR_ENGRAVING]:{power:1,speed:80,repeat:1,density:100,bitmapScanMode:"zMode"},[H.BITMAP_ENGRAVING]:{power:1,speed:80,repeat:1,bitmapMode:"Jarvis",density:100,bitmapScanMode:"zMode"}},Lt=[{value:H.VECTOR_ENGRAVING,label:"device.processing_type.line_engrave",color:16421416,fillColor:"#f9932b",isFill:!1,imageType:we.VECTOR,modes:[S.LASER_PLANE,S.LASER_CYLINDER,S.FREE_PLANE,S.PASS_THROUGH,S.SUPER_LASER_PLANE,S.LASER_CONVEYOR_FEEDER,S.CURVE_PROCESS]},{value:H.FILL_VECTOR_ENGRAVING,label:"device.processing_type.fill_engrave",color:16421416,fillColor:"#f9932b",isFill:!0,modes:[S.LASER_PLANE,S.LASER_CYLINDER,S.FREE_PLANE,S.PASS_THROUGH,S.SUPER_LASER_PLANE,S.LASER_CONVEYOR_FEEDER,S.CURVE_PROCESS],imageType:we.VECTOR},{value:H.VECTOR_CUTTING,label:"device.processing_type.line_cut",color:10036991,fillColor:"#9928ff",isFill:!1,modes:[S.LASER_PLANE,S.FREE_PLANE,S.PASS_THROUGH,S.SUPER_LASER_PLANE,S.LASER_CONVEYOR_FEEDER],imageType:we.VECTOR},{value:H.BITMAP_ENGRAVING,label:"device.processing_type.engrave",color:16421416,fillColor:"#f9932b",isFill:!0,modes:[S.LASER_PLANE,S.LASER_CYLINDER,S.FREE_PLANE,S.PASS_THROUGH,S.SUPER_LASER_PLANE,S.LASER_CONVEYOR_FEEDER,S.CURVE_PROCESS],imageType:we.BITMAP}],Ss={[S.LASER_PLANE]:{material:0,thickness:null,perimeter:null,diameter:null},[S.LASER_CYLINDER]:{material:0,thickness:null,focalLength:null,rotaryAttachmentType:"roller",perimeter:null,diameter:null},[S.LASER_CONVEYOR_FEEDER]:{material:0,thickness:null,focalLength:null,perimeter:null,diameter:null},[S.PASS_THROUGH]:{material:0,thickness:null,focalLength:null,perimeter:null,diameter:null},[S.FREE_PLANE]:{material:0,thickness:null,focalLength:null,diameter:null,perimeter:null},[S.CURVE_PROCESS]:{material:0,thickness:null,perimeter:null,diameter:null}},fs=[{icon:"ext-laser-plane",label:"device.mode.slats_flat",value:S.LASER_PLANE},{icon:"ext-laser-cylinder",label:"device.mode.laser_cylindrical",value:S.LASER_CYLINDER},{icon:"ext-pass-through",label:"device.mode.open_plane",value:S.FREE_PLANE},{icon:"ext-laser-conveyor-feeder",value:S.LASER_CONVEYOR_FEEDER,label:"device.mode.laser_conveyor_feeder"},{icon:"ext-curve-process",value:S.CURVE_PROCESS,label:"device.mode.curve_process"}],Ts=ge({__name:"ProcessingModeForm",props:{ext:null,canvasId:null,deviceValues:null,deviceInfo:null,handler:{type:Function},isInProcessing:{type:Boolean},disConnect:{type:Boolean}},setup(a){var w;const e=a,{t:i}=Ue(),u=Ct(),r=(w=e.ext.customData)==null?void 0:w.getModeData(e.canvasId,S.CURVE_PROCESS),d=r?r.curveData.previewDisabled:!0,I=ve(d),P={async preciseMeasurementBtn(){const{ext:A}=e,v=e.ext.dataSource.data[e.ext.dataSource.canvasId].mode;console.log("精准测量"),A.setKeepAliveMsg({content:"device.pass_through.select_precise_measure"});const{isFail:M,value:j,isSuccess:$,reason:K}=await A.accurateMeasure();if(A.setKeepAliveMsg({content:null}),M){const W=K||"device.measure_guide.auto_measurement_fail";u.error(i(W))}$&&(u.info(i("device.measure_guide.auto_measurement_success")),e.handler(v===S.LASER_PLANE?"thickness":"focalLength",j),await f()),A.setKeepAliveMsg({content:Ze[v]})},async quickMeasurementBtn(){console.log("快速测量");const{ext:A}=e,v=e.ext.dataSource.data[e.ext.dataSource.canvasId].mode,{value:M,y:j,isFail:$,isSuccess:K,reason:W}=await A.quickMeasure(v);if($){const q=W||"device.measure_guide.auto_measurement_fail";u.error(i(q))}if(K){u.info(i("device.measure_guide.auto_measurement_success")),e.handler(v===S.LASER_PLANE?"thickness":"focalLength",M);const{current:q}=A.getCurrentArea(v),vt=v===S.LASER_CYLINDER?q.width-j:0;return A.emit(Ut.UPDATE_PROCESSING_AREA,{canvasId:e.canvasId,option:{...q,startX:vt}}),f()}},mode(A){var $;const{ext:v,canvasId:M}=e;if(A!==S.CURVE_PROCESS){v.toggleCurveCanvasPlugin(v.dataSource,!1);const K=($=v.customData)==null?void 0:$.getModeData(M,S.CURVE_PROCESS);K&&(K.curveData=void 0),s(!0)}const j=T(A);e.handler("mode",{value:A,processingTypeList:j}),e.ext.delLocalPic(),f()},curvePreview(){const{ext:A}=e;A.emit(J.CURVE_PREVIEW)},async curveMeasurement(){var M;const{ext:A}=e;await((M=A.deviceChecker)==null?void 0:M.call(A,["connect","measuring","idle"]))&&(await A.beforeCurveMeasure(),A.emit(J.CURVE_MEASURE))},thickness(A){e.handler("thickness",A),f()},focalLength(A){e.handler("focalLength",A),f()}},f=async()=>{const A=e.ext,v=await A.calibrationGlobal();if(A.appContext.updateBackImg(v),A.lastMaskPosition){const M=await A.calibrationLocal(),j=A.getLocalOption();A.appContext.updateLocalImg(M,j)}},T=A=>{const v=A||e.deviceValues.mode;return At(Lt,M=>M.modes.includes(v))},t=(A,v)=>A in P?P[A](v):e.handler(A,v),s=A=>{I.value=A};Zt(()=>{var A;(A=e.ext.dataSource)==null||A.on(J.SET_CURVE_PREVIEW_DISABLED,s)}),ea(()=>{var A;(A=e.ext.dataSource)==null||A.off(J.SET_CURVE_PREVIEW_DISABLED,s)});const n=fs.map(({icon:A,label:v,value:M})=>({icon:A,label:v,value:M})),o=[S.LASER_PLANE,S.LASER_CYLINDER],c=[S.LASER_CYLINDER],E={name:"quickMeasurementBtn",icon:"quick",widget:"button",disabled:A=>!o.includes(A.mode)||e.disConnect||e.isInProcessing,widgetAttrs:{size:"small",title:"device.common.quick_measure",style:{"--n-icon-size":"15px"}}},l={name:"preciseMeasurementBtn",icon:"accurate",widget:"button",disabled:A=>c.includes(A.mode)||e.disConnect||e.isInProcessing,widgetAttrs:{size:"small",title:"device.common.precise_measure",style:{"--n-icon-size":"15px"}}},_={name:"thicknessGroup",label:"device.common.thickness",childs:[{name:"thickness",widget:"unitInput",widgetAttrs:{size:"small",max:se,min:0},style:{flex:1}},l,E]},h={name:"curveMeasurement",widget:"button",widgetAttrs:{label:"device.common.curve_measure",size:"small"},style:{flex:1}},C=_e(()=>({name:"curvePreview",widget:"button",widgetAttrs:{icon:"curve-preview",size:"small",title:"device.common.preview",disabled:I.value}})),D=_e(()=>({name:"curve",label:"device.common.curve",type:"group",childs:[h,C.value]})),y=_e(()=>{const A={name:"focalLengthGroup",label:"device.common.distance",type:"group",childs:[{name:"focalLength",widget:"unitInput",widgetAttrs:{size:"small",showButton:!1,max:e.deviceValues.mode===F.LASER_CYLINDER?se:se+Math.abs($e),min:0},style:{flex:1}},l,E]};return{[S.LASER_PLANE]:["mode","material",_],[S.LASER_CYLINDER]:["mode","material","rotaryAttachmentType","catchMode",A],[S.FREE_PLANE]:["mode","material",A],[S.PASS_THROUGH]:["mode","material",A],[S.LASER_CONVEYOR_FEEDER]:["mode","material",A],[S.CURVE_PROCESS]:["mode",D.value]}});return(A,v)=>{const M=Gt;return te(),me(M,Rt({ext:a.ext,"canvas-id":a.canvasId,"device-values":a.deviceValues,"mode-options":R(n),"device-info":a.deviceInfo,"fields-map":R(y),handler:t,"process-types":T},A.$attrs),null,16,["ext","canvas-id","device-values","mode-options","device-info","fields-map"])}}}),Ls={DeviceAction:$a,DeviceSetting:As,ProcessingModeForm:Ts,ProcessingDataForm:Cs},Ps=ta({loader:()=>Ht(()=>import("./movematerial-0deb905c.js"),["./movematerial-0deb905c.js","./xcs-vue-family-70642f71.js","./image-bad03660.js","./space-5433d955.js","./light-87cce264.js","./xcs-canvas-5c2592d6.js","./use-style-1280d407.js","./fade-in.cssr-8e3c8f09.js","./scrollbar-5a89bf25.js","../assets/index-83a10b2e.js","./index-55948043.js","./button-00b27872.js","./loading-b06a4834.js","./modal-c96d5b67.js","./setting.vue_vue_type_style_index_0_lang-315c55c2.js","./spin-afa417d1.js","./setting.vue_vue_type_script_setup_true_lang-0ee96bfb.js","./text-3b674000.js","./light-28752129.js","./checkbox-9495194d.js","./inputnumber-fff11604.js","./headers-069f588a.js","./divider-c77484ad.js","./grid-9031c693.js","./index-17630698.js","./image-c9c8ff8c.js","./use-message-cd8b9f19.js","./params-f8cc805d.js","./device-845a051d.js","./urlparam-4b6ed041.js"],import.meta.url)});function Ds(a,e){return e===F.PASS_THROUGH?[{name:"pushMaterial",useLayout:!1,placeholder:{component:Ps,props:{ext:a}}},{name:"preview",isFirst:!0,placeholder:{header:{component:Rs,props:{ext:a}}}},{name:"upload"},{name:"inProcessing"},{name:"finish",placeholder:{header:{component:gs,props:{ext:a}}}}]:[]}function ys(){return new Worker(""+new URL("../assets/successiveProcessWorker-6bf4fc65.js",import.meta.url).href)}class Xe extends pt{constructor(){super(ys)}async matchImage(e){const i=performance.now(),u=await this.request({type:"match",data:e});if(!u)return null;console.log({res:u});const r=performance.now();return console.log(["=> work time",r-i]),JSON.parse(u)}async splitSvg(e){const i=performance.now(),u=await this.request({type:"splitSvg",data:e}),r=performance.now();return console.log(["=> work time",r-i]),console.log({res:u}),JSON.parse(u)}async splitBitmap(e){const i=performance.now(),u=await this.request({type:"splitBitmap",data:e}),r=performance.now();return console.log(["=> work time",r-i]),console.log({res:u}),JSON.parse(u)}}var dt,Et;const lt=(Et=(dt=window.MeApi)==null?void 0:dt.fileHelper)==null?void 0:Et.writeImageDataToFile.bind(window.MeApi.fileHelper);class vs{constructor(e){O(this,"processData");O(this,"fragmentHeight",190);O(this,"splitList",[]);O(this,"splitPackages",[]);O(this,"currentIndex",0);O(this,"offsetX",0);O(this,"offsetY",0);O(this,"startX",0);O(this,"startY",0);O(this,"pushX",0);O(this,"pushY",0);O(this,"canvasImgUrl","");O(this,"splitLines",[]);this.processData=e,this.offsetX=xe.clone(e.params.offset.x),this.offsetY=xe.clone(e.params.offset.y),this.startX=xe.clone(e.totalSize.x),this.startY=xe.clone(e.totalSize.y),console.log("需要分段的数据",e)}updateCurrentIndex(){this.currentIndex++}order(e){const i=[];for(const u in e){const r=e[u],{list:d,params:I}=r;for(const P of d)i.push({...P,params:{...I,groupKey:u}});e[u].list=[]}return i.sort((u,r)=>u.y-r.y)}async spliteVector(e){const i=new Xe,u=await i.splitSvg({source:e.source,fragmentHeight:this.fragmentHeight,y:e.y});i.destroy();const{coordinate:r,paths:d}=u;for(const I in d){const P=Number(I),f=d[P],T=r[P*2+1]+20;this.splitLines.push(T),this.splitList.push({...e,source:f,x:P===0?e.x:r[(P-1)*2]+160,y:P===0?e.y:r[(P-1)*2+1]+20,endPoint:{x:r[P*2]+160,y:T}})}}async splitBitmap(e){const i=da(e.source),{oWidth:u,oHeight:r,x:d,y:I,width:P,height:f}=e,T=new Xe,{result:t}=await T.splitBitmap({grayData:i,oWidth:u,oHeight:r,startX:d,startY:I,endX:d+P,endY:I+f,splitHeight:this.fragmentHeight});T.destroy();let s=0,n=0,o=0;const c=f/r;for(let _=0;_<t.length;_+=3){const h=Number(_);n=t[h];const D=e.source.slice(s*e.oWidth*4,n*e.oWidth*4),y=n-s,w=e.y+o,A=y*c;o=o+A;const v=t[h+2]+20;this.splitList.push({...e,y:w,height:A,oHeight:y,source:D,endPoint:{x:t[h+1]+160,y:v}}),this.splitLines.push(v),s=n}const E=e.source.slice(s*e.oWidth*4),l=e.y+e.height;this.splitList.push({...e,y:I+o,height:(e.oHeight-s)*c,oHeight:e.oHeight-s,source:E,endPoint:{x:e.x+e.width,y:l}}),this.splitLines.push(l)}async calculate(){const e=this.order(this.processData.printData);for(const i of e)i.params.isVector?await this.spliteVector(i):await this.splitBitmap(i);console.log(this.splitList.length,this.splitList),this.pack(this.splitList)}filterLines(e){const i=[];let u=Number.MIN_SAFE_INTEGER,r=-1;for(const d in e){for(const I in e){const P=Number(I),f=e[P],T=i.length*this.fragmentHeight,t=(i.length+1)*this.fragmentHeight;f>u&&f<=t&&f>T&&(u=f,r=P)}r!==-1&&(i.push(e[r]),r=-1,u=Number.MIN_SAFE_INTEGER)}return i}pack(e){const i=this.filterLines(this.splitLines);for(const u of i){const r=[];for(const d of e){const{endPoint:{y:I}}=d;d.isSorted||I<=u&&(d.isSorted=!0,r.push(d))}this.splitPackages.push(r)}console.log(this.splitPackages)}getEndPointByIndex(e){const i=this.splitPackages[e];let u=Number.MAX_SAFE_INTEGER,r=-1;for(const d in i){const I=Number(d),f=i[I].endPoint,{y:T}=f;T<u&&(u=T,r=I)}return i[r]}saveImgToFile(e,i){lt&&lt(`./match-${i}.jpg`,{data:e.data,width:e.width,height:e.height})}clean(){for(const e in this.processData.printData){const i=this.processData.printData[e];i.list=[]}}getFragment(e=this.currentIndex){this.clean();const i=this.processData.printData,u=this.processData.params,r=this.splitPackages[e];for(const d of r){const I=d.params.groupKey;i[I].list.push(d)}return u.offset.x=this.offsetX-this.pushX,u.offset.y=this.offsetY-this.pushY,{printData:i,params:u}}async matchImage(e,i){if(e&&i){this.saveImgToFile(e,"打印结束位置"),this.saveImgToFile(i,"推动材料后的红点位置");const u=new Xe,r=await u.matchImage({preRgbaArr:e.data,currRgbaArr:i.data});return u.destroy(),r}}}const{PASS_THROUGH:Os,FREE_PLANE:Ns,LASER_CONVEYOR_FEEDER:Pt,CURVE_PROCESS:ws,LASER_PLANE:xs,LASER_CYLINDER:ut}=F;class et{constructor(e,i,u=!0){O(this,"_mode");O(this,"_val");O(this,"_isApi");this._mode=e,this._val=i,this._isApi=u}get isRemoveFloor(){return[Os,Ns,ws,Pt,ut].includes(this._mode)}get isEmpty(){return zt(this._val)||mt(this._val)}get value(){if(!this.isEmpty)return this.isRemoveFloor&&this._isApi?se-this._val:this._val}get focalLen(){if(!this.isEmpty)return this.isRemoveFloor&&!this._isApi?Ge-se+this._val:Ge-this._val}get correct(){if(!this.isEmpty)return this.isRemoveFloor&&!this._isApi?se-this._val:this._val}get isValid(){let e=this.isRemoveFloor?$e:0;return this._mode===ut&&(e=0),this._val<e?{result:!1,reason:"device.measure.measure_is_larger_then_max"}:this.isRemoveFloor?{result:$e<=this._val&&this._val<=se}:{result:0<=this._val&&this._val<=se}}}const tt=a=>{const{data:e,mode:i}=a,u=i===xs?e[i].thickness:e[i].focalLength,r=new et(i,u,!1),d=i===Pt?-40:3;return{correct:r.correct??d,focalLen:r.focalLen}},{LASER_CYLINDER:Ms,LASER_PLANE:Vs,LASER_CONVEYOR_FEEDER:bs,FREE_PLANE:Gs,PASS_THROUGH:Us}=F;class Bs extends ca{constructor(){super(...arguments);O(this,"airPumpConfig",{})}parse(){const{mode:i}=this.deviceData,{focalLen:u}=tt(this.deviceData),r=this.config.processingArea.base.height,d=super.parse();d.focalLen=u,d.airPumpConfig=this.airPumpConfig;const{width:I=0,height:P=0}=this.config.processingArea.data.find(f=>f.key===i)||{};switch(d.size={w:I,h:P},this.deviceData.mode){case Vs:case Us:case Gs:return d.id=0,d.funcName=Fe.plane,d.keys=[he.x,he.y],d;case Ms:return d.id=3,d.swap_xy=1,d.start.x=(d.start.x||0)+d.offset.x,d.start.y=Math.abs(d.start.x-r),d.rotateMultiple=Number((d.rotateMultiple/-.6).toFixed(1)),d.funcName=Fe.cylinder,d.funcArgs=[d.start.y,d.start.x,d.rotateMultiple],d.keys=[he.u,he.x],d;case bs:return d.id=5,this.deviceData.data[i]={...this.deviceData.data[i],perimeter:es},d.start.y=this.processingArea.startY||0,d.offset.y=-(d.start.y+d.offset.y),d.rotateMultiple=-3.02,d.funcName=Fe.feeding,d.funcArgs=[d.rotateMultiple],d.keys=[he.x,he.u],d}return d}}const{PASS_THROUGH:ks}=F,Ie=Bt(),Se="device.status.taking_picture",Fs=!0;function Qs(a){var e,i,u,Dt,d,yt,P;return P=class extends a{constructor(...t){super(Me,...t);z(this,u);z(this,d);O(this,"processingTypes",qa);O(this,"processingModes",Za);O(this,"lastMaskPosition");z(this,e,void 0);z(this,i,!1);O(this,"splitProcessData");O(this,"curveWorker");O(this,"customData",new wt);O(this,"cacheData");O(this,"curveMaxCol",Math.ceil(ot/Ve));O(this,"curveMaxRow",Math.ceil(nt/Ve));O(this,"curvature",ds);O(this,"deviceDataValues",Ss);O(this,"elementDataValues",Is);O(this,"toggleCurveCanvasPlugin",(t,s)=>{const n=t.canvasManager.canvas;let o=n.getPluginByName(ze);return s?(o||(o=new Ta(ze)),n.registerPlugin(o)):(console.log("[ 插件销毁 ] >"),n.unRegisterPlugin(o),o=null),o});this.cacheData=new fa(this.apis),this.addonStatus={drawerStatus:"CLOSE",isCheckDrawer:this.isCheckDrawer}}get getProcessingTypes(){const s=this.deviceData.data.value.get(this.canvasId);let n=!1;return s&&(n=s.mode===p.LASER_CONVEYOR_FEEDER),this.processingTypes.map(o=>({...o,components:Pe(o.components)?o.components(n):o.components}))}getProcessingSteps(t){return Ds(this,t)}queryProcessingRightSideBarCom(t){const{rightSideBar:s={}}=this.config.process;return s[t]}get ui(){return Ls}get projectData(){const{power:t}=this.deviceInfo??{},s=Kt({id:Me.productID,power:t,data:this.deviceData.data.value,materialList:[]});return console.log(["=> getProjectData",s]),s}get airPumpConfig(){var o;const t=(o=this.deviceInfo)==null?void 0:o.mac,s={engrave:100,cut:100};if(!t)return s;const n=Ie.get(Ce);return n&&n[t]&&n[t].airPumpConfig||s}set airPumpConfig(t){var n;const s=(n=this.deviceInfo)==null?void 0:n.mac;if(s){const o=Ie.get(Ce,{[s]:{airPumpConfig:{engrave:100,cut:100}}});o[s]={...o[s],airPumpConfig:t},Ie.set(Ce,o)}}get isCheckDrawer(){var n;const t=(n=this.deviceInfo)==null?void 0:n.mac;if(!t)return!0;const s=Ie.get(Ce);return s&&s[t]&&!mt(s[t].drawerCheck)?s[t].drawerCheck:!0}set isCheckDrawer(t){var n;const s=(n=this.deviceInfo)==null?void 0:n.mac;if(s){const o={[s]:{drawerCheck:!0}},c=Ie.get(Ce,o);c[s]={...c[s],drawerCheck:t},Ie.set(Ce,c),this.addonStatus={...this.addonStatus,isCheckDrawer:t}}}initProcessParams(t){this.processParams=new Bs(t)}doUpdateFirmware(){throw new Error("Method not implemented.")}async uploadGCode(t){const{gcode:s,isFullPath:n=!1,onProgress:o}=t||{},c=await this.builder.gcode(),E=s||c;if(this.uploadGcodeHelper)try{const{baseUrl:l,url:_,params:h={}}=await this.apis.uploadGcode({method:"info"}),C=`${l}${_}${ua(h)}`;return(await super.uploadByBuilder({url:C,path:E,options:{isFullPath:n,onProgress:y=>{Pe(o)&&o(y)},onCancel:y=>{b(this,e,y)}}})).code===0?Promise.resolve(!0):Promise.reject(!1)}catch(l){return console.log("uploadGcode by builder error",l),Promise.reject(!1)}else{const{signal:l,cancel:_}=kt();return b(this,e,_),this.apis.uploadGcode({data:E,signal:l,onUploadProgress:h=>{const C=h.loaded/h.total;Pe(o)&&o(C)}})}}cancelUploadGCode(){Pe(V(this,e))&&V(this,e).call(this)}async pauseProcessing(){await this.apis.pausePrint(),await this.whenReceiveCmd(Q.PAUSE_PROCESS)}async cancelProcessing(){await this.apis.cancelPrint(),await this.whenReceiveCmd(Q.CANCEL_PROCESS)}async turnLocalIrLed(t){t?await this.apis.turnOnLocalIrLed():await this.apis.turnOffLocalIrLed()}setKeepAliveMsg(t){this.emit(J.SET_KEEP_ALIVE_MESSAGE,t)}async takeGlobalPhoto(){console.time("takeGlobalPhoto"),await this.apis.turnLight();const t=await this.apis.captureGlobalImage({onDownloadProgress:n=>{const o=Math.floor(n.loaded/n.total*100);this.appContext.showMessage({type:"info",key:Se,contentI18nKey:Se,args:{percent:o},options:{duration:0}})}});this.appContext.destroyMessage(Se),this.cacheData.globalImageData=await Re(t);const s=await this.calibrationGlobal(this.cacheData.globalImageData);return console.timeEnd("takeGlobalPhoto"),s}async takeLocalPhoto(t=!1){var n;const s=(n=this.dataSource)==null?void 0:n.currentDeviceData;return new Promise(o=>{var l,_;if(!this.lastMaskPosition&&t===!0)return o(null);const c=s.mode,E=Object.assign({},za,Xa[c]);t===!1&&(this.setKeepAliveMsg({content:"device.pass_through.select_take_local_img"}),this.emit(J.MARK_POSITION,E)),this.once(J.MARK_POSITION_DONE,async h=>{if(this.setKeepAliveMsg({content:Ze[c]}),h.isCancel){o(null);return}const{x:C,y:D}=h;console.log("近景拍照捕获画布位置",`x:${C}`,`y:${D}`);const y=ke(this,u,Dt).call(this,{x:C,y:D,mode:c,width:E.width,height:E.height});console.log("近景拍照激光头移动位置",`x:${y.x}`,`y:${y.y}`),await this.apis.turnLight(),await this.apis.setLaserHead({data:{x:y.x,y:y.y}});const w=await this.apis.captureLocalImage({onDownloadProgress:v=>{const M=Math.floor(v.loaded/v.total*100);this.appContext.showMessage({type:"info",key:Se,contentI18nKey:Se,args:{percent:M},options:{duration:0}})}});this.appContext.destroyMessage(Se),this.cacheData.localImgData=await Re(w),await this.apis.resetLaserHead(),this.cacheData.localImgData=await Re(w);const A=await this.calibrationLocal(this.cacheData.localImgData);this.appContext.showMessage({contentI18nKey:"device.status.take_picture_success"}),this.lastMaskPosition={x:C,y:D},o(A)}),t&&this.emit(J.MARK_POSITION_DONE,{x:(l=this.lastMaskPosition)==null?void 0:l.x,y:(_=this.lastMaskPosition)==null?void 0:_.y,isCancel:!1,mode:c})})}delLocalPic(){this.lastMaskPosition=void 0,this.cacheData.localImgData=void 0,this.appContext.updateLocalImg(null,null)}getLocalOption(){var l;const t=(l=this.dataSource)==null?void 0:l.currentDeviceData.mode,{x:s,y:n}=this.lastMaskPosition||{x:0,y:0},{current:{angle:o}}=this.getCurrentArea(t);let c=s;return o===90&&(c=s+Ae.height),{angle:o,width:Ae.width,height:Ae.height,x:c,y:n,boundColor:16777215,boundAlpha:.5}}async calibrationLocal(t=this.cacheData.localImgData){var l;const s=(l=this.dataSource)==null?void 0:l.currentDeviceData,{correct:n}=tt(s),o=await this.cacheData.getLocalCalibrationData(),{width:c,height:E}=Ye.localCorrectImgSize;return this.cacheData.cameraTool.correctedImage({rgbaArr:t.data,points:o,correctValue:n,correctW:c,correctH:E,isLocal:!0})}async calibrationGlobal(t=this.cacheData.globalImageData){var l;const s=(l=this.dataSource)==null?void 0:l.currentDeviceData,{correct:n}=tt(s),o=await this.cacheData.getGlobalCalibrationData(),{width:c,height:E}=Ye.globalCorrectImgSize;return this.cacheData.cameraTool.correctedImage({rgbaArr:t.data,points:o,correctValue:n,correctW:c,correctH:E,isLocal:!1})}resetLaserHead(){this.apis.resetLaserHead(),this.apis.turnOffLocalIrLed()}async moveLaserPosition(t,s=ls,n={}){if(s===0)return;const{x:o=0,y:c=0}=await this.apis.getLaserPosition(),E={[Le.TOP]:{x:o,y:c-s},[Le.BOTTOM]:{x:o,y:c+s},[Le.LEFT]:{x:o-s,y:c},[Le.RIGHT]:{x:o+s,y:c}};let l=!1;const{minX:_=0,maxX:h=ts,minY:C=0,maxY:D=as}=n;let y=E[t].x;y<_?y=_:y>h&&(y=h,l=!0);let w=E[t].y;return w<C?w=C:w>D&&(w=D,l=!0),await this.apis.setLaserHead({data:{x:y,y:w,s:0,f:Je}}),await this.waitLaserHeadReach(He,{x:y,y:w,z:0}),{hasMax:l}}async waitLaserHeadReach(t,s){let n=!1;for(;!n;){if(!t)return Promise.resolve(!1);t--;try{const o=await this.apis.getLaserPosition(),{x:c,y:E,z:l}=o,{x:_,y:h,z:C}=s,D=Math.abs(_-c)<.1,y=Math.abs(h-E)<.1,w=Math.abs(C-l)<.1;D&&y&&w&&(n=!0)}catch{return Promise.resolve(!1)}n||await Qe(500)}return Promise.resolve(!0)}accurateMeasure(){return new Promise(t=>{var o;const s=(o=this.dataSource)==null?void 0:o.currentDeviceData.mode,n=Object.assign({},Ka,Wa[s]||{});this.emit(J.MARK_POSITION,n),this.once(J.MARK_POSITION_DONE,async({x:c,y:E,isCancel:l})=>{if(l)return t({isCancel:!0});const{current:{offsetX:_=0}}=this.getCurrentArea(s),h={x:c-55+Math.abs(_),y:E};try{await this.apis.setLaserHead({data:{x:h.x,y:h.y}}),await this.apis.offLight(),await this.apis.turnOnLocalIrLed(),await Qe(300);const C=await this.apis.captureLocalImage();await this.apis.turnOffLocalIrLed(),await this.apis.turnLight(),await this.apis.resetLaserHead();const D=await this.cacheData.getLocalCalibrationData(),y=await this.cacheData.getLocalIrData(),w=await Re(C),A=await this.cacheData.cameraTool.measurement({rgbaArr:w.data,points:D,isLocal:!0,irText:y}),{z:v}=A,M=new et(s,v,!0),{result:j,reason:$}=M.isValid;t(j?{isSuccess:!0,value:M.value}:{isFail:!0,reason:$})}catch{t({isFail:!0})}})})}async quickMeasure(t){await this.apis.resetLaserHead(),await this.apis.offLight(),await this.apis.turnOnGlobalIrLed(),await Qe(300);const s=await this.apis.captureGlobalImage();this.apis.turnOffGlobalIrLed(),this.apis.turnLight();const n=await this.cacheData.getGlobalCalibrationData(),o=await this.cacheData.getGlobalIrData(),c=await Re(s),E=await this.cacheData.cameraTool.measurement({rgbaArr:c.data,points:n,isLocal:!1,irText:o}),{z:l,y:_}=E,h=new et(t,l,!0),{result:C,reason:D}=h.isValid;return C?{isSuccess:!0,value:h.value,y:_}:{isFail:!0,reason:D}}exportLog(){return super.exportLog("xcs_p2_log.gz")}async getCurrentStatus(){var l,_,h;const t=await this.apis.queryRunningStatus(),s=(l=t==null?void 0:t.curMode)==null?void 0:l.mode,n=(_=t==null?void 0:t.curMode)==null?void 0:_.subMode,o=((h=t==null?void 0:t.curAlarmInfo)==null?void 0:h.alarm)||[],c=`${s}.${n}`;return{status:{"P_IDLE.":"IDLE","Work.workReady":"WORK_PREPARED","Work.working":"WORK_STARTED","Work.workPause":"WORK_PAUSED","P_WORK_DONE.":"WORK_FINISHED"}[c],alarmArr:o}}async onConnected(){this.cacheData.apis=this.apis,await this.apis.setExposure();const t=await this.takeGlobalPhoto();this.appContext.updateBackImg(t),this.appContext.showMessage({contentI18nKey:"device.status.take_picture_success"});const{status:s,alarmArr:n}=await this.getCurrentStatus();Q.IDLE===s&&this.appContext.resetProcessingState(),this.deviceCmdParsing(JSON.stringify({module:ye.STATUS_CONTROLLER,type:s})),n.forEach(c=>{this.deviceCmdParsing(JSON.stringify(c))}),["WORK_STARTED","WORK_PAUSED"].includes(s)||this.resetLaserHead();const o=await this.apis.drawerStatus();this.addonStatus={...this.addonStatus,drawerStatus:o?"CLOSE":"OPEN",isCheckDrawer:this.isCheckDrawer}}handleDeviceFormValueChanged(t,s){var o;this.setKeepAliveMsg({content:Ze[s.mode]});const n=(o=this.dataSource)==null?void 0:o.canvasManager.canvas;if(n){if(s.mode===p.LASER_CONVEYOR_FEEDER){let c=n.getPluginByName(Ke);c||(c=new La(Ke),n.registerPlugin(c));const{current:E}=this.getCurrentArea(p.LASER_CONVEYOR_FEEDER),{width:l,startY:_=0}=E,{LIMIT_TYPE:{fillAlpha:h,fillColor:C}}=la;c.updateMask({fillColor:C,fillAlpha:h,width:l,height:_})}else n.unRegisterPluginByName(Ke);s.mode===p.CURVE_PROCESS?this.appContext.updateBackVisible(!1):(t.mode===p.CURVE_PROCESS&&this.appContext.updateBackVisible(!0),n.unRegisterPluginByName(ze))}}deviceCmdParsing(t){const s=Ja(t,{}),{module:n="",info:o="",type:c=""}=s;t=c||t;const E=[n,c,o].join("."),l=Me.deviceExceptions&&Me.deviceExceptions[E];l&&(console.log("===设备报错===",l.code),this.emit(St.Error,l)),n===ye.DRAWER&&(this.addonStatus={...this.addonStatus,drawerStatus:t}),n===ye.GAP&&this.toggleGap(c),n===ye.STATUS_CONTROLLER&&ke(this,d,yt).call(this,t)}toggleGap(t){var s,n,o;if(t==="CLOSE"){const E=((s=this.dataSource)==null?void 0:s.currentDeviceData).mode,l=this.customData.getData(this.canvasId);if(E===p.CURVE_PROCESS&&l&&((o=(n=l[E])==null?void 0:n.curveData)==null?void 0:o.previewDisabled)===!1){this.appContext.showMessage({contentI18nKey:"device.measure.move_tip"});return}this.appContext.showMessage({type:"info",options:{duration:5e3,keepAliveOnHover:!0},render:{textI18nKey:"device.status.manual_picture",link:{labelI18nKey:"device.status.immediately_refresh",onClick:async()=>{const _=await this.takeGlobalPhoto();this.appContext.updateBackImg(_);const h=await this.takeLocalPhoto(!0);if(h){const C=this.getLocalOption();this.appContext.updateLocalImg(h,C)}this.appContext.showMessage({contentI18nKey:"device.status.take_picture_success"})}}}})}}async checkProcessData({canvasData:t,centralAxisPosition:s,isWalkBorder:n=!1,dataSource:o}){var l;const c=o.currentDeviceData.mode;this.processParams.airPumpConfig=this.airPumpConfig;const E=await super.checkProcessData({canvasData:t,centralAxisPosition:s,isWalkBorder:n,dataSource:o});if(c===ks&&!E){this.splitProcessData=new vs(this==null?void 0:this.printInfo),await this.splitProcessData.calculate();const{printData:_,params:h}=this.splitProcessData.getFragment();this.printInfo.printData=_,this.printInfo.params=h}if(c===F.CURVE_PROCESS){const _=(l=this.customData)==null?void 0:l.getModeData(this.canvasId,p.CURVE_PROCESS);if(!(_!=null&&_.curveData))return{type:G.text,text:"device.measure.curve_process_mode_data_tip"}}return E}async buildProcessGcode(t){return t===p.CURVE_PROCESS?(this.curveWorker||await this.getCurveData(),this.buildCurveGcode()):super.buildProcessGcode(t)}dispose(){var t;super.dispose(),(t=this.curveWorker)==null||t.destroy(),this.curveWorker=void 0}getCurrentArea(t){var c,E,l,_,h,C;const{base:s,current:n}=super.getCurrentArea(t),o=(E=(c=this.dataSource)==null?void 0:c.currentDeviceData)==null?void 0:E.mode;if(o===p.CURVE_PROCESS){const D=this.customData.getData(this.canvasId);if(D&&((_=(l=D[o])==null?void 0:l.curveData)!=null&&_.densityArea)){const y=(C=(h=D[o])==null?void 0:h.curveData)==null?void 0:C.densityArea,{offsetX:w=0,offsetY:A=0}=n;return{base:s,current:{...n,startX:y.x+w,startY:y.y+A,width:y.width,height:y.height}}}}return{base:s,current:n}}async deviceChecker(t){const s={connect:{func:()=>this.connected,msg:"device.connect.connect_break"},measure_connect:{func:()=>this.connected,msg:"device.measure.measure_fail_disconnect"},idle:{func:this.apis.isIdle,msg:"device.measure.busy_tip"},measuring:{func:async()=>!await this.apis.isMeasuring(),msg:"device.measure.exit_measure"},curveBounds:{func:this.correctCurveBounds,msg:"device.measure.measure_min_error"}};let n=!0;for(let o=0;o<t.length;o++){if(!s[t[o]])continue;let c;try{c=await s[t[o]].func.bind(this)()}catch{this.appContext.showMessage({contentI18nKey:"device.connect.connect_break"});return}if(!c){n=!1,this.appContext.showMessage({contentI18nKey:s[t[o]].msg});break}}return n}async beforeCurveMeasure(){var n;await this.apis.turnLight(),await this.apis.turnOnLocalIrLed();const t=this.customData.getData(this.canvasId),s=p.CURVE_PROCESS;if(!t||!((n=t[s])!=null&&n.curveData)){this.customData.setModeData(this.canvasId,s,us());return}t[s].curveData.tempData=qe(),t[s].curveData.remeasurePoints=[]}async afterCurveMeasure(){await this.apis.resetLaserHead(),await this.apis.turnOffLocalIrLed(),await this.apis.turnLight(),await this.apis.modeSwitch({data:{state:"P_IDLE"}})}async resetCurveLaserHead(){var s;if(!await((s=this.deviceChecker)==null?void 0:s.call(this,["connect","idle"])))return!1;await this.apis.resetLaserHead(),await this.waitLaserHeadReach(He,{x:0,y:0,z:0})}async moveCurveLaserPosition(t,s){var o;return await((o=this.deviceChecker)==null?void 0:o.call(this,["connect","idle"]))?await this.moveLaserPosition(t,s,{maxX:ot,maxY:nt}):!1}async curveMeasureBoundsPoint(t){await this.apis.offLight(),await this.apis.turnOnLocalIrLed();const s=await this.curveMeasurePoint(t);return await this.apis.turnLight(),s}async beforeRecordCurvePosition(){var s;return await((s=this.deviceChecker)==null?void 0:s.call(this,["connect","idle"]))?(await this.apis.turnLight(),await this.turnLocalIrLed(!0),this.resetCurveTempData(),!0):!1}async afterRecordCurvePosition(){var s;return await((s=this.deviceChecker)==null?void 0:s.call(this,["measure_connect","idle","curveBounds"]))?(await this.apis.turnLight(),await this.turnLocalIrLed(!1),!0):!1}async recordCurveStartPosition(){var _;if(!await((_=this.deviceChecker)==null?void 0:_.call(this,["measure_connect","idle"])))return!1;const s=this.customData.getData(this.canvasId),n=p.CURVE_PROCESS,o=s[n].curveData.tempData,c=await this.apis.getLaserPosition(),E={ox:c.x,oy:c.y,x:0,y:0,z:0},l=await this.curveMeasureBoundsPoint(E);return o.laserStartPosition=c,o.irLedStartPosition=l,{result:l.result,position:E}}async recordCurveEndPosition(){var _;if(!await((_=this.deviceChecker)==null?void 0:_.call(this,["measure_connect","idle"])))return!1;const s=this.customData.getData(this.canvasId),n=p.CURVE_PROCESS,o=s[n].curveData.tempData,c=await this.apis.getLaserPosition(),E={ox:c.x,oy:c.y,x:0,y:0,z:0},l=await this.curveMeasureBoundsPoint(E);return o.laserEndPosition=c,o.irLedEndPosition=l,{result:l.result,position:E}}correctCurveBounds(){const t=this.customData.getData(this.canvasId),s=p.CURVE_PROCESS,n=t[s].curveData.tempData;if(!n.laserStartPosition||!n.laserEndPosition)return!1;const{x:o,y:c}=n.laserStartPosition,{x:E,y:l}=n.laserEndPosition;n.laserStartPosition={x:Math.min(o,E),y:Math.min(c,l)},n.laserEndPosition={x:Math.max(o,E),y:Math.max(c,l)};const{x:_,y:h}=n.irLedStartPosition,{x:C,y:D}=n.irLedEndPosition;n.irLedStartPosition={x:Math.min(_,C),y:Math.min(h,D)},n.irLedEndPosition={x:Math.max(_,C),y:Math.max(h,D)};const y=n.irLedStartPosition,w=n.irLedEndPosition,A=Math.abs(w.x-y.x),v=Math.abs(w.y-y.y);return A<ss||v<is?!1:(n.densityArea={x:y.x,y:y.y,width:A,height:v},!0)}setRecommendAttr(){const t=this.customData.getData(this.canvasId),s=p.CURVE_PROCESS,n=t[s].curveData.tempData,{width:o,height:c}=n.densityArea;let E=Math.ceil(c/Ve),l=Math.ceil(o/Ve);E=E<3?3:E,l=l<3?3:l,n.curveRange={row:E>this.curveMaxRow?this.curveMaxRow:E,col:l>this.curveMaxCol?this.curveMaxCol:l}}calCurveDensityPoints(t){const s=this.customData.getData(this.canvasId),n=p.CURVE_PROCESS,o=s[n].curveData.tempData,{row:c,col:E}=o.curveRange,l=[],_=o.laserStartPosition,h=o.laserEndPosition,C=Math.abs(h.x-_.x),D=Math.abs(h.y-_.y),y=C/(E-1),w=D/(c-1),A=t.width-t.pointSize,v=t.height-t.pointSize,M=A/(E-1),j=v/(c-1);let $=c*E,K=!0,W=0,q=0;for(;$>0;)l.push({ox:_.x+y*W,oy:_.y+w*q,x:0,y:0,z:0,colIndex:W,rowIndex:q,left:M*W+t.pointSize/2,top:j*q+t.pointSize/2,color:le.GRAY}),K&&W<E-1?W++:!K&&W>0?W--:q<c-1&&(q++,K=!K),$--;return o.densityPoints=l,o.densityPoints}beforeCurveMeasuring(){var t;return(t=this.deviceChecker)==null?void 0:t.call(this,["measure_connect","idle"])}async beforeCurveMeasureAllPoints(){await this.apis.offLight(),await this.apis.turnOnLocalIrLed(),await this.apis.modeSwitch({data:{state:"P_MEASURE"}})}async afterCurveMeasureAllPoints(){const t=this.customData.getData(this.canvasId),s=p.CURVE_PROCESS,n=t[s].curveData;n.remeasurePoints=[],await this.apis.resetLaserHead(),await this.apis.turnOffLocalIrLed(),await this.apis.turnLight(),await this.apis.modeSwitch({data:{state:"P_IDLE"}})}async curveMeasurePoint(t){try{if(t.color=le.BLUE,await this.apis.setLaserHead({data:{...t,x:t.ox,y:t.oy,z:0,s:0,f:Je}}),!await this.waitLaserHeadReach(He,{x:t.ox,y:t.oy,z:0}))throw new Error("unReach position");const n=await this.apis.captureLocalImage({onDownloadProgress:_=>{const h=Math.floor(_.loaded/_.total*100);console.log({percent:h})}}),o=await this.cacheData.getLocalCalibrationData(),c=await this.cacheData.getLocalIrData(),E=await Re(n);if(!E)throw new Error("no origin image data");const l=await this.cacheData.cameraTool.measurement({rgbaArr:E.data,isLocal:!0,points:o,irText:c});if(l.z>os||l.z<ns)throw new Error(`invalid irLedPosition z: ${l.z}`);return{...t,x:t.ox+(l.x||0)+rs,y:t.oy+(l.y||0)+cs,z:l.z,color:le.GREEN,result:"success"}}catch(s){if(console.log("curveMeasure err: ",s),["timeout of 30000ms exceeded","Network Error"].includes(s.message))throw new Error("disconnected");return{...t,z:t.z??0,color:le.RED,result:"fail"}}}beforeCurveRemeasure(){var t;return(t=this.deviceChecker)==null?void 0:t.call(this,["measure_connect","measuring","idle"])}updateCurveDensityPoints(){const t=this.customData.getData(this.canvasId),s=p.CURVE_PROCESS,n=t[s].curveData;return n.densityPoints.forEach(o=>{n.remeasurePoints.findIndex(E=>o.rowIndex===E.rowIndex&&o.colIndex===E.colIndex)!==-1?(o.color=le.BLUE,o.skipMeasure=!1,o.result=""):(o.color=le.SILVERY,o.skipMeasure=!0)}),n.densityPoints}async getCurveData(t){this.curveWorker||(this.curveWorker=new xt);const s=this.customData.getData(this.canvasId),n=p.CURVE_PROCESS,o=s[n].curveData,c=o.curveRange,E=o.densityPoints,l={tension:(t==null?void 0:t.tension)||(o==null?void 0:o.tension)||3,smoothness:(t==null?void 0:t.smoothness)||(o==null?void 0:o.smoothness)||3,size:c,densityPoints:E},_=await this.curveWorker.getCurveData({info:l}),h=this.curvature.large.angle[0],C=_.points.some(D=>D.a>h);return{densityPoints:E,modelData:_,hasDangerPoint:C}}resetCurveTempData(){const t=this.customData.getData(this.canvasId),s=p.CURVE_PROCESS;t[s].curveData.tempData=qe()}setFinalCurveData(t,s=!0){const n=this.customData.getData(this.canvasId),o=p.CURVE_PROCESS,c=n[o].curveData;s&&(Object.assign(c,c.tempData),this.resetCurveTempData()),c.remeasurePoints=[],c.densityPoints=t,c.smoothness=3,c.tension=3,c.previewDisabled=!1,c.needDangerTip=!1}finishCurvePreview(){var D;const t=this.customData.getData(this.canvasId),s=p.CURVE_PROCESS,n=(D=t[s])==null?void 0:D.curveData,{data:o}=this.processingArea,c=o.find(y=>y.key===p.CURVE_PROCESS),E=(c==null?void 0:c.offsetX)??0,l=(c==null?void 0:c.offsetY)??0,_={x:n.irLedStartPosition.x+E,y:n.irLedStartPosition.y+l},h={x:n.irLedEndPosition.x+E,y:n.irLedEndPosition.y+l};n.remeasurePoints=[];const C=this.toggleCurveCanvasPlugin(this.dataSource,!0);C&&(C.updateRect({width:c==null?void 0:c.width,height:c==null?void 0:c.height}),C.updateHole({x:_.x,y:_.y,width:Math.abs(h.x-_.x),height:Math.abs(h.y-_.y)}))}async buildCurveGcode(){const{printData:t,params:s}=this.printInfo,n=st(t,je.VECTOR_ENGRAVING);let o="";if(n&&n.list.length>0){const C=this.filterCurveElement(n.list),D=await this.getCurveVectorGCode(C);D&&(o+=D)}const c=st(t,je.BITMAP_ENGRAVING);if(c&&c.list.length>0){const C=this.filterCurveElement(c.list),D=await this.getCurveBitmapGCode(C);D&&(o+=`
${D}`)}if(!o)return;const E=be(ce.curveVector),l=this.builder.hook.note(s),{engrave:_=100}=s.airPumpConfig,h=E({focalLen:s.focalLen,motionCode:o,motionConfig:`{"color": ${Ft.VECTOR_ENGRAVING}}`,airPumpValue:Math.round(_*2.55)});return this.builder.place(l,h)}filterCurveElement(t){var h;const s=p.CURVE_PROCESS,{current:{offsetX:n=0,offsetY:o=0}}=this.getCurrentArea(s),E=(h=this.customData.getData(this.canvasId)[s])==null?void 0:h.curveData,l={...E.densityArea,x:E.densityArea.x+n,y:E.densityArea.y+o};return t.filter(C=>Qt(C,l))}async getCurveVectorGCode(t){var l;if(t.length===0)return"";const{current:{offsetX:s=0,offsetY:n=0}}=this.getCurrentArea(p.CURVE_PROCESS),o={};for(let _=0;_<t.length;_++){const{source:h,power:C,speed:D,repeat:y}=t[_];if(!h)continue;const w=`${C}-${D}-${y}`;o[w]||(o[w]={path:"",power:C,speed:D,repeat:y});const A=Wt(String(h)).translate(-s,-n).toString();o[w].path+=A}let c="";const E=Object.values(o);for(let _=0;_<E.length;_++){const{path:h,power:C,speed:D,repeat:y}=E[_],w=await((l=this.curveWorker)==null?void 0:l.getVectorGCode({svg:Yt(h),params:{power:C*10,speed:D*60,z_max:Ge-rt,repeat:y}}))||"";w&&(c+=`# blockConfig={"powerFactor": -1} 
`,c+=w)}return c}async getCurveBitmapGCode(t){var E;if(t.length===0)return"";const{current:{offsetX:s=0,offsetY:n=0}}=this.getCurrentArea(p.CURVE_PROCESS);let o="";const c=ft.buildParams.accel;for(let l=0;l<t.length;l++){if(!t[l].source)continue;let _=t[l].source;t[l].isFill&&(_=jt(t[l].source));const h=Math.pow(t[l].speed-0,2)/2/c,C=await((E=this.curveWorker)==null?void 0:E.getBitmapGCode({imgData:{imgData:_,resolutionX:t[l].oWidth,resolutionY:t[l].oHeight,x:t[l].x-s,y:t[l].y-n,imgWidth:t[l].width,imgHeight:t[l].height},params:{overDist:h,power:t[l].power*10,speed:t[l].speed*60,repeat:t[l].repeat,density:t[l].density,z_max:Ge-rt}}))||"";C&&(o+=`# blockConfig={"powerFactor":${.01*t[l].power}} 
`,o+=C)}return o}},e=new WeakMap,i=new WeakMap,u=new WeakSet,Dt=function(t){const{x:s,y:n,width:o,height:c,mode:E}=t,{current:{offsetX:l=0,offsetY:_=0,width:h}}=this.getCurrentArea(E),{localCameraOffset:C}=Ye,D=s+o/2,y=n+c/2;return E===F.LASER_CYLINDER?{x:y+Math.abs(_)-C.x,y:h-D-C.y+Math.abs(l)}:{x:D-C.x+Math.abs(l),y:y-C.y+Math.abs(_)}},d=new WeakSet,yt=function(t){let s=va[t];if(s===Q.CANCEL_PROCESS&&b(this,i,!0),s===Q.BEFORE_START&&b(this,i,!1),V(this,i)&&s===Q.FINISH_PROCESS&&(s=Q.CANCEL_PROCESS),s){this.emit(J.UPDATE_DEVICE_INFO,{currentStatus:s});const n=this.whenReceiveCmdResolveMap.get(s);Pe(n)&&n(s)}},P}const ci=Object.freeze(Object.defineProperty({__proto__:null,DeviceExt:Qs,v2:Fs},Symbol.toStringTag,{value:"Module"}));export{Ae as L,ct as M,It as c,ci as i};
