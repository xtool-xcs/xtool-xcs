import{k as U,e as Se,f as z,S as ie,ai as w,b as L,p as Ie,D as x,I as R,J as n,y as S,K as P,j as a,u as e,G as _,E as N,a2 as V,q as X,M as O,F as be,L as Ne,ak as re,r as Me,c as De,ab as le,s as Le,v as Oe}from"./xcs-vue-family-70642f71.js";import{c as Ee,M as ce,L as ue}from"./index-7dda6ca9.js";import{p as Re,n as ze,d as Ue,o as Ge}from"./image-bad03660.js";import{w as Fe,c as je,r as He,u as xe,g as Ve,b as pe,m as te,a as de,e as ye}from"./light-87cce264.js";import{u as ge,N as Qe}from"./scrollbar-5a89bf25.js";import{a as me,r as Xe,c as he,N as y}from"./space-5433d955.js";import{b as Ye,N as C}from"./button-00b27872.js";import{W as qe,k as Je}from"./modal-c96d5b67.js";import{o as Ke}from"./setting.vue_vue_type_script_setup_true_lang-0ee96bfb.js";import{_ as se,bw as fe,bB as ve,bN as We}from"../assets/index-83a10b2e.js";import{S as Q}from"./setting.vue_vue_type_style_index_0_lang-315c55c2.js";import{N as $e}from"./divider-c77484ad.js";import{N as Ze}from"./text-3b674000.js";import{N as et}from"./inputnumber-fff11604.js";import{a as tt,N as I}from"./grid-9031c693.js";import"./index-17630698.js";import"./xcs-canvas-5c2592d6.js";import"./image-c9c8ff8c.js";import"./use-message-cd8b9f19.js";import"./params-f8cc805d.js";import"./device-845a051d.js";import"./urlparam-4b6ed041.js";import"./fade-in.cssr-8e3c8f09.js";import"./use-style-1280d407.js";import"./loading-b06a4834.js";import"./spin-afa417d1.js";import"./checkbox-9495194d.js";import"./light-28752129.js";import"./headers-069f588a.js";import"./index-55948043.js";const st={iconSize:"22px"},ot=u=>{const{fontSize:t,warningColor:l}=u;return Object.assign(Object.assign({},st),{fontSize:t,iconColor:l})},at=Fe({name:"Popconfirm",common:je,peers:{Button:Ye,Popover:Re},self:ot}),nt=at,Ce=He("n-popconfirm"),_e={positiveText:String,negativeText:String,showIcon:{type:Boolean,default:!0},onPositiveClick:{type:Function,required:!0},onNegativeClick:{type:Function,required:!0}},Ae=Je(_e),it=U({name:"NPopconfirmPanel",props:_e,setup(u){const{localeRef:t}=ge("Popconfirm"),{inlineThemeDisabled:l}=xe(),{mergedClsPrefixRef:d,mergedThemeRef:i,props:m}=Se(Ce),c=z(()=>{const{common:{cubicBezierEaseInOut:h},self:{fontSize:v,iconSize:k,iconColor:A}}=i.value;return{"--n-bezier":h,"--n-font-size":v,"--n-icon-size":k,"--n-icon-color":A}}),s=l?Ve("popconfirm-panel",void 0,c,m):void 0;return Object.assign(Object.assign({},ge("Popconfirm")),{mergedClsPrefix:d,cssVars:l?void 0:c,localizedPositiveText:z(()=>u.positiveText||t.value.positiveText),localizedNegativeText:z(()=>u.negativeText||t.value.negativeText),positiveButtonProps:ie(m,"positiveButtonProps"),negativeButtonProps:ie(m,"negativeButtonProps"),handlePositiveClick(h){u.onPositiveClick(h)},handleNegativeClick(h){u.onNegativeClick(h)},themeClass:s==null?void 0:s.themeClass,onRender:s==null?void 0:s.onRender})},render(){var u;const{mergedClsPrefix:t,showIcon:l,$slots:d}=this,i=me(d.action,()=>this.negativeText===null&&this.positiveText===null?[]:[this.negativeText!==null&&w(C,Object.assign({size:"small",onClick:this.handleNegativeClick},this.negativeButtonProps),{default:()=>this.localizedNegativeText}),this.positiveText!==null&&w(C,Object.assign({size:"small",type:"primary",onClick:this.handlePositiveClick},this.positiveButtonProps),{default:()=>this.localizedPositiveText})]);return(u=this.onRender)===null||u===void 0||u.call(this),w("div",{class:[`${t}-popconfirm__panel`,this.themeClass],style:this.cssVars},Xe(d.default,m=>l||m?w("div",{class:`${t}-popconfirm__body`},l?w("div",{class:`${t}-popconfirm__icon`},me(d.icon,()=>[w(Qe,{clsPrefix:t},{default:()=>w(qe,null)})])):null,m):null),i?w("div",{class:[`${t}-popconfirm__action`]},i):null)}}),rt=pe("popconfirm",[te("body",`
 font-size: var(--n-font-size);
 display: flex;
 align-items: center;
 flex-wrap: nowrap;
 position: relative;
 `,[te("icon",`
 display: flex;
 font-size: var(--n-icon-size);
 color: var(--n-icon-color);
 transition: color .3s var(--n-bezier);
 margin: 0 8px 0 0;
 `)]),te("action",`
 display: flex;
 justify-content: flex-end;
 `,[de("&:not(:first-child)","margin-top: 8px"),pe("button",[de("&:not(:last-child)","margin-right: 8px;")])])]),lt=Object.assign(Object.assign(Object.assign({},ye.props),Ge),{positiveText:String,negativeText:String,showIcon:{type:Boolean,default:!0},trigger:{type:String,default:"click"},positiveButtonProps:Object,negativeButtonProps:Object,onPositiveClick:Function,onNegativeClick:Function}),ct=U({name:"Popconfirm",props:lt,__popover__:!0,setup(u){const{mergedClsPrefixRef:t}=xe(),l=ye("Popconfirm","-popconfirm",rt,nt,u,t),d=L(null);function i(s){const{onPositiveClick:h,"onUpdate:show":v}=u;Promise.resolve(h?h(s):!0).then(k=>{var A;k!==!1&&((A=d.value)===null||A===void 0||A.setShow(!1),v&&he(v,!1))})}function m(s){const{onNegativeClick:h,"onUpdate:show":v}=u;Promise.resolve(h?h(s):!0).then(k=>{var A;k!==!1&&((A=d.value)===null||A===void 0||A.setShow(!1),v&&he(v,!1))})}return Ie(Ce,{mergedThemeRef:l,mergedClsPrefixRef:t,props:u}),Object.assign(Object.assign({},{setShow(s){var h;(h=d.value)===null||h===void 0||h.setShow(s)},syncPosition(){var s;(s=d.value)===null||s===void 0||s.syncPosition()}}),{mergedTheme:l,popoverInstRef:d,handlePositiveClick:i,handleNegativeClick:m})},render(){const{$slots:u,$props:t,mergedTheme:l}=this;return w(Ue,Ke(t,Ae,{theme:l.peers.Popover,themeOverrides:l.peerOverrides.Popover,internalExtraClass:["popconfirm"],ref:"popoverInstRef"}),{trigger:u.activator||u.trigger,default:()=>{const d=ze(t,Ae);return w(it,Object.assign(Object.assign({},d),{onPositiveClick:this.handlePositiveClick,onNegativeClick:this.handleNegativeClick}),u)}})}}),ut=_("div",null,null,-1),pt=U({__name:"Header",props:{isReadyToNext:{type:Boolean},ext:null},emits:["cancel","finish"],setup(u){return(t,l)=>(x(),R(e(y),{size:"medium",justify:"space-between",align:"center",style:{height:"100%"}},{default:n(()=>[ut,S(" "+P(t.$t("device.pass_through.set_next_process",{currStep:u.ext.splitProcessData.currentIndex+1,totalStep:u.ext.splitProcessData.splitPackages.length}))+" ",1),a(e(y),null,{default:n(()=>[a(e(ct),{"positive-text":t.$t("device.common.ok"),"negative-text":t.$t("device.common.cancel"),onPositiveClick:l[0]||(l[0]=d=>t.$emit("cancel"))},{trigger:n(()=>[a(e(C),{type:"primary"},{default:n(()=>[S(P(t.$t("device.process.cancel_processing")),1)]),_:1})]),default:n(()=>[S(" "+P(t.$t("device.process.confirm_cancel_task")),1)]),_:1},8,["positive-text","negative-text"]),a(e(C),{disabled:!t.$props.isReadyToNext,type:"primary",onClick:l[1]||(l[1]=d=>t.$emit("finish"))},{default:n(()=>[S(P(t.$t("device.process.start_processing")),1)]),_:1},8,["disabled"])]),_:1})]),_:1}))}}),dt={class:"processing-layout"},gt={class:"processing-layout-header"},mt={class:"processing-layout-main"},ht=["left"],ft={class:"content-cont"},vt=["right"],At={class:"processing-layout-footer"},xt=U({__name:"Layout",setup(u){return(t,l)=>(x(),N("section",dt,[_("header",gt,[V(t.$slots,"header",{},void 0,!0)]),_("main",mt,[_("aside",{class:"processing-layout-sider",left:"leftSider"in t.$slots},[V(t.$slots,"leftSider",{},void 0,!0)],8,ht),_("section",ft,[V(t.$slots,"content",{},void 0,!0)]),_("aside",{class:"processing-layout-sider",right:"rightSider"in t.$slots},[V(t.$slots,"rightSider",{},void 0,!0)],8,vt)]),_("footer",At,[a(e(y),{style:{height:"100%"},align:"center"},{default:n(()=>[V(t.$slots,"footer",{},void 0,!0)]),_:3})])]))}});const yt=se(xt,[["__scopeId","data-v-8061a718"]]),Ct="data:image/png;base64,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",_t=""+new URL("../assets/fix_fail-5ca6cb35.png",import.meta.url).href,kt=""+new URL("../assets/fix_success-03c84c41.png",import.meta.url).href,Pt=""+new URL("../assets/manual_alignment-99c9435b.png",import.meta.url).href,Bt=""+new URL("../assets/push_plank-6b9cbf75.png",import.meta.url).href,Tt=""+new URL("../assets/taking_picture-08e81384.png",import.meta.url).href,wt=["src"],St=["src"],It=U({__name:"RightSidebar",props:{isReadyToNext:{type:Boolean},isTakingPhoto:{type:Boolean},isNotifyToPushMaterial:{type:Boolean},isCheckingPosition:{type:Boolean},isCheckSuccess:{type:Boolean},isCheckFail:{type:Boolean},isUseManual:{type:Boolean}},emits:["auto","manual","backManual","handleRefresh","handleTakeLocal","changePosition"],setup(u,{emit:t}){const l=u,d=L(1),i=z(()=>l.isTakingPhoto?{img:{src:Tt,props:{style:{height:"80px",width:"80px"}}},title:{text:"device.pass_through.taking_photo",props:{}},subTitle:{text:"device.pass_through.no_move_or_open",props:{}}}:l.isNotifyToPushMaterial?{img:{src:Bt,props:{style:{height:"120px",width:"180px"}}},subTitle:{text:"device.pass_through.push_material_tips"},buttons:[{text:"device.pass_through.auto_counterpoint",onClick:()=>{t("auto")},props:{type:"primary",style:{minWidth:"200px"}}},{text:"device.pass_through.open_manual_measure",onClick:()=>{t("manual")},props:{style:{minWidth:"200px"}}}]}:l.isCheckingPosition?{img:{src:Ct,props:{style:{width:"80px",height:"80px"}}},title:{text:"device.pass_through.counterpointing"},subTitle:{text:"device.pass_through.no_move_or_open"}}:l.isCheckSuccess?{img:{src:kt,props:{style:{width:"80px",height:"80px"}}},title:{text:"device.pass_through.counterpoint_success"},subTitle:{text:"device.pass_through.click_button_to_process"},buttons:[{text:"device.pass_through.auto_counterpoint_again",onClick:()=>{t("auto")},props:{}},{text:"device.pass_through.open_manual_measure",onClick:()=>{t("manual")},props:{type:"primary"}}]}:l.isCheckFail?{img:{src:_t,props:{style:{height:"80px",width:"80px"}}},title:{text:"device.pass_through.counterpoint_fail",props:{style:{color:"red"}}},subTitle:{text:"device.pass_through.please_manual_counterpoint"},buttons:[{text:"device.pass_through.auto_counterpoint_again",onClick:()=>{t("auto")},props:{style:{minWidth:"200px"}}},{text:"device.pass_through.open_manual_measure",onClick:()=>{t("manual")},props:{type:"primary",style:{minWidth:"200px"}}}]}:{});return(m,c)=>l.isUseManual?(x(),R(e(y),{key:1,vertical:"",size:60,class:"right-sidebar"},{default:n(()=>[a(e(y),{vertical:"",size:0},{default:n(()=>[a(e(C),{text:"",style:{height:"3rem"},onClick:c[0]||(c[0]=s=>t("backManual"))},{default:n(()=>[S(P("<-"+m.$t("device.pass_through.back_auto_align")),1)]),_:1}),a(e($e),{style:{margin:"0"}})]),_:1}),a(e(y),{vertical:"",size:30},{default:n(()=>[a(e(y),{vertical:"",align:"center",size:16},{default:n(()=>[_("img",{src:e(Pt),alt:"",style:{width:"180px",height:"120px"}},null,8,St),a(e(Ze),{style:{"font-size":"20px","font-weight":"500"}},{default:n(()=>[S(P(m.$t("device.pass_through.manual_alignment")),1)]),_:1})]),_:1}),a(e(y),{justify:"space-between",wrap:!1},{default:n(()=>[a(e(y),{vertical:"",size:20},{default:n(()=>[_("h3",null,P(m.$t("device.setting.move_distance")),1),a(e(et),{value:d.value,"onUpdate:value":c[1]||(c[1]=s=>d.value=s),min:1,max:100,step:1,precision:0,"show-button":!1},{suffix:n(()=>[S("mm")]),_:1},8,["value"])]),_:1}),a(e(tt),{class:"btn-grid","x-gap":"6","y-gap":"6",rows:3,cols:3},{default:n(()=>[a(e(I)),a(e(I),null,{default:n(()=>[a(e(C),{type:"primary",onClick:c[2]||(c[2]=s=>t("changePosition",0,-d.value))},{default:n(()=>[a(e(Q),{name:"move-arrow-up"})]),_:1})]),_:1}),a(e(I)),a(e(I),null,{default:n(()=>[a(e(C),{type:"primary",onClick:c[3]||(c[3]=s=>t("changePosition",-d.value,0))},{default:n(()=>[a(e(Q),{name:"move-arrow-left"})]),_:1})]),_:1}),a(e(I),null,{default:n(()=>[a(e(C),{type:"primary",onClick:c[4]||(c[4]=s=>t("changePosition",0,0))},{default:n(()=>[a(e(Q),{name:"move-center"})]),_:1})]),_:1}),a(e(I),null,{default:n(()=>[a(e(C),{type:"primary",onClick:c[5]||(c[5]=s=>t("changePosition",d.value,0))},{default:n(()=>[a(e(Q),{name:"move-arrow-right"})]),_:1})]),_:1}),a(e(I)),a(e(I),null,{default:n(()=>[a(e(C),{type:"primary",onClick:c[6]||(c[6]=s=>t("changePosition",0,d.value))},{default:n(()=>[a(e(Q),{name:"move-arrow-down"})]),_:1})]),_:1}),a(e(I))]),_:1})]),_:1}),a(e(y),{vertical:"",align:"center"},{default:n(()=>[a(e(C),{type:"primary",style:{"min-width":"200px"},onClick:c[7]||(c[7]=s=>t("handleRefresh"))},{default:n(()=>[S(P(m.$t("device.common.refresh")),1)]),_:1}),a(e(C),{type:"primary",style:{"min-width":"200px"},onClick:c[8]||(c[8]=s=>t("handleTakeLocal"))},{default:n(()=>[S(P(m.$t("device.ext.take_local_pic")),1)]),_:1})]),_:1})]),_:1})]),_:1})):(x(),R(e(y),{key:0,class:"right-sidebar",align:"center",justify:"center"},{default:n(()=>[a(e(y),{vertical:!0,align:"center",class:"box"},{default:n(()=>{var s,h,v,k,A,r,g,M,G,Y,q,F,J,K,j,E,W,$;return[(h=(s=e(i))==null?void 0:s.img)!=null&&h.src?(x(),N("img",X({key:0,class:"img"},(k=(v=e(i))==null?void 0:v.img)==null?void 0:k.props,{src:(r=(A=e(i))==null?void 0:A.img)==null?void 0:r.src}),null,16,wt)):O("",!0),(M=(g=e(i))==null?void 0:g.title)!=null&&M.text?(x(),N("h2",X({key:1,class:"title"},(Y=(G=e(i))==null?void 0:G.title)==null?void 0:Y.props),P(m.$t((F=(q=e(i))==null?void 0:q.title)==null?void 0:F.text)),17)):O("",!0),(K=(J=e(i))==null?void 0:J.subTitle)!=null&&K.text?(x(),N("h3",X({key:2},(E=(j=e(i))==null?void 0:j.subTitle)==null?void 0:E.props,{class:"sub-title"}),P(m.$t(($=(W=e(i))==null?void 0:W.subTitle)==null?void 0:$.text)),17)):O("",!0),e(i).buttons?(x(),R(e(y),{key:3,vertical:!0,align:"center"},{default:n(()=>[(x(!0),N(be,null,Ne(e(i).buttons,T=>(x(),R(e(C),X(T==null?void 0:T.props,{key:T.text,onClick:oe=>T&&T.onClick&&T.onClick()}),{default:n(()=>[S(P(m.$t(T.text)),1)]),_:2},1040,["onClick"]))),128))]),_:1})):O("",!0)]}),_:1})]),_:1}))}});const bt=se(It,[["__scopeId","data-v-4e7ecaf7"]]),Nt={class:"content"},Mt=["src"],Dt={key:1,class:"bg-mask"},Lt=["src"],Ot=["src"],Et=["src"],Rt=U({__name:"MoveMaterial",props:{ext:null,handler:null},setup(u){const t=u,l=50,{commit:d,getters:i}=re(),m=L(!1),c=re(),s=L({x:0,y:0}),h=z(()=>{var o;return(o=c.state.editor.backgroundImg)==null?void 0:o.src}),v=z(()=>{var o;return(o=c.state.editor.localBgImg)==null?void 0:o.src}),k=L({left:"0",top:"0"}),{isFinishProcessing:A}=We,r=t.ext.splitProcessData,g=Me({isReadyToNext:!1,isTakingPhoto:!0,isNotifyToPushMaterial:!1,isCheckingPosition:!1,isCheckSuccess:!1,isCheckFail:!1,isUseManual:!1}),M=L(),G=L(),Y=async()=>{const o=i.ext,{endPoint:p}=r.getEndPointByIndex(r.currentIndex-1),f=p.x-r.pushX,{coordinate:B}=o.calLaserHeadCoordinate({x:f-35,y:l,mode:fe.PASS_THROUGH});await o.apis.setLaserHead({data:B}),g.isNotifyToPushMaterial=!0,g.isUseManual=!1,g.isReadyToNext=!1,s.value.x=r.startX-r.pushX,s.value.y=r.startY-r.pushY},q=async()=>{const o=await i.ext.takeGlobalPic();if(t.ext.emit(ve.UPDATE_CANVAS_BACK_DROP,{img:o}),i.ext.lastLocalPicPosition){const p=c.getters.dataSource.currentDeviceData;await i.ext.takeLocalPic(p,i.ext.lastLocalPicPosition)}},F=(o,p,f)=>{const B=p.getBoundingClientRect(),b=f.getBoundingClientRect(),D=o.clientX-B.left-b.width/2,H=o.clientY-B.top-b.height/2,Z=Math.min(Math.max(D,0),B.width-b.width-110),ee=Math.min(Math.max(H,0),B.height-b.height-115);Object.assign(f.style,{left:Z+"px",top:ee+"px"})},J=()=>{M.value.addEventListener("mousemove",o=>F(o,M.value,G.value))},K=async()=>{m.value=!0,document.addEventListener("keydown",j),J()},j=o=>{console.log(o.code),o.code==="Escape"&&(console.log("Escape"),E())},E=()=>{m.value=!1,document.removeEventListener("keydown",j),M.value.removeEventListener("mousemove",F)},W=async o=>{if(m.value){if(o.target.className==="take-local-hitarea")return;const p={x:o.target.offsetLeft+o.offsetX,y:o.target.offsetTop+o.offsetY};p.x=Math.min(Math.max(p.x,0),430),p.y=Math.min(Math.max(p.y,50),140);const f=c.getters.dataSource.currentDeviceData;i.ext.takeLocalPic(f,p),E()}},$=o=>{o.preventDefault(),E(),console.log("right click")},T=()=>{s.value.x=r.startX-r.pushX,s.value.y=r.startY-r.pushY},oe=(o,p)=>{if(console.log({x:o,y:p}),o===0&&p===0){s.value.x=r.startX,s.value.y=r.startY;return}s.value.x+=o,s.value.y+=p,console.log(s.value)},ke=()=>{const o=i.ext.lastLocalPicPosition;if(!o)return;let{x:p,y:f}=o;p-=ue.width/2,f-=ue.height/2,k.value.left=p+"px",k.value.top=f+"px"};let ae,ne;const Pe=async()=>{g.isCheckingPosition=!0,g.isReadyToNext=!1,g.isCheckSuccess=!1,g.isCheckFail=!1,await i.ext.turnLocalIrLed(!1);const{endPoint:o}=r.getEndPointByIndex(r.currentIndex-1),p=o.x-r.pushX,f=c.getters.dataSource.currentDeviceData,{imgData:B}=await i.ext.takeLocalPic(f,{x:p-35,y:l-10},{autoReset:!1});ne=B;const b=await i.ext.takeGlobalPic(f);t.ext.emit(ve.UPDATE_CANVAS_BACK_DROP,{img:b});const D=await r.matchImage(ae,ne);if(D.result){const{endPoint:H}=r.getEndPointByIndex(r.currentIndex-1),Z=D.x*.05,ee=D.y*.05;console.log("对位成功 偏移值",{x:Z},{y:ee}),s.value.y=r.startY+l-H.y+ee-10,s.value.x=r.startX+Z-r.pushX,g.isNotifyToPushMaterial=!1,g.isReadyToNext=!0,g.isCheckSuccess=!0}else g.isNotifyToPushMaterial=!1,g.isCheckFail=!0,await i.ext.turnLocalIrLed(!0);g.isNotifyToPushMaterial=!1,g.isCheckingPosition=!1},Be=()=>{console.log("点击手动对位"),g.isUseManual=!0,g.isReadyToNext=!0},Te=async()=>{await i.ext.turnLocalIrLed(!1),r.pushX=r.startX-s.value.x,r.pushY=r.startY-s.value.y;const{printData:o,params:p}=r.getFragment();t.ext.printInfo.printData=o,t.ext.printInfo.params=p,c.commit(ce.UPDATE_PROCESSING_STATE,[A,!1]),t.handler.goTo("preview")},we=async()=>{d(ce.RESET_PROCESSING_STATE),await i.ext.resetLaserHead(),t.handler.goTo("preview")};return De(async()=>{const o=i.ext;g.isTakingPhoto=!0,t.ext.delLocalPic();const{endPoint:p}=r.getEndPointByIndex(r.currentIndex-1),f=p.x-r.pushX,B=p.y-r.pushY;if(!f||!B)return;const b=c.getters.dataSource.currentDeviceData,{imgData:D}=await o.takeLocalPic(b,{x:f-35,y:B},{autoReset:!1,saveLocalPic:!1});ae=D;const{coordinate:H}=o.calLaserHeadCoordinate({x:f-35,y:l,mode:fe.PASS_THROUGH});await o.apis.setLaserHead({data:H}),await i.ext.turnLocalIrLed(!0),g.isTakingPhoto=!1,g.isNotifyToPushMaterial=!0}),(o,p)=>(x(),R(yt,null,{header:n(()=>[a(pt,{"is-ready-to-next":g.isReadyToNext,ext:t.ext,onFinish:Te,onCancel:we},null,8,["is-ready-to-next","ext"])]),content:n(()=>[_("section",Nt,[e(h)?(x(),N("img",{key:0,class:"canvas-bg",src:e(h)},null,8,Mt)):O("",!0),e(v)?(x(),N("span",Dt)):O("",!0),e(v)?(x(),N("img",{key:2,class:"local-bg",style:le(k.value),src:e(v),onLoad:ke},null,44,Lt)):O("",!0),_("img",{class:"content-bg",src:u.ext.canvasImgUrl,onLoad:T,style:le({left:s.value.x+"px",top:s.value.y+"px"})},null,44,Ot),_("div",{ref_key:"canvasRef",ref:M,class:"take-local-hitarea",onClick:W,onContextmenu:$},[Le(_("img",{ref_key:"cameraRef",ref:G,class:"take-local-camera-img",src:e(Ee),alt:""},null,8,Et),[[Oe,m.value]])],544)])]),rightSider:n(()=>[a(bt,X(g,{onBackManual:Y,onAuto:Pe,onManual:Be,onHandleRefresh:q,onHandleTakeLocal:K,onChangePosition:oe}),null,16)]),footer:n(()=>[]),_:1}))}});const ms=se(Rt,[["__scopeId","data-v-035b09a0"]]);export{ms as default};
