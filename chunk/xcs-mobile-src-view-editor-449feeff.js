import{t as je,G as Tt,H as Et,J as Le,K as Lt,x as Ke,L as Vt,N as Ot,d as Ye,I as mt,O as Ft,Q as Rt,y as Xe,R as vt,T as zt,w as Ut,U as Bt,a as ee,_ as G,V as ie,B as Ce,e as oe,W as Nt,n as Ve,X as ke,M as B,Y as nt,Z as me,$ as he,a0 as xe,j as Ge,a1 as ot,a2 as qe,a3 as ve,a4 as $e,a5 as Ae,a6 as De,a7 as ft,a8 as gt,F as Pe,a9 as ze,aa as Ue,ab as Mt,ac as at,ad as Re,ae as Ht,af as Gt,m as yt,ag as Wt,k as jt,o as Kt,h as bt,D as st,l as lt,E as Yt,u as Je,ah as it,b as Xt,ai as Be,aj as qt,f as Jt,ak as Zt,al as rt,am as Fe}from"../assets/index-83a10b2e.js";import{N as Qt}from"./index-36e5bf24.js";import{u as en}from"./systemback-e5f1562f.js";import{k as F,j as d,q as j,n as Oe,f as I,D as y,E as L,u as p,G as w,K as z,I as T,J as g,_ as ue,F as W,L as X,Z as we,M as J,H as Se,b as k,w as K,ab as pe,c as Te,l as Ze,$ as _e,y as le,a as tn,P as ce,N as ht,a2 as nn,a0 as on,a1 as an,i as be,r as Qe,aa as sn,d as ln,a3 as rn,A as cn,Q as dn,ac as et,ad as tt,s as ct,v as dt,o as un,a4 as pn,a5 as _n,ae as ut}from"./xcs-vue-family-70642f71.js";import{Z as de,j as Ne,X as mn,L as We,$ as ye,_ as vn,z as fn,A as xt,K as gn,O as pt,d as wt,a0 as yn,a1 as bn,a2 as hn,a3 as _t,a4 as xn,a5 as wn,E as ge,a6 as Cn,b as kn,h as Sn}from"./xcs-canvas-5c2592d6.js";import{C as In}from"./index-7795d5ed.js";import{L as $n}from"./index-606f09ea.js";import{N as An,u as Dn}from"./datasource-5dbe607a.js";import{d as Pn}from"./index-55948043.js";import{S as Tn}from"./index-8a9ed5a6.js";import{_ as En,g as Ln,a as Vn}from"./laserposition.vue_vue_type_script_setup_true_lang-86881cde.js";import"./constant-2a798a0e.js";const[On,se]=je("action-sheet"),Fn=Tt({},Et,{title:String,round:Le,actions:Lt(),closeIcon:Ke("cross"),closeable:Le,cancelText:String,description:String,closeOnPopstate:Le,closeOnClickAction:Boolean,safeAreaInsetBottom:Le}),Rn=[...Vt,"round","closeOnPopstate","safeAreaInsetBottom"];var zn=F({name:On,props:Fn,emits:["select","cancel","update:show"],setup(n,{slots:o,emit:e}){const t=r=>e("update:show",r),s=()=>{t(!1),e("cancel")},a=()=>{if(n.title)return d("div",{class:se("header")},[n.title,n.closeable&&d(mt,{name:n.closeIcon,class:[se("close"),Ft],onClick:s},null)])},l=()=>{if(o.cancel||n.cancelText)return[d("div",{class:se("gap")},null),d("button",{type:"button",class:se("cancel"),onClick:s},[o.cancel?o.cancel():n.cancelText])]},i=(r,c)=>r.loading?d(Rt,{class:se("loading-icon")},null):o.action?o.action({action:r,index:c}):[d("span",{class:se("name")},[r.name]),r.subname&&d("div",{class:se("subname")},[r.subname])],u=(r,c)=>{const{color:v,loading:b,callback:h,disabled:m,className:f}=r,S=()=>{m||b||(h&&h(r),n.closeOnClickAction&&t(!1),Oe(()=>e("select",r,c)))};return d("button",{type:"button",style:{color:v},class:[se("item",{loading:b,disabled:m}),f],onClick:S},[i(r,c)])},_=()=>{if(n.description||o.description){const r=o.description?o.description():n.description;return d("div",{class:se("description")},[r])}};return()=>d(Ye,j({class:se(),position:"bottom","onUpdate:show":t},Ot(n,Rn)),{default:()=>{var r;return[a(),_(),d("div",{class:se("content")},[n.actions.map(u),(r=o.default)==null?void 0:r.call(o)]),l()]}})}});const Un=Xe(zn),[Ct,Bn]=je("row"),kt=Symbol(Ct),Nn={tag:Ke("div"),wrap:Le,align:String,gutter:vt(0),justify:String};var Mn=F({name:Ct,props:Nn,setup(n,{slots:o}){const{children:e,linkChildren:t}=zt(kt),s=I(()=>{const l=[[]];let i=0;return e.forEach((u,_)=>{i+=Number(u.span),i>24?(l.push([_]),i-=24):l[l.length-1].push(_)}),l}),a=I(()=>{const l=Number(n.gutter),i=[];return l&&s.value.forEach(u=>{const _=l*(u.length-1)/u.length;u.forEach((r,c)=>{if(c===0)i.push({right:_});else{const v=l-i[r-1].right,b=_-v;i.push({left:v,right:b})}})}),i});return t({spaces:a}),()=>{const{tag:l,wrap:i,align:u,justify:_}=n;return d(l,{class:Bn({[`align-${u}`]:u,[`justify-${_}`]:_,nowrap:!i})},{default:()=>{var r;return[(r=o.default)==null?void 0:r.call(o)]}})}}});const[Hn,Gn]=je("col"),Wn={tag:Ke("div"),span:vt(0),offset:Ut};var jn=F({name:Hn,props:Wn,setup(n,{slots:o}){const{parent:e,index:t}=Bt(kt),s=I(()=>{if(!e)return;const{spaces:a}=e;if(a&&a.value&&a.value[t.value]){const{left:l,right:i}=a.value[t.value];return{paddingLeft:l?`${l}px`:null,paddingRight:i?`${i}px`:null}}});return()=>{const{tag:a,span:l,offset:i}=n;return d(a,{style:s.value,class:Gn({[l]:l,[`offset-${i}`]:i})},{default:()=>{var u;return[(u=o.default)==null?void 0:u.call(o)]}})}}});const Kn=Xe(jn),Yn=Xe(Mn);function St(n={},o="en"){if(!n)return"";const e=s=>typeof s=="string"&&s,t=s=>e(n[s])?n[s]:null;return t(o)??(o.startsWith("zh")?t("zh-HK")??t("zh-TW")??t("zh-Hant")??t("zh"):null)??t("en")??Object.values(n).find(s=>e(s))??""}const Xn={class:"action-view"},qn={class:"title"},Jn=F({__name:"ActionView",props:{title:null,icon:null,active:{type:Boolean},iconSize:null,iconPros:null,titlePros:null},setup(n){return(o,e)=>(y(),L("section",Xn,[d(p(ee),j({name:n.icon,size:n.iconSize},n.iconPros),null,16,["name","size"]),w("div",qn,z(o.$t(n.title)),1)]))}});const Zn=G(Jn,[["__scopeId","data-v-70aff9ff"]]),Qn={class:"action-list-item-cmp"},eo=F({__name:"ActionList",props:{active:null,activeComp:null,actionList:null},emits:["change"],setup(n,{emit:o}){const e=n,t=I(()=>e.actionList.length!==3),s=(a,l)=>{o("change",a),l&&l(a)};return(a,l)=>{const i=ie;return y(),T(i,null,{default:g(()=>[w("div",{class:ue([{"editor-action-list":p(t)},"action-list"])},[(y(!0),L(W,null,X(n.actionList,u=>(y(),L("div",{key:u.id,class:ue(["action-list-item",n.active===u.id?"active":""])},[d(p(Zn),{title:u.title,icon:u.icon,"icon-size":"24px",active:n.active===u.id,onClick:_=>s(u.id,u.onClick)},null,8,["title","icon","active","onClick"])],2))),128))],2),w("div",Qn,[n.activeComp?(y(),T(we(n.activeComp.cmp),{key:0,model:n.activeComp.model,attrs:n.activeComp.attrs,onAction:n.activeComp.action},null,40,["model","attrs","onAction"])):J("",!0)])]),_:1})}}});const It=G(eo,[["__scopeId","data-v-1b52fe6c"]]),to=F({__name:"LockRatioButton",props:{icon:null},setup(n){return(o,e)=>{const t=ee,s=Ce;return y(),T(s,j(o.$attrs,{type:"default",color:"white",style:{padding:"4px"}}),{default:g(()=>[d(t,{name:n.icon},null,8,["name"])]),_:1},16)}}}),no=F({__name:"IconButton",props:{svgIcon:null,disabled:{type:Boolean,default:!1},size:{default:"32px"}},setup(n){const o=n;return console.log(o),(e,t)=>{const s=Ce;return y(),T(s,{plain:"",class:"icon-button",size:"small",disabled:n.disabled},{default:g(()=>[d(p(ee),{name:o.svgIcon,size:o.size},null,8,["name","size"])]),_:1},8,["disabled"])}}});const Ie=G(no,[["__scopeId","data-v-96dd388f"]]),oo={class:"text-align"},ao={class:"text-distribute"},so={class:"icon-row"},lo=F({__name:"Align",props:{model:null},emits:["action"],setup(n,{emit:o}){const e=n,{t}=Se(),s=(_,r)=>{let c;switch(_){case 0:c=i(r);break;case 1:c=u(r);break;default:throw new Error("error value:"+c)}o("action","align",c)},a=[{icon:"align-left",action:0},{icon:"align-vertical",action:4},{icon:"align-right",action:1},{icon:"align-top",action:3},{icon:"align-horizontal",action:5},{icon:"align-bottom",action:2}],l=[{icon:"distribute-horizontal",action:1},{icon:"distribute-vertical",action:0}];function i(_){switch(_){case 0:return de.LEFT;case 1:return de.RIGHT;case 2:return de.BOTTOM;case 3:return de.TOP;case 4:return de.VERTICAL_CENTER;case 5:return de.HORIZONTAL_CENTER;default:throw new Error("no type:"+_)}}function u(_){switch(_){case 0:return de.VERTICAL_DISTRIBUTE;case 1:return de.HORIZONTAL_DISTRIBUTE;default:throw new Error("no type:"+_)}}return(_,r)=>{const c=ie;return y(),T(c,{class:"align-layout",style:{height:"190px"}},{default:g(()=>[w("div",oo,z(p(t)("editor.operation.align")),1),w("div",null,[(y(),L(W,null,X(a,v=>d(Ie,{key:v.icon,class:"icon","svg-icon":v.icon,disabled:!e.model.enableAlign,onClick:b=>s(0,v.action)},null,8,["svg-icon","disabled","onClick"])),64))]),w("div",ao,z(p(t)("editor.operation.distributed")),1),w("div",so,[(y(),L(W,null,X(l,v=>d(Ie,{key:v.icon,class:"icon","svg-icon":v.icon,disabled:!e.model.enableDistribute,onClick:b=>s(1,v.action)},null,8,["svg-icon","disabled","onClick"])),64))])]),_:1})}}});const io=G(lo,[["__scopeId","data-v-fee6248c"]]),ro={class:"color-list-wrap"},co={class:"move-label"},uo=["onClick"],po=F({__name:"ColorList",emits:["action"],setup(n,{emit:o}){const e=a=>{o("action","layer",{layerColor:a,layerTag:a})},t=oe(),s=k();return K(()=>t.selected.data,a=>{if(a.length>0){const l=[];a.forEach(i=>{l.includes(i.layerColor)||l.push(i.layerColor)}),l.length>1?s.value="":s.value=a[0].layerColor}},{deep:!0,immediate:!0}),(a,l)=>(y(),L("div",ro,[w("div",co,z(a.$t("editor.layer.mobile_move_the_selected_object_to")),1),(y(!0),L(W,null,X(p(Nt),i=>(y(),L("a",{key:i,class:ue([{"color-item-active":s.value===i},"color-item-wrap"]),onClick:u=>e(i)},[w("object",null,[w("a",{class:"color-item cursor-pointer",style:pe(`background-color: ${i}`)},null,4)])],10,uo))),128))]))}});const _o=G(po,[["__scopeId","data-v-500d5a54"]]),mo={class:"van-cell-title"},vo={class:"slider-label-wrap"},fo={style:{"margin-bottom":"10px"}},go={class:"custom-tooltip-wrap"},yo={class:"tooltip-content"},bo=F({__name:"Contour",emits:["action"],setup(n,{emit:o}){const e=oe(),t=Ve(),{t:s}=ke(),{unit:{fractionDigits:a,scale:l,step:i,current:u}}=t,_=2,r=k(u==="in"?_*l:_),c=u==="in"?-1:-25.4,v=u==="in"?1:25.4,b={min:c,max:v,step:i,scale:1,fractionDigits:a},h=I(()=>s("editor.operation.extract_contours_offset")+`(${u||"mm"})`),m=k({id:"offset",type:"number",value:r,attrs:{...b,showValRange:!0,valueWidth:"120px",suffix:u,onChange:U=>{r.value=U}},keyboardAttrs:{extraKey:["-","."]}}),f=U=>{console.log(U),E()},S=k(!0),A=k({hasBitmap:!1,hasVector:!1}),x=k(!1),E=()=>{R()},D=()=>{C(!1),o("action","contour","confirm")};Te(()=>{R()}),Ze(()=>{ae()}),K(()=>e.selected.data,()=>{o("action","contour","cancel")});const R=async()=>{const U={offset:r.value/l,addBitmapInner:S.value};P(!0);try{A.value=await N(U)}finally{P(!1)}},$=k(!1),P=U=>{$.value=U};K($,U=>{U?Ge({message:s("editor.operation.extract_contours_generate"),duration:0}):nt()});const N=async U=>{var V,O;const M=(U==null?void 0:U.offset)??2,Y=await((V=B.canvas)==null?void 0:V.getSelectedOutlineEleInfo(M)),fe=await B.getOutlinePath(Y,M,U);return(O=B.canvas)==null||O.drawOutline(fe),{hasBitmap:!!(Y!=null&&Y.bitmapData),hasVector:!!(Y!=null&&Y.vectorData)}},C=(U=!0)=>{var M,Y;try{(M=B.canvas)==null||M.clearOutline(U)}catch(fe){console.warn(fe),(Y=B.canvas)!=null&&Y.tempOutline&&(B.canvas.tempOutline=null)}},Z=()=>{ot.destroyClipperHelper(),ot.destroyOutlineHelper()};function ae(){C(!0),Z(),nt()}return(U,M)=>{const Y=qe,fe=ve,V=ee,O=$e,Q=Ae,q=In,te=Ce,ne=De,re=ie;return y(),T(re,null,{default:g(()=>[d(Q,{center:""},{title:g(()=>[w("div",mo,[w("div",vo,[d(Y,{label:p(h)},null,8,["label"])]),w("div",null,[d(p(me),j({id:"offset",style:{float:"right",width:"70px",padding:"0",margin:"0"}},b,{min:p(c),max:p(v),"model-value":r.value,readonly:"",onClick:M[0]||(M[0]=_e(H=>!$.value&&(x.value=!0),["stop"]))}),null,16,["min","max","model-value"]),d(fe,{show:x.value,"onUpdate:show":M[1]||(M[1]=H=>x.value=H),title:`${p(s)("mobile.editor.modify_outline_offset")} `,inputs:[m.value],disabled:$.value,onKeyboardConfirm:f},null,8,["show","title","inputs","disabled"])])])]),label:g(()=>[w("div",fo,[d(O,j({modelValue:r.value,"onUpdate:modelValue":M[2]||(M[2]=H=>r.value=H)},b,{disabled:$.value,"bar-height":"4",onChange:E,onDragStart:p(he),onDragEnd:p(xe)}),{button:g(({value:H})=>[w("div",go,[d(V,{name:"slider-block",class:"slider-custom-button",size:"30px"}),w("div",yo,z(H),1)])]),_:1},16,["modelValue","disabled","onDragStart","onDragEnd"])])]),_:1}),d(Q,null,{default:g(()=>[d(ne,{fill:"",style:{"justify-content":"space-between"}},{default:g(()=>[d(q,{modelValue:S.value,"onUpdate:modelValue":M[3]||(M[3]=H=>S.value=H),disabled:$.value,onChange:E},{default:g(()=>[le(z(p(s)("editor.operation.extract_contours_add_inner")),1)]),_:1},8,["modelValue","disabled"]),d(te,{size:"small",plain:"",class:"btn-ok",disabled:$.value,onClick:D},{default:g(()=>[le(z(p(s)("component.button.ok")),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})}}});const ho=G(bo,[["__scopeId","data-v-62b37022"]]),xo=F({__name:"Flip",emits:["action"],setup(n,{emit:o}){const e=t=>{o("action",t)};return(t,s)=>{const a=De,l=ie;return y(),T(l,null,{default:g(()=>[d(a,{style:{height:"190px",padding:"12px 24px"},align:"start",size:"20px"},{default:g(()=>[d(Ie,{"svg-icon":"edit-flip-horizontal",onClick:s[0]||(s[0]=i=>e("flipX"))}),d(Ie,{"svg-icon":"edit-flip-vertical",onClick:s[1]||(s[1]=i=>e("flipY"))})]),_:1})]),_:1})}}}),wo=F({__name:"Group",props:{model:null},emits:["action"],setup(n,{emit:o}){const e=t=>{o("action",t)};return(t,s)=>{const a=De,l=ie;return y(),T(l,null,{default:g(()=>[d(a,{style:{height:"190px",padding:"12px 24px"},align:"start",size:"20px"},{default:g(()=>[d(Ie,{disabled:!n.model.enableGroup,"svg-icon":"edit-group",onClick:s[0]||(s[0]=i=>e("group"))},null,8,["disabled"]),d(Ie,{disabled:!n.model.enableUnGroup,"svg-icon":"edit-ungroup",onClick:s[1]||(s[1]=i=>e("un-group"))},null,8,["disabled"])]),_:1})]),_:1})}}}),Co=F({__name:"Position",props:{model:null,attrs:null},emits:["action"],setup(n){const{t:o}=ke(),e=k(!1),t=k(0),s=a=>{t.value=a,e.value=!0};return(a,l)=>{const i=ie,u=ve;return y(),L(W,null,[d(i,{class:"position-content"},{default:g(()=>[(y(!0),L(W,null,X(n.attrs.children,(_,r)=>(y(),T(p(me),j({id:_.id,key:_.id,"model-value":n.model[_.id],suffix:n.attrs.unit},_.attrs,{readonly:"",onClick:_e(c=>s(r),["stop"])}),null,16,["id","model-value","suffix","onClick"]))),128))]),_:1}),d(u,j({show:e.value,"onUpdate:show":l[0]||(l[0]=_=>e.value=_),title:`${p(o)("mobile.editor.modify_position")}(${n.attrs.unit}) `,"focus-index":t.value},{inputs:n.attrs.children}),null,16,["show","title","focus-index"])],64)}}});const ko=G(Co,[["__scopeId","data-v-9719415f"]]),So=F({__name:"Rotate",props:{model:null,attrs:null},emits:["action"],setup(n){const{t:o}=ke(),e=k(!1);return(t,s)=>{const a=ie;return y(),L(W,null,[d(a,{onClick:s[0]||(s[0]=_e(l=>e.value=!0,["stop"]))},{default:g(()=>[d(p(me),j({id:n.attrs.item.id,label:n.attrs.item.label,"model-value":n.model.angle},n.attrs.item.attrs,{readonly:""}),null,16,["id","label","model-value"])]),_:1}),d(p(ve),{show:e.value,"onUpdate:show":s[1]||(s[1]=l=>e.value=l),title:`${p(o)("mobile.editor.modify_rotation")} `,inputs:[n.attrs.item]},null,8,["show","title","inputs"])],64)}}}),Io=F({__name:"Size",props:{model:null,attrs:null},emits:["action"],setup(n){const{t:o}=Se(),e=k(!1),t=k(0),s=a=>{t.value=a,e.value=!0};return(a,l)=>{const i=me,u=ie,_=ve;return y(),L(W,null,[d(u,{class:"size-content"},{default:g(()=>[d(i,j({id:n.attrs.children[0].id,"model-value":n.model[n.attrs.children[0].id],suffix:n.attrs.unit},n.attrs.children[0].attrs,{readonly:"",onClick:l[0]||(l[0]=_e(r=>s(0),["stop"]))}),null,16,["id","model-value","suffix"]),d(i,j({id:n.attrs.children[2].id,"model-value":n.model[n.attrs.children[2].id],suffix:n.attrs.unit},n.attrs.children[2].attrs,{readonly:"",onClick:l[1]||(l[1]=_e(r=>s(2),["stop"]))}),null,16,["id","model-value","suffix"])]),_:1}),d(_,j({show:e.value,"onUpdate:show":l[2]||(l[2]=r=>e.value=r),title:`${p(o)("mobile.editor.modify_size")}(${n.attrs.unit}) `,"focus-index":t.value},{inputs:n.attrs.children}),null,16,["show","title","focus-index"])],64)}}});const $o=G(Io,[["__scopeId","data-v-a185b045"]]),Ao=F({__name:"DisplayAttrs",setup(n){const{t:o}=Se(),e=oe(),t=Ve(),s=k("");tn(()=>{s.value==="contour"&&l()});const a=($,P)=>{var N,C,Z,ae,U,M,Y;switch($){case"x":case"y":case"width":case"height":case"angle":e.selectedAttrs[$]=Number(P),(N=B.canvas)==null||N.updateSelectedAttributes({[$]:Number(P)});break;case"group":(C=B.canvas)==null||C.createGroup();break;case"un-group":(Z=B.canvas)==null||Z.breakGroup();break;case"flipX":case"flipY":(ae=B.canvas)==null||ae.flipSelected({[$]:!0});break;case"contour":l();break;case"update-lock":(U=B.canvas)==null||U.updateLockAspectRatio();break;case"align":(M=B.canvas)==null||M.align(P);break;case"layer":console.log(P),(Y=B.canvas)==null||Y.updateSelectedAttributes(P);break}};function l(){s.value=""}const i=[{id:"group",title:"editor.context_menu.group",icon:"group"},{id:"contour",title:"editor.operation.extract_contours",icon:"contour"},{id:"align",title:"editor.operation.align",icon:"align"},{id:"flip",title:"editor.operation.flip",icon:"flip"},{id:"position",title:"editor.display.position",icon:"position"},{id:"size",title:"editor.display.size",icon:"size"},{id:"rotate",title:"editor.display.rotate",icon:"rotate"},{id:"layer",title:"editor.layer.move_to",icon:"move"}],{unit:{fractionDigits:u,scale:_,step:r,current:c}}=t,v=I(()=>({cmp:wo,model:{enableGroup:!e.currentState.isGroup&&e.selected.num>1,enableUnGroup:e.currentState.isGroup},action:a})),b=I(()=>({cmp:ho,action:a})),h=I(()=>({cmp:ko,model:{x:e.selectedAttrs.x,y:e.selectedAttrs.y},attrs:{unit:c,children:[{id:"x",type:"number",value:e.selectedAttrs.x,attrs:{defaultValue:0,step:r,scale:_,fractionDigits:u,label:o("editor.display.position_x"),labelWidth:"24px",valueWidth:"120px",onChange:($,P)=>{a(P,$)}},keyboardAttrs:{extraKey:["-","."]}},{id:"y",type:"number",value:e.selectedAttrs.y,attrs:{defaultValue:0,step:r,scale:_,fractionDigits:u,label:o("editor.display.position_y"),labelWidth:"24px",valueWidth:"120px",onChange:($,P)=>{a(P,$)}},keyboardAttrs:{extraKey:["-","."]}}]}})),m=I(()=>e.selectedAttrs.lockRatio),f=I(()=>({cmp:$o,model:{width:e.selectedAttrs.width,height:e.selectedAttrs.height,lockRatio:e.selectedAttrs.lockRatio},attrs:{unit:c,children:[{id:"width",type:"number",value:e.selectedAttrs.width,attrs:{defaultValue:0,step:r,scale:_,fractionDigits:u,min:0,label:o("editor.display.size_width"),labelWidth:"24px",valueWidth:"120px",onChange:($,P)=>{a(P,$)}},keyboardAttrs:{extraKey:["."]}},{id:"update-lock",type:"component",cmp:ce(to),attrs:{icon:m.value?"lock":"unlock",onClick:()=>{a("update-lock",m.value)}}},{id:"height",type:"number",value:e.selectedAttrs.height,attrs:{defaultValue:0,step:r,scale:_,fractionDigits:u,min:0,label:o("editor.display.size_height"),labelWidth:"24px",valueWidth:"120px",onChange:($,P)=>{a(P,$)}},keyboardAttrs:{extraKey:["."]}}]}})),S=I(()=>({cmp:So,model:{angle:e.selectedAttrs.angle},attrs:{item:{id:"angle",type:"number",label:o("mobile.editor.modify_rotation"),value:e.selectedAttrs.angle,attrs:{defaultValue:0,min:-360,max:360,step:.1,fractionDigits:1,valueWidth:"100px",showValRange:!0,suffix:o("editor.display.rotate_angle"),onChange:($,P)=>{a(P,$)}},keyboardAttrs:{extraKey:["-","."]}}}})),A=I(()=>({cmp:xo,action:a})),x=I(()=>({cmp:io,action:a,model:{enableAlign:e.selected.num>1,enableDistribute:e.selected.num>2}})),E=I(()=>({cmp:_o,action:a})),D=I(()=>({group:v.value,size:f.value,position:h.value,contour:b.value,rotate:S.value,flip:A.value,align:x.value,layer:E.value})),R=$=>{s.value=$};return($,P)=>{const N=It;return y(),T(N,{active:s.value,"active-comp":p(D)[s.value],"action-list":i,onChange:R},null,8,["active","active-comp"])}}}),Do=F({__name:"RoundButton",props:{svgIcon:{default:void 0},svgIconSize:{default:"14px"},svgIconAttrs:{default:void 0},active:{type:Boolean,default:!1}},setup(n){const o=n,e=I(()=>{var t;return((t=o.svgIconAttrs)==null?void 0:t.name)??o.svgIcon});return(t,s)=>{const a=Ce;return y(),T(a,j({plain:"",round:"",size:"small",class:["round-button",{"round-button__active":n.active}]},t.$attrs),ht({_:2},[X(t.$slots,(l,i)=>({name:i,fn:g(u=>[nn(t.$slots,i,on(an(u??{})),void 0,!0)])})),!t.$slots.icon&&p(e)?{name:"icon",fn:g(()=>[d(p(ee),j({name:p(e),size:n.svgIconSize},n.svgIconAttrs),null,16,["name","size"])]),key:"0"}:void 0]),1040,["class"])}}});const Po=G(Do,[["__scopeId","data-v-4cef3fdc"]]),To=F({__name:"RadioButtonGroup",props:{value:null,options:null,label:{default:""},buttonStyle:{default:()=>({})},svgIconAttrs:{default:void 0},disabled:{type:Boolean}},emits:["update:value","change"],setup(n,{emit:o}){const e=n,t=I({get(){return e.value},set(a){o("update:value",a)}}),s=a=>{o("change",a)};return(a,l)=>{const i=ft,u=De,_=gt,r=Pe;return y(),T(r,{label:e.label},{input:g(()=>[d(_,{modelValue:p(t),"onUpdate:modelValue":l[0]||(l[0]=c=>be(t)?t.value=c:null),direction:"horizontal",disabled:n.disabled,onChange:s},{default:g(()=>[d(u,{size:"10px",wrap:""},{default:g(()=>[(y(!0),L(W,null,X(e.options,c=>(y(),T(i,{key:c.value,name:c.value,disabled:n.disabled},{icon:g(()=>[]),default:g(()=>[d(p(Po),{"svg-icon-attrs":n.svgIconAttrs,active:p(t)===c.value,disabled:n.disabled,onPointerup:v=>!n.disabled&&(t.value=c.value)},{default:g(()=>[le(z(c.label),1)]),_:2},1032,["svg-icon-attrs","active","disabled","onPointerup"])]),_:2},1032,["name","disabled"]))),128))]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1},8,["label"])}}});const Me=G(To,[["__scopeId","data-v-b6e40653"]]),Eo=w("span",{style:{"font-size":"18px","font-weight":"bold"}},"✓",-1),Lo=F({__name:"FontList",props:{modelValue:null,options:null},emits:["update:modelValue","change"],setup(n,{emit:o}){const e=n;Te(()=>{setTimeout(()=>{l()})});const t=k(e.modelValue.slice(0)),s=k(null);let a;K(()=>e.modelValue,_=>{console.log("family-list modelValue change:",e.modelValue),!Ne(_,t.value)&&!Ne(_,a)&&(t.value=_.slice(0),setTimeout(()=>{l()}))},{deep:!0}),K(t,_=>{Ne(_,e.modelValue)||(a=_.slice(0),o("update:modelValue",a))},{immediate:!0});function l(){var r;const _=(r=s.value)==null?void 0:r.querySelector(".is-selected");_==null||_.scrollIntoView({block:"center"})}const i=_=>{u(1,_)},u=(_,r)=>{t.value[_]=r.value;const c={selectedValues:t.value.slice()};console.log("payload",c),Oe(()=>{o("change",c)})};return(_,r)=>{const c=Ae,v=$n,b=ze,h=Ue;return y(),L("div",{ref_key:"wrapper",ref:s,style:{"min-height":"300px"}},[d(h,{active:t.value[0],"onUpdate:active":r[0]||(r[0]=m=>t.value[0]=m),border:!0,class:"family-list-container"},{default:g(()=>[(y(!0),L(W,null,X(n.options,m=>(y(),T(b,{key:m.value,title:m.text,name:m.value,class:"tab-container"},{default:g(()=>[d(v,{class:"list-container"},{default:g(()=>[(y(!0),L(W,null,X(m.children,f=>(y(),T(c,{key:f.value,title:f.text,"data-option":f,class:ue({"is-selected":t.value[1]===f.value,[f.postscriptName]:!0}),style:pe(`font-family: ${f.postscriptName??"unset"}`),onClick:S=>i(f)},ht({_:2},[t.value[1]===f.value?{name:"right-icon",fn:g(()=>[Eo]),key:"0"}:void 0]),1032,["title","data-option","class","style","onClick"]))),128))]),_:2},1024)]),_:2},1032,["title","name"]))),128))]),_:1},8,["active"])],512)}}});const Vo=F({__name:"FamilySelect",props:{value:null,options:null},emits:["change"],setup(n,{emit:o}){const e=n,t=k(!1),s=I(()=>{let i="";const[u,_]=e.value,r=e.options.find(c=>c.value===u);if(r){const c=r.children.find(v=>v.value===_);c&&(i=c.text)}return i}),a=k(e.value);K(t,i=>{i&&(a.value=[],Oe(()=>{a.value=e.value}))});const l=({selectedValues:i})=>{o("change",i),setTimeout(()=>{t.value=!1})};return(i,u)=>{const _=Pe,r=Ye;return y(),L(W,null,[d(_,{"model-value":p(s),"is-link":"",readonly:"","input-align":"left",name:"picker",placeholder:"",onClick:u[0]||(u[0]=c=>t.value=!0)},null,8,["model-value"]),d(r,{show:t.value,"onUpdate:show":u[1]||(u[1]=c=>t.value=c),position:"bottom",round:"",teleport:"#app","overlay-style":{background:"rgb(0 0 0 / 20%)"}},{default:g(()=>[d(Lo,{"model-value":a.value,options:e.options,onChange:l},null,8,["model-value","options"])]),_:1},8,["show","overlay-style"])],64)}}}),Oo={class:"number-slider__wrapper"},Fo={class:"custom-tooltip-wrap"},Ro={class:"tooltip-content"},zo=F({__name:"NumberSlider",props:{value:null,label:{default:""},labelWidth:{default:"48px"},valueWidth:{default:"72px"},valueShow:{type:Boolean,default:!0},sliderShow:{type:Boolean,default:!0},min:{default:0},max:{default:100},step:{default:1},fractionDigits:{default:0},fieldAttrs:{default:()=>({})},sliderAttrs:{default:()=>({})}},emits:["update:value","change"],setup(n,{emit:o}){const e=n,{t}=ke(),s=k(!1);let a=!1;const l=I({get(){return Mt(e.value,e.fractionDigits)},set(r){a&&o("update:value",r)}}),i=r=>{o("change",r)};Te(()=>{a=!0});const u=k({id:"fontSize",type:"number",value:l,attrs:{valueWidth:"100px",step:e.step,min:e.min,max:e.max,fractionDigits:e.fractionDigits,showValRange:!0,onChange:r=>{l.value=r}},keyboardAttrs:{extraKey:["-","."]}}),_=r=>{i(r)};return(r,c)=>{const v=ee,b=$e,h=ve;return y(),L("div",Oo,[e.label?(y(),L("div",{key:0,class:"number-slider__label",style:pe(`width: ${e.labelWidth}`)},z(e.label),5)):J("",!0),e.sliderShow?(y(),T(b,j({key:1,modelValue:p(l),"onUpdate:modelValue":c[0]||(c[0]=m=>be(l)?l.value=m:null),class:"number-slider__slider",min:e.min,max:e.max,step:e.step},e.sliderAttrs,{"bar-height":"4",onChange:i,onDragStart:p(he),onDragEnd:p(xe)}),{button:g(({value:m})=>[w("div",Fo,[d(v,{name:"slider-block",class:"slider-custom-button",size:"30px"}),w("div",Ro,z(m),1)])]),_:1},16,["modelValue","min","max","step","onDragStart","onDragEnd"])):J("",!0),e.valueShow?(y(),T(p(me),{key:2,modelValue:p(l),"onUpdate:modelValue":c[1]||(c[1]=m=>be(l)?l.value=m:null),min:e.min,max:e.max,"fraction-digits":e.fractionDigits,"label-width":0,"input-align":"right",style:pe(`width: ${e.valueWidth}`),class:"number-slider__value",readonly:"",onClick:c[2]||(c[2]=_e(m=>s.value=!0,["stop"]))},null,8,["modelValue","min","max","fraction-digits","style"])):J("",!0),d(h,{show:s.value,"onUpdate:show":c[3]||(c[3]=m=>s.value=m),title:`${p(t)("editor.display.text_size")}(pt)`,inputs:[u.value],onKeyboardConfirm:_},null,8,["show","title","inputs"])])}}});const He=G(zo,[["__scopeId","data-v-280447ae"]]),Uo={class:"custom-tooltip-wrap"},Bo=["onMousedown","onTouchstart"],No=F({__name:"ShareSliderGroup",props:{children:null},emits:["change"],setup(n,{emit:o}){const e=n,t=k(0),s=I(()=>{var a;return(a=e.children)==null?void 0:a[t.value]});return(a,l)=>{const i=ee,u=$e,_=Pe;return y(),L("div",null,[p(s)&&p(s).type==="number"?(y(),T(_,{key:0,class:"spacing-slider-wrapper"},{input:g(()=>[d(u,j({modelValue:p(s).value,"onUpdate:modelValue":l[0]||(l[0]=r=>p(s).value=r)},p(s).attrs,{"bar-height":"4",onChange:l[1]||(l[1]=r=>o("change",r,p(s))),onDragStart:p(he),onDragEnd:p(xe)}),{button:g(()=>[w("div",Uo,[d(i,{name:"slider-block",class:"slider-custom-button",size:"30px"})])]),_:1},16,["modelValue","onDragStart","onDragEnd"])]),_:1})):J("",!0),a.$slots.default?(y(!0),L(W,{key:1},X(a.$slots.default()[0].children,(r,c)=>(y(),L("div",{key:r.key,class:ue(["share-slider-item",{"share-slider-item__selected":t.value===c}]),onMousedown:v=>t.value=c,onTouchstart:v=>t.value=c},[(y(),T(we(r)))],42,Bo))),128)):J("",!0)])}}});const Mo=G(No,[["__scopeId","data-v-a9a2fbf0"]]),Ho={[at.BUILD_IN]:"editor.display.proposed_fonts",[at.SYSTEM]:"editor.display.local_fonts"};function Go(n,o,e){const t=[],s=Dt(o);for(const a of Object.values(n)){const l=jo(a.fonts,{locale:s,labelKey:"text"}).sort((u,_)=>{var r,c;return((c=(r=u==null?void 0:u.text)==null?void 0:r.localeCompare)==null?void 0:c.call(r,_==null?void 0:_.text,o))??0}),i={type:"group",key:a.key,value:a.key,label:e(Ho[a.key]),get text(){return this.label},children:l};i.children.length&&t.push(i)}return t}function Wo(n,o,e){var i;const{fontSource:t,fontFamily:s}=n,a=(i=o[t])==null?void 0:i.fonts[s],l=Dt(e);return a?$t(a.subFontFamilys,{locale:l}):[]}function jo(n,{locale:o="en",labelKey:e="label"}={}){return n?Object.entries(n).map(([t,s])=>({...s,value:At({fontFamily:t,fontSource:s.source}),[e]:St(s.names,o),subFontFamilys:$t(s.subFontFamilys,{locale:o,labelKey:e})})):[]}function $t(n,{locale:o="en",labelKey:e="label"}={}){return n?Object.entries(n).map(([t,s])=>({...s,value:t,[e]:St(s.names,o)})):[]}async function Ko(n){try{const o=Ht(n),e=Gt(o);Re.setCurrentFont(e),console.log("set current font",e),await Re.resolveFont(e).catch(console.warn),await Re.preloadTextGlyphs({...o,text:n.text})}catch(o){console.warn(o)}}function Yo(n,o,e){var l,i;const{fontSource:t,fontFamily:s}=n,a=(i=(l=e==null?void 0:e[t])==null?void 0:l.fonts)==null?void 0:i[s];if(!a)console.warn("font not found",{fontSource:t,fontFamily:s});else if(!a.subFontFamilys[o]){const _=a.subFontFamilys.Regular??Object.values(a.subFontFamilys)[0];if(_){const r=_.subfamilyName;console.log("adjust subfamily:",r),Object.assign(n,{fontSubfamily:r})}}return n}function At(n){return Re.getFamilyItem(n)?JSON.stringify({fontSource:n.fontSource,fontFamily:n.fontFamily}):n.fontFamily??""}function Xo(n){let o={fontFamily:"",fontSource:""};try{n&&(o=JSON.parse(n))}catch{}return o}function Dt(n){let o;return n==="zh-CN"?o="zh":n==="zh-hant"?o="zh-TW":n==="en-US"?o="en":o=n,o}const qo=F({__name:"Font",setup(n){const o=k(!1),e=["text","fontFamily","fontSubfamily"],t=oe(),s=Ve(),{t:a}=ke(),l=k(x=>x.replace(/\u2006/g,"")),i=async(x,E)=>{console.log("[ onFormChange ]",{id:E.id,value:x,props:E});const{id:D}=E;let R={[D]:x};if(D==="operations"&&x==="text-weld"){t.textWeld();return}if(D!=="text"&&(R={style:R}),D==="fontFamily"){const{fontSource:$,fontFamily:P}=Xo(x[1]),N={fontSource:$,fontFamily:P},C=t.selectedAttrs.style.fontSubfamily,Z=u.value;Yo(N,C,Z),R={style:N}}mn(t.selectedAttrs,R),e.includes(D)&&await Ko(t.selectedAttrs).catch(console.warn),t.canvasDisplayAttrsUpdate(R)},u=I(()=>t.fonts),_=I(()=>Go(t.fonts,s.langKey,a)),r=I(()=>Wo(t.selectedAttrs.style,t.fonts,s.langKey)),c=k({id:"text",title:a("editor.display.text_input"),value:t.selectedAttrs.text??"",placeholder:a("editor.display.text_placeholder")}),v=k(c.value.value),b=x=>{const{text:E="",style:D}=x,R=[D.fontSource??"",At({fontFamily:D.fontFamily,fontSource:D.fontSource})];return[{id:"fontFamily",title:a("editor.display.font_family"),cmp:ce(Vo),value:R,attrs:{options:_}},{id:"fontSize",title:`${a("editor.display.text_size")}(pt)`,cmp:ce(He),value:Math.min(D.fontSize??72,3e3),attrs:{step:1,size:"small",min:1,max:3e3,fractionDigits:2,labelWidth:"48px",valueWidth:"72px",sliderShow:!0}},{id:"fontSubfamily",title:a("editor.display.font_style"),cmp:ce(Me),value:(D==null?void 0:D.fontSubfamily)??"",attrs:{options:r}},{id:"spacings",title:a("mobile.editor.font_spacing"),value:"",cmp:ce(Mo),attrs:{children:[{id:"letterSpacing",title:a("editor.display.letter_spacing"),cmp:ce(He),type:"number",value:(D==null?void 0:D.letterSpacing)??0,attrs:{step:.1,min:-20,max:100,fractionDigits:1,label:a("editor.display.letter_spacing"),sliderShow:!1,labelWidth:"40px",valueWidth:"72px"}},{id:"leading",title:a("editor.display.line_leading"),cmp:ce(He),type:"number",value:(D==null?void 0:D.leading)??0,attrs:{step:.1,min:-20,max:100,fractionDigits:1,label:a("editor.display.line_leading"),sliderShow:!1,labelWidth:"40px",valueWidth:"72px"}}]}},{id:"align",title:a("editor.display.text_align"),cmp:ce(Me),value:(D==null?void 0:D.align)??"left",attrs:{options:[{value:"left",label:a("editor.display.text_align_left")},{value:"center",label:a("editor.display.text_align_middle")},{value:"right",label:a("editor.display.text_align_right")}]}},{id:"operations",title:a("editor.display.text_operations"),cmp:ce(Me),value:(D==null?void 0:D.align)??"left",attrs:{options:[{value:"text-weld",label:a("editor.display.text_weld")}],disabled:E.replace(/\s/g,"").length<2}}]},h=I(()=>t.selectedAttrs),m=k(b(h.value));K(h,x=>{x.type===We.TEXT&&x.id&&(c.value.value=x.text,m.value=b(x))});const f=k(m.value[0].id),S=async()=>{let x=v.value.replace(/\u2006/g,"");c.value.value=x,await i(x,c.value)},A=()=>{v.value=c.value.value};return(x,E)=>{const D=Pe,R=yt,$=ie,P=ze,N=Ue;return y(),T($,null,{default:g(()=>[d(D,{modelValue:c.value.value,"onUpdate:modelValue":[E[0]||(E[0]=C=>c.value.value=C),E[2]||(E[2]=C=>i(C,c.value))],class:"text-input",type:"text",readonly:"",placeholder:c.value.placeholder,onClick:E[1]||(E[1]=C=>o.value=!0)},null,8,["modelValue","placeholder"]),d(R,{show:o.value,"onUpdate:show":E[4]||(E[4]=C=>o.value=C),title:x.$t("mobile.editor.input_font"),teleport:"#app","show-cancel-button":"","confirm-button-text":x.$t("common.msg.ok"),"cancel-button-text":x.$t("common.msg.cancel"),onConfirm:S,onCancel:A},{default:g(()=>[d(D,{ref:"textareaRef",modelValue:v.value,"onUpdate:modelValue":E[3]||(E[3]=C=>v.value=C),type:"textarea",class:"text-input",autofocus:"",formatter:l.value,placeholder:c.value.placeholder},null,8,["modelValue","formatter","placeholder"])]),_:1},8,["show","title","confirm-button-text","cancel-button-text"]),d(N,{active:f.value,"onUpdate:active":E[5]||(E[5]=C=>f.value=C)},{default:g(()=>[(y(!0),L(W,null,X(m.value,C=>(y(),T(P,{key:C.id,name:C.id,title:C.title},{default:g(()=>[d($,{class:"font-setting-wrap"},{default:g(()=>[(y(),T(we(C.cmp),j({value:C.value,"onUpdate:value":Z=>C.value=Z},C.attrs,{onChange:(Z,ae=C)=>i(Z,ae)}),{default:g(()=>{var Z,ae;return[(Z=C.attrs)!=null&&Z.children?(y(!0),L(W,{key:0},X((ae=C.attrs)==null?void 0:ae.children,U=>(y(),T(we(U.cmp),j({key:U.id,value:U.value,"onUpdate:value":M=>U.value=M},U.attrs,{onChange:M=>i(M,U)}),null,16,["value","onUpdate:value","onChange"]))),128)):J("",!0)]}),_:2},1040,["value","onUpdate:value","onChange"]))]),_:2},1024)]),_:2},1032,["name","title"]))),128))]),_:1},8,["active"])]),_:1})}}});const Jo=G(qo,[["__scopeId","data-v-9713ae87"]]),Zo={class:"van-cell-title"},Qo={style:{"margin-bottom":"10px"}},ea={class:"custom-tooltip-wrap"},ta={class:"tooltip-content"},na=F({__name:"Eraser",props:{value:{type:Object,default:()=>({})},label:{type:String,default:""}},emits:["update:value","change"],setup(n,{emit:o}){const e=n,t=k(e.value.size);K(()=>t.value,r=>{o("update:value",{size:r})});const s=r=>{o("change",{tool:ye.ERASER,options:{size:r}})},a=k(!1),l=k(0),i=k(100),u=I(()=>Qe({type:"number",value:t,attrs:{min:l.value,max:i.value,showValRange:!0,valueWidth:"100px"}})),_=r=>{s(r)};return K(()=>e.value.size,r=>{t.value=r}),(r,c)=>{const v=qe,b=me,h=ve,m=ee,f=$e,S=Ae;return y(),T(S,null,{title:g(()=>[w("div",Zo,[w("div",null,[d(v,{label:e.label},null,8,["label"])]),w("div",null,[d(b,{style:{float:"right",width:"70px",padding:"0",margin:"0"},min:l.value,max:i.value,"model-value":t.value,readonly:"",onClick:c[0]||(c[0]=_e(A=>a.value=!0,["stop"]))},null,8,["min","max","model-value"]),d(h,{show:a.value,"onUpdate:show":c[1]||(c[1]=A=>a.value=A),title:e.label,inputs:[p(u)],onKeyboardConfirm:_},null,8,["show","title","inputs"])])])]),label:g(()=>[w("div",Qo,[d(f,{modelValue:t.value,"onUpdate:modelValue":c[2]||(c[2]=A=>t.value=A),min:l.value,max:i.value,step:1,"bar-height":"4",onChange:s,onDragStart:p(he),onDragEnd:p(xe)},{button:g(({value:A})=>[w("div",ea,[d(m,{name:"slider-block",class:"slider-custom-button",size:"30px"}),w("div",ta,z(A),1)])]),_:1},8,["modelValue","min","max","onDragStart","onDragEnd"])])]),_:1})}}});const oa=G(na,[["__scopeId","data-v-b2b13af0"]]),aa={class:"van-cell-title"},sa={style:{"margin-bottom":"10px"}},la={class:"custom-tooltip-wrap"},ia={class:"tooltip-content"},ra=F({__name:"SmartSelection",props:{value:{type:Object,default:()=>({})},label:{type:String,default:""}},emits:["update:value","change"],setup(n,{emit:o}){const e=n,t=k(e.value.aberration);K(()=>t.value,r=>{o("update:value",{aberration:r})});const s=r=>{o("change",{tool:ye.MAGIC_WAND,options:{aberration:r}})},a=k(!1),l=k(0),i=k(100),u=I(()=>Qe({type:"number",value:t,attrs:{min:l.value,max:i.value,showValRange:!0,valueWidth:"100px",onChange:c=>{t.value=c}}})),_=r=>{s(r)};return K(()=>e.value.aberration,r=>{t.value=r}),(r,c)=>{const v=qe,b=me,h=ve,m=ee,f=$e,S=Ae;return y(),T(S,null,{title:g(()=>[w("div",aa,[w("div",null,[d(v,{label:e.label},null,8,["label"])]),w("div",null,[d(b,{style:{float:"right",width:"70px",padding:"0",margin:"0"},min:l.value,max:i.value,"model-value":t.value,readonly:"",onClick:c[0]||(c[0]=_e(A=>a.value=!0,["stop"]))},null,8,["min","max","model-value"]),d(h,{show:a.value,"onUpdate:show":c[1]||(c[1]=A=>a.value=A),title:e.label,inputs:[p(u)],onKeyboardConfirm:_},null,8,["show","title","inputs"])])])]),label:g(()=>[w("div",sa,[d(f,{modelValue:t.value,"onUpdate:modelValue":c[2]||(c[2]=A=>t.value=A),min:l.value,max:i.value,step:1,"bar-height":"4",onChange:s,onDragStart:p(he),onDragEnd:p(xe)},{button:g(({value:A})=>[w("div",la,[d(m,{name:"slider-block",class:"slider-custom-button",size:"30px"}),w("div",ia,z(A),1)])]),_:1},8,["modelValue","min","max","onDragStart","onDragEnd"])])]),_:1})}}});const ca=G(ra,[["__scopeId","data-v-3ffee39e"]]),da=F({__name:"ImageEditor",emits:["hideImageEditor"],setup(n,{emit:o}){const{t:e}=ke(),t=oe(),s=sn([{id:ye.MAGIC_WAND,icon:"magic-wand",title:e("editor.image_process.tool_magic_wand"),name:k("editor.image_process.tool_magic_wand"),desc:k("editor.image_process.tool_magic_wand_desc"),options:{aberration:t.imageEditorToolOptions.aberration},label:e("editor.image_process.attr_aberration"),cmp:ca},{id:ye.ERASER,icon:"eraser",title:e("editor.image_process.tool_eraser"),name:k("editor.image_process.tool_eraser"),desc:k("editor.image_process.tool_eraser_desc"),options:{size:t.imageEditorToolOptions.size},label:e("editor.image_process.attr_size"),cmp:oa},{id:ye.CUTTER,icon:"cutter",title:e("editor.image_process.tool_cutter"),name:k("editor.image_process.tool_cutter"),desc:k("editor.image_process.tool_cutter_desc"),options:{},cmp:""}]);let a=!1;Te(()=>{l()}),ln(()=>{l()});function l(){a=!0,_(u.value)}function i(){a=!1,v()}Ze(()=>{var f;a&&((f=B.canvas)==null||f.closeImageProcess(),i())});const u=k(s.value[0].id);K(u,f=>{_(f)});function _(f){const S=s.value.find(A=>A.id===f);S&&c(S.id,S.options)}const r=({tool:f,options:S})=>{c(f,S)},c=(f,S)=>{var A;(A=B.canvas)==null||A.updateImageProcessTool(f,S)},v=()=>{o("hideImageEditor")},b=()=>{var f;(f=B.canvas)==null||f.saveImageProcess(),i()},h=()=>{var f;(f=B.canvas)==null||f.closeImageProcess(),i()},m=(f,S)=>{f.options&&(Object.assign(f.options,S),t.updateImageEditorToolOptions(S))};return(f,S)=>{const A=An,x=Ce,E=Ae,D=ze,R=Ue,$=ie;return y(),T($,{style:{padding:"0 0 10px"}},{default:g(()=>[u.value!==p(ye).CUTTER?(y(),T(A,{key:0,wrapable:"",scrollable:!1,text:f.$t(`editor.image_process.${u.value===p(ye).MAGIC_WAND?"tool_magic_wand_desc":"tool_eraser_desc"}`)},null,8,["text"])):J("",!0),d(R,{active:u.value,"onUpdate:active":S[0]||(S[0]=P=>u.value=P),type:"card",style:{"padding-top":"14px"}},{default:g(()=>[(y(!0),L(W,null,X(p(s),P=>(y(),T(D,{key:P.id,name:P.id,title:P.title},{default:g(()=>[P.cmp?(y(),T(we(P.cmp),{key:0,value:P.options,label:P.label,"onUpdate:value":N=>m(P,N),onChange:r},null,40,["value","label","onUpdate:value"])):J("",!0),d(E,{class:"fuzziness-button"},{default:g(()=>[d(x,{size:"small",plain:"",onClick:h},{default:g(()=>[le(z(p(e)("component.button.cancel")),1)]),_:1}),d(x,{size:"small",type:"primary",onClick:b},{default:g(()=>[le(z(p(e)("component.button.save")),1)]),_:1})]),_:1})]),_:2},1032,["name","title"]))),128))]),_:1},8,["active"])]),_:1})}}});const ua=G(da,[["__scopeId","data-v-3b14641d"]]);const pa={style:{"text-align":"right"}},_a={class:"custom-tooltip-wrap"},ma={class:"tooltip-content sharpness"},va={style:{"text-align":"right"}},fa={class:"custom-tooltip-wrap"},ga={class:"tooltip-content left-gray"},ya={class:"custom-tooltip-wrap"},ba={class:"tooltip-content right-gray"},ha=F({__name:"ImageProcess",setup(n){const o=oe(),{t:e}=ke(),t=I({get(){return o.selectedAttrs.sharpness??50},set(v){o.selectedAttrs.sharpness=v}}),s=I({get(){return o.selectedAttrs.grayValue??[10,20]},set(v){o.selectedAttrs.grayValue=v}}),a=I({get(){return o.selectedAttrs.colorInverted},set(v){o.selectedAttrs.colorInverted=v}}),l=I({get(){const v=o.selectedAttrs.filterList;return v.length>0?v[0]:""},set(v){o.selectedAttrs.filterList=v?[v]:[]}}),i=v=>{v&&o.canvasDisplayAttrsUpdate(v)},u=()=>{var v;o.updateImageEditorVisible(!0),(v=B.canvas)==null||v.processImage(!1)},_=k(!1),r=Qe({type:"number",value:t,attrs:{min:0,max:100,showValRange:!0,valueWidth:"100px",onChange:v=>{t.value=v}}}),c=v=>{v&&o.canvasDisplayAttrsUpdate({sharpness:{value:v}})};return(v,b)=>{const h=Kn,m=me,f=ve,S=Yn,A=ee,x=$e,E=Ae,D=ft,R=gt,$=Pe,P=Wt,N=ie;return y(),T(N,null,{default:g(()=>[d(E,{center:"",class:"image-custom-wrap"},{title:g(()=>[d(S,null,{default:g(()=>[d(h,{span:12},{default:g(()=>[le(z(p(e)("editor.display.sharpness")),1)]),_:1}),(y(),T(h,{key:0,span:12},{default:g(()=>[w("div",pa,z(p(t)),1)]),_:1})),J("",!0)]),_:1})]),label:g(()=>[d(x,{modelValue:p(t),"onUpdate:modelValue":b[2]||(b[2]=C=>be(t)?t.value=C:null),min:1,max:100,style:{margin:"20px auto"},"bar-height":"4",onChange:b[3]||(b[3]=C=>i({sharpness:C})),onDragStart:b[4]||(b[4]=C=>p(he)(C,"sharpness")),onDragEnd:p(xe)},{button:g(({value:C})=>[w("div",_a,[d(A,{name:"slider-block",class:"slider-custom-button",size:"30px"}),w("div",ma,z(C),1)])]),_:1},8,["modelValue","onDragEnd"])]),_:1}),d(E,{center:"",class:"image-custom-wrap"},{title:g(()=>[d(S,null,{default:g(()=>[d(h,{span:12},{default:g(()=>[le(z(p(e)("editor.display.gray_value")),1)]),_:1}),d(h,{span:12},{default:g(()=>[w("div",va,z(`${p(s)[0]}~${p(s)[1]}`),1)]),_:1})]),_:1})]),label:g(()=>[d(x,{modelValue:p(s),"onUpdate:modelValue":b[5]||(b[5]=C=>be(s)?s.value=C:null),range:"",min:0,max:255,step:1,style:{margin:"20px auto"},"bar-height":"4",onChange:b[6]||(b[6]=C=>i({grayValue:C})),onDragStart:b[7]||(b[7]=C=>p(he)(C,"gray")),onDragEnd:p(xe)},{"left-button":g(({value:C})=>[w("div",fa,[d(A,{name:"slider-block",class:"slider-custom-button",size:"30px"}),w("div",ga,z(C),1)])]),"right-button":g(({value:C})=>[w("div",ya,[d(A,{name:"slider-block",class:"slider-custom-button",size:"30px"}),w("div",ba,z(C),1)])]),_:1},8,["modelValue","onDragEnd"])]),_:1}),d($,{class:"image-bold-wrap newline-radio-wrap",name:"radio","input-align":"right",label:p(e)("editor.display.filter")},{input:g(()=>[d(R,{modelValue:p(l),"onUpdate:modelValue":b[8]||(b[8]=C=>be(l)?l.value=C:null),direction:"horizontal",onChange:b[9]||(b[9]=C=>i({filterList:C?[C]:[]}))},{default:g(()=>[d(D,{name:""},{default:g(()=>[le(z(p(e)("editor.filter.null")),1)]),_:1}),d(D,{name:"dot"},{default:g(()=>[le(z(p(e)("editor.filter.grid")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),d($,{class:"image-bold-wrap",name:"switch","input-align":"right",label:p(e)("editor.display.color_inverted")},{input:g(()=>[d(P,{modelValue:p(a),"onUpdate:modelValue":b[10]||(b[10]=C=>be(a)?a.value=C:null),size:"18px",onChange:b[11]||(b[11]=C=>i({colorInverted:C}))},null,8,["modelValue"])]),_:1},8,["label"]),d(E,{class:"image-bold-wrap",title:p(e)("editor.image_process.entry"),"is-link":"",onClick:u},null,8,["title"])]),_:1})}}});const xa=G(ha,[["__scopeId","data-v-a780e31c"]]);const wa=F({__name:"Imports",setup(n){const o=oe(),{t:e}=Se(),t=k(!1),s=I(()=>[{name:e("mobile.editor.photo"),id:0},{name:e("mobile.editor.open_photo_album"),id:1},{name:e("mobile.editor.my_system_file"),id:2}]),a=async c=>{const{id:v}=c;if(v===0&&!await jt(e("mobile.toast.camera_not_authorized"),e("mobile.toast.camera_not_authorized_text"),e("mobile.common.go_to_setting"),e("mobile.common.not_yet")))return;let b;try{const h=await Kt("",v);h!==""&&(b=bt({message:e("device.status.loading"),overlay:!0,duration:0}),await o.loadResToCanvas({file:h,offsetX:st,offsetY:lt}))}catch(h){console.log(h);const m="jpg/jpeg/gif/png/bmp/svg/dxf/webp";Yt({title:e("device.modal.tip"),message:e("mobile.projects.dialog_open_file_error",{fileType:m}),confirmButtonText:e("common.msg.ok")})}finally{b==null||b.close()}},l=rn({loader:()=>vn(()=>import("./xcs-mobile-src-components-shapes-panel-3a5b0fb7.js"),["./xcs-mobile-src-components-shapes-panel-3a5b0fb7.js","../assets/index-83a10b2e.js","./index-55948043.js","./xcs-vue-family-70642f71.js","./xcs-canvas-5c2592d6.js","./griditem.vue_vue_type_style_index_0_scoped_39934db8_lang-b0c8362c.js"],import.meta.url)}),i=k(!1),u=c=>{i.value=c},_=async c=>{const{name:v,file:b}=c,h=await fetch(b).then(f=>f.arrayBuffer()),m=new File([h],`${v}.svg`);o.loadResToCanvas({file:m,offsetX:st,offsetY:lt,parseColor:!1}),u(!1)},r=[{id:"importImage",title:"mobile.editor.import_image",icon:"import-image",onClick:async()=>{t.value=!0}},{id:"insertFonts",title:"mobile.editor.insert_fonts",icon:"insert-fonts",onClick:async()=>{await o.addTextToCanvas()}},{id:"insertGraphics",title:"mobile.editor.insert_graphics",icon:"insert-graphics",onClick:()=>{u(!0)}}];return(c,v)=>{const b=It,h=Un;return y(),L(W,null,[d(b,{active:"","action-list":r}),d(p(l),{visible:i.value,onClickOverlay:v[0]||(v[0]=m=>u(!1)),onSelectedItem:_},null,8,["visible"]),d(h,{show:t.value,"onUpdate:show":v[1]||(v[1]=m=>t.value=m),actions:p(s),teleport:"body","cancel-text":c.$t("mobile.common.cancel"),"close-on-click-action":"",onSelect:a},null,8,["show","actions","cancel-text"])],64)}}}),Ca={class:"selected-different-type"},ka=F({__name:"DifferentTypeTip",emits:["handleSelectVector","handleSelectBitmap"],setup(n,{emit:o}){const e=()=>{o("handleSelectVector")},t=()=>{o("handleSelectBitmap")};return(s,a)=>{const l=Ce,i=De;return y(),L("div",null,[w("section",Ca,z(s.$t("device.element_container.cant_set_params_for_both")),1),d(i,{fill:"",direction:"vertical",class:"selected-element-buttons"},{default:g(()=>[d(l,{plain:"",type:"default",block:"",onClick:e},{default:g(()=>[le(z(s.$t("device.element_container.select_vector")),1)]),_:1}),d(l,{plain:"",type:"default",block:"",onClick:t},{default:g(()=>[le(z(s.$t("device.element_container.select_bitmap")),1)]),_:1})]),_:1})])}}});const Sa=G(ka,[["__scopeId","data-v-dd90e0e9"]]),Ia=F({__name:"ProcessSettingNext",setup(n){const{updateSelectedElements:o,deviceValues:e,elementValues:t,elementDataHandler:s}=Dn(),a=Je(),l=oe(),i=I(()=>a.ext),u=I(()=>{var S;const m=[...new Set(l.selectedList.map(A=>A.type==="BITMAP"?"BITMAP":"VECTOR"))].length;return m>0&&m!==1?Sa:(S=i.value)==null?void 0:S.ui.ProcessingDataForm}),_=I(()=>l.currentId),r=I(()=>{var A;const m=l.selected.num,f=l.selectedAttrs.id;let S=[];return(m>=0||f)&&(S=((A=B.canvas)==null?void 0:A.exportSelectedJSON())||[]),o(S),S}),c=I(()=>a.info),v=I(()=>fn(xt(r.value,"type").map(f=>f==="BITMAP"?"BITMAP":"VECTOR"))),b=()=>{h(!1)},h=(m=!0)=>{const f=B.canvas;if(f){const S=f.selected;S&&(f.selected=S.filter(A=>m?A.type==="BITMAP":A.type!=="BITMAP"))}};return(m,f)=>(y(),T(we(p(u)),{ext:p(i),"canvas-id":p(_),elements:p(r),"device-info":p(c),"selected-types":p(v),"element-values":p(t),"device-values":p(e),handler:p(s),onHandleSelectVector:b,onHandleSelectBitmap:h},null,40,["ext","canvas-id","elements","device-info","selected-types","element-values","device-values","handler"]))}}),$a={class:"layer-color-dot-wrapper"},Aa={class:"layer-label"},Da=F({__name:"LayerItem",props:{selectedKey:null,layerItemData:null},emits:["updateLayer","selectItem"],setup(n,{emit:o}){const e=n;function t(a){const l=gn(a),i=l.toRgbString(),u=l.alpha(.3).toRgbString(),_=l.alpha(.06).toRgbString();return console.log(u,"activeColor---"),`
      --layer-color: ${i};
      --layer-active-color: ${u};
      --layer-active-bg-color: ${_};
    `}const s=()=>{o("selectItem",e.layerItemData)};return(a,l)=>(y(),L("div",{class:ue({"layer-item-wrapper":!0,"layer-item-wrapper-selected":n.layerItemData.key===n.selectedKey[0]}),style:pe(t(n.layerItemData.color)),onClick:s},[w("span",$a,[w("span",{class:"layer_color_dot layer-item-color-dot",style:pe(`background-color: ${n.layerItemData.color}`)},null,4)]),w("span",Aa,z(n.layerItemData.label.replace("{layer}",a.$t("editor.layer.layer"))),1)],6))}});const Pa=G(Da,[["__scopeId","data-v-0d57c639"]]),Ta={class:"layer-edit-wrap"},Ea=F({__name:"EditorLayer",props:{treeData:null,selectedKey:null},emits:["selectItem","updateLayer"],setup(n,{emit:o}){const e=n,t=oe(),{t:s}=Se(),a=k(!1),l=k("");let i=null;K(()=>e.selectedKey,v=>{Oe(()=>{window.document.getElementById("layer-"+v[0]).scrollIntoView()})});const u=v=>{const b=v.key,h=it.map(v.children,"key");o("selectItem",[String(b)],h)},_=v=>{i=v,l.value=v.label.replace("{layer}",s("editor.layer.layer")),a.value=!0},r=()=>{a.value=!1,t.editorLayerRename({name:l.value,key:(i==null?void 0:i.key)??""}),o("updateLayer")},c=v=>{Xt({title:s("editor.layer.delete_layer"),message:s("editor.layer.sure_to_delete"),confirmButtonText:s("common.msg.ok"),cancelButtonText:s("common.msg.cancel")}).then(()=>{const b=it.map(v.children,"key");t.layerSelectedRemove(b)}).catch(()=>{})};return(v,b)=>{const h=ee,m=De,f=Tn,S=Pe,A=yt;return y(),L("div",null,[(y(!0),L(W,null,X(n.treeData,x=>(y(),T(f,{id:"layer-"+x.key,key:x.key},{right:g(()=>[w("div",Ta,[d(m,null,{default:g(()=>[d(h,{name:"layer-edit",size:"32px",onClick:E=>_(x)},null,8,["onClick"]),d(h,{name:"layer-delete",size:"32px",onClick:E=>c(x)},null,8,["onClick"])]),_:2},1024)])]),default:g(()=>[d(Pa,{"layer-item-data":x,"selected-key":n.selectedKey,onSelectItem:u},null,8,["layer-item-data","selected-key"])]),_:2},1032,["id"]))),128)),d(A,{show:a.value,"onUpdate:show":b[1]||(b[1]=x=>a.value=x),"show-cancel-button":"",teleport:"#app",title:p(s)("common.msg.layer_rename"),"confirm-button-disabled":!l.value,"confirm-button-text":p(s)("common.msg.ok"),"cancel-button-text":p(s)("common.msg.cancel"),onConfirm:r},{default:g(()=>[d(S,{ref:"autoFocus",modelValue:l.value,"onUpdate:modelValue":b[0]||(b[0]=x=>l.value=x),modelModifiers:{trim:!0},maxlength:20,placeholder:p(s)("device.user_defined.name"),class:"save-as-name",clearable:"",onKeyup:cn(r,["enter"])},null,8,["modelValue","placeholder","onKeyup"])]),_:1},8,["show","title","confirm-button-disabled","confirm-button-text","cancel-button-text"])])}}});const La=G(Ea,[["__scopeId","data-v-75f59b84"]]),Va=n=>(et("data-v-6598916b"),n=n(),tt(),n),Oa={class:"layer-container-wrap"},Fa=Va(()=>w("div",{class:"layer-container-space"},null,-1)),Ra={key:0,class:"layer-content"},za={key:0,class:"not-yet-layer"},Ua=F({__name:"Layer",setup(n){const o=oe(),e=Pn("LAYER_EXPAND",!1,localStorage),t=k(e);let s=k(["black"]);const a=I(()=>pt(o.canvasList,{id:o.currentId}));K(()=>o.selected.data,h=>{l(dn(h))},{deep:!0}),K(()=>o.selected.data,h=>{h.length>0&&i(h)},{deep:!0});const l=h=>{const m=c(h);if(m.length>0){let f=m[0].key;s.value=[f],o.currentLayerUpdate({currentLayer:f})}},i=wt(l,10),u=()=>[],_=k(u()),r=h=>{var A;const m=c(h);let f=(A=a.value)==null?void 0:A.currentLayer;m.length>0?(_.value=m,pt(m,{key:f})||(f=m[0].key)):(_.value=u(),f=Be);let S={};_.value.forEach(x=>{x.key&&(S[x.key]={name:x.label,order:x.order})}),o.editorLayerDataUpdate({layerData:S}),s.value=[f],o.currentLayerUpdate({currentLayer:f})},c=h=>{var x,E,D;const m=yn(h,R=>{const $=R;return $.layerTag||($.layerTag=Be,$.layerColor=Be),$.layerTag});let f=bn(xt((x=a.value)==null?void 0:x.layerData,R=>R.order))||0;const S=R=>{var P,N;let $=(N=(((P=a.value)==null?void 0:P.layerData)||{})[R])==null?void 0:N.name;return $||(f++,$=`{layer} ${Object.keys(m).length}`),$},A=[];for(let R in m){const $=R,P=S($);A.push({key:$,order:((D=(((E=a.value)==null?void 0:E.layerData)||{})[$])==null?void 0:D.order)||f,label:P,color:$,locked:!1,isLeaf:!0,children:m[R].map(N=>({key:N.id,label:N.type,type:"shape",parent:R}))})}return A.sort((R,$)=>$.order-R.order),A},v=(h,m)=>{s.value=h,o.currentLayerUpdate({currentLayer:h[0]}),o.editorSelectSpecDisplays(m)};K(()=>o.allLayerData,h=>{r(h)},{deep:!0});const b=()=>{t.value=!t.value,localStorage.setItem("LAYER_EXPAND",String(t.value)),t.value&&Oe(()=>{window.document.getElementById("layer-"+s.value[0]).scrollIntoView()})};return(h,m)=>{const f=ee;return y(),L("div",Oa,[Fa,w("div",{class:ue(t.value?"layer-container":"layer-container-min")},[t.value?(y(),L("div",Ra,[d(p(La),{class:"editor-layer","tree-data":_.value,"selected-key":p(s),onSelectItem:v,onUpdateLayer:m[0]||(m[0]=S=>r(p(o).allLayerData))},null,8,["tree-data","selected-key"]),_.value.length===0?(y(),L("div",za,z(h.$t("editor.layer.no_layer_yet")),1)):J("",!0)])):J("",!0),w("div",{class:"toggle-layer",onClick:b},[w("span",null,z(h.$t("editor.layer.layer")),1),d(f,{name:t.value?"arrow-close":"arrow-open",size:"16px",class:"toggle-arrow"},null,8,["name"])])],2)])}}});const Ba=G(Ua,[["__scopeId","data-v-6598916b"]]),Na=F({__name:"MCanvas",props:{id:null,canvas:null,unitData:null},emits:["created","selected","transformer","changeMode","zoomed","drawDisplayDone","updateBackdropResult","updateImageProcessVisible","changeUndoHistory","newDisplaysAdded","displaysRemoved","canvasDisplayChanged"],setup(n,{emit:o}){const e=n,t=k();let s,a;return K(()=>e.unitData,l=>{const{unit:i,pixelPerUnit:u,fractionDigits:_,enableSnapping:r}=l;s.updateConfig({pixelPerUnit:u}),a.updateConfig({unit:i,pixelPerUnit:u,fractionDigits:_,enableAdsorb:r})}),Te(()=>{const l=t.value,{id:i,canvas:u,unitData:{unit:_,pixelPerUnit:r,fractionDigits:c,enableSnapping:v}}=e;if(l){const b=l.getBoundingClientRect();if(u){s=new hn(b,{positions:[_t.TOP,_t.LEFT],pixelPerUnit:r,backgroundColor:15856113,scaleColor:14014423,scaleAlpha:1,borderColor:14014423,fontColor:7633530,markColor:51200,markAlpha:.1}),a=new xn({unit:_,pixelPerUnit:r,fractionDigits:c,enableAdsorb:v}),u.registerPlugin(a),u.registerPlugin(s),u.on(wn.CHANGE,m=>{o("changeMode",m)}),u.on(ge.UPDATE_BACKDROP_RESULT,m=>{o("updateBackdropResult",m)}),u.on(ge.ZOOMED,m=>{o("zoomed",m)}),u.on(ge.DRAW_DISPLAY_DONE,()=>{o("drawDisplayDone")}),u.on(ge.UPDATE_IMAGE_PROCESS_VISIBLE,m=>{o("updateImageProcessVisible",m)}),u.on(Cn.CAN_DO_CHANGE,(m,f)=>{o("changeUndoHistory",m,f)}),u.on(ge.SELECT_OBJECT_TRANSFORMERED,(m,f)=>{o("canvasDisplayChanged",m,f)}),u.on(ge.NEW_DISPLAYS_ADDED,m=>{o("newDisplaysAdded",i,m)}),u.on(ge.DISPLAYS_REMOVED,m=>{o("displaysRemoved",m)});const h=u.exportCanvasJSON({texture:!1});o("newDisplaysAdded",i,h),l.appendChild(u.view),u.resizeCanvasTo(l),u.render()}}}),(l,i)=>(y(),L("div",{ref_key:"container",ref:t,class:"container",style:pe(l.$attrs.style)},null,4))}});const Pt=n=>(et("data-v-fddd272a"),n=n(),tt(),n),Ma={class:"expand-laser-pos-wrap"},Ha=Pt(()=>w("div",{class:"divider-line"},null,-1)),Ga={class:"position-label x-label"},Wa={class:"position-label y-label"},ja={class:"toggle-laser-pos-wrap"},Ka=Pt(()=>w("div",{class:"divider-line"},null,-1)),Ya=F({__name:"MLaserPosition",props:{ext:null,deviceInfo:null,showPosition:{type:Boolean},isInProcessing:{type:Boolean},disConnect:{type:Boolean},isFrameMode:{type:Boolean}},emits:["onChangeState"],setup(n,{emit:o}){const e=n,t="d2-canvas-plugin",s=k(!0),a=I(()=>e.isFrameMode===!1&&e.isInProcessing===!1&&e.disConnect===!1),l=k(0),i=k(0),u=I(()=>l.value%1===0?Number(l.value):Number(l.value).toFixed(1)),_=I(()=>i.value%1===0?Number(i.value):Number(i.value).toFixed(1)),r=()=>{o("onChangeState")},{t:c}=Se(),v=(b,h)=>{var P;const{x:m=0,y:f=0}=b||{};l.value=h.coordX,i.value=h.coordY;const{power:S}=e.deviceInfo;e.ext.updateDeviceInfo({laserPosition:b});let x=e.ext.dataSource.canvasManager.canvas.getPluginByName(t);x==null||x.switchIcon(((P=e.deviceInfo)==null?void 0:P.gMode)||0);const E=Ln(S),D=Vn(E);x&&(x.updateCrossIconOffset(D),x.updateIcon({x:m,y:f}));const R=516,$=330;(l.value<0||l.value>R||i.value<0||i.value>$)&&Ge(c("mobile.toast.current_position_out_of_processing_range")),(!l.value||!i.value)&&Ge(c("mobile.toast.fail_to_get_position"))};return(b,h)=>{const m=mt,f=ee;return y(),L("div",{class:"laser-position-wrapper",tabindex:"0",onClick:r},[ct(w("div",Ma,[d(m,{name:"arrow",class:"right-arrow"}),Ha,d(f,{name:"red-cross-pos",size:"12px"}),d(En,{ext:n.ext,"device-info":n.deviceInfo,"update-coord":p(a),"show-coord":s.value,onOnUpdateValue:v},{default:g(()=>[w("div",Ga,z(`X:${l.value?p(u):"-"}`),1),w("div",Wa,z(`Y:${i.value?p(_):"-"}`),1)]),_:1},8,["ext","device-info","update-coord","show-coord"])],512),[[dt,n.showPosition]]),ct(w("div",ja,[d(m,{name:"arrow-left",class:"left-arrow"}),Ka,d(f,{name:"red-cross-pos",size:"12px"})],512),[[dt,!n.showPosition]])])}}});const Xa=G(Ya,[["__scopeId","data-v-fddd272a"]]),qa={key:0},Ja=F({__name:"MCanvasList",props:{canvasList:null,currentId:null},setup(n){var S,A;const o=Je(),e=oe(),t="D2",s=I(()=>o.info),a=k(!1);a.value=s.value.id===t;const l=I(()=>o.ext),i=I(()=>o.isInProcessing),u=I(()=>o.disconnectModalVisible),_=I(()=>o.isFrameMode),r=I(()=>e.currentId),c=k(!0),v=(A=(S=l.value)==null?void 0:S.customData)==null?void 0:A.dataMap[r.value];c.value=v?v.showCoord:!1;const b=Ve(),h=I(()=>{const{current:x,scale:E,fractionDigits:D}=b.unit;return{unit:x,pixelPerUnit:x===qt.MM?1:1/E,fractionDigits:D}}),m=k(!0),f=()=>{m.value=!m.value};return(x,E)=>p(kn)(n.canvasList)?J("",!0):(y(),L("div",qa,[a.value&&c.value?(y(),T(Xa,{key:0,"show-position":m.value,ext:p(l),"device-info":p(s),"is-in-processing":p(i),"dis-connect":p(u),"is-frame-mode":p(_),onOnChangeState:f},null,8,["show-position","ext","device-info","is-in-processing","dis-connect","is-frame-mode"])):J("",!0),(y(!0),L(W,null,X(n.canvasList,({id:D})=>(y(),T(Na,j({key:D,id:D,style:{visibility:n.currentId===D?"visible":"hidden"},"unit-data":p(h),canvas:p(B).getCanvas(D)},x.$attrs),null,16,["id","style","unit-data","canvas"]))),128))]))}}),Za=n=>(et("data-v-e6b51a86"),n=n(),tt(),n),Qa={class:"canvas-wrapper"},es={class:"canvas-selected-info"},ts={class:"canvas-container"},ns=Za(()=>w("div",{class:"show-bar-btn"},[w("div",{class:"show-bar"})],-1)),os=F({__name:"Editor",setup(n){const t=oe(),s=Je(),a=Jt(),{t:l}=Se(),i=Zt(),u=_n(),_=pn(),r=k(""),c=k(280),v=k(0),b=I(()=>t.currentId);K(()=>b.value,()=>{t.editorDisplaysLayerChange()},{deep:!0,immediate:!0});const h=async()=>{var V,O,Q;if(x.value){t.updateImageEditorVisible(!1),m.value="imageProcess",(V=B.canvas)==null||V.closeImageProcess();return}if(clearInterval(f),rt.removeSave(),r.value==="preview"){let q;try{q=bt({overlay:!0,duration:0});const te=(O=s.ext)==null?void 0:O.connected,ne=await i.checkProcess(),re=await((Q=s.ext)==null?void 0:Q.checkDeviceOnline());!te||(ne==null?void 0:ne.text)==="device.process.element_out_zoom"||(ne==null?void 0:ne.text)==="device.process.no_elements"||(re==null?void 0:re.text)==="device.process.device_is_working"?u.replace("/process-setting"):u.back()}catch(te){console.log(te),u.replace("/process-setting")}finally{q==null||q.close()}return}u.back()},m=k("processing");let f;Te(()=>{var V,O;t.listDisplayFonts(),((V=_==null?void 0:_.query)==null?void 0:V.from)==="preview"&&(r.value=(O=_==null?void 0:_.query)==null?void 0:O.from),f=setInterval(()=>{a.autoSaveTmp()},6e4),rt.setSave(a.autoSaveTmp),en(()=>(console.log("点击物理返回键"),h(),!0))}),Ze(()=>{clearInterval(f)});const S=I(()=>t.selected.num>=1),A=I(()=>{if(t.selectedAttrs.id){const V=t.selectedAttrs,O=Ve(),{scale:Q,fractionDigits:q,current:te}=O.unit,ne=`${Fe(V.width,Q,q)}${te} x ${Fe(V.height,Q,q)}${te}`,re=`X:${Fe(V.x,Q,q)}${te} Y:${Fe(V.y,Q,q)}${te}`;return`${ne}     ${re}`}else return""}),x=I(()=>t.imageEditorVisible),E=I(()=>t.selected.num===1&&t.selectedAttrs.type===We.BITMAP),D=I(()=>t.selected.num===1&&t.selectedAttrs.type===We.TEXT),R=I(()=>[{id:"processing",title:l("mobile.editor.processing_setting"),disabled:!1,cmp:Ia},{id:"imageProcess",title:l("mobile.editor.image_process"),disabled:!E.value,cmp:xa},{id:"font",title:l("mobile.editor.font_setting"),disabled:!D.value,cmp:Jo},{id:"displayAttrs",disabled:!1,title:l("mobile.editor.display_attrs"),cmp:Ao}].filter(O=>!O.disabled)),$=I(()=>[{id:"undo",icon:"undo",disabled:!t.currentState.enableUndo,onClick(){var V;(V=B.canvas)==null||V.undo()}},{id:"redo",icon:"redo",disabled:!t.currentState.enableRedo,onClick(){var V;(V=B.canvas)==null||V.redo()}}]),P=V=>{var O;v.value=(O=V.changedTouches[0])==null?void 0:O.clientY},N=V=>{var Q,q;const O=((Q=V.changedTouches[0])==null?void 0:Q.clientY)-v.value;c.value-=O,c.value>280?c.value=280:c.value<0&&(c.value=0),v.value=(q=V.changedTouches[0])==null?void 0:q.clientY},C=()=>{c.value>280/2?c.value=280:c.value=0},Z=(V,O)=>{t.updateCurrentEditorState({enableUndo:V,enableRedo:O})},ae=(V,O)=>{(O&&Sn(O,"layerTag")||O==="all")&&U()},U=wt(()=>{t.editorDisplaysLayerChange()},100),M=(V,O)=>{t.newDisplaysAdded({id:V,data:O}),U()},Y=()=>{t.editorDisplaysLayerChange()},fe=()=>{var V;(V=B.canvas)==null||V.setViewportToFit()};return un(()=>{var V;(V=B.canvas)==null||V.clearSelected()}),(V,O)=>{const Q=Ce,q=Qt,te=ze,ne=Ue,re=Ye;return y(),L(W,null,[d(q,{fixed:"",placeholder:"","left-text":p(x)?"":p(l)("mobile.editor.back"),onClickLeft:h},{title:g(()=>[(y(!0),L(W,null,X(p($),H=>(y(),T(Q,{key:H.id,disabled:H.disabled,class:ue(["editor-header-button",H.id]),color:"rgba(116, 122, 122, 0.05)",size:"small",onClick:H.onClick},{default:g(()=>[d(p(ee),{name:H.icon,size:"28px"},null,8,["name"])]),_:2},1032,["disabled","class","onClick"]))),128))]),_:1},8,["left-text"]),w("div",Qa,[w("div",es,z(p(A)),1),w("div",ts,[d(Ja,{"current-id":p(t).currentId,"canvas-list":p(t).canvasList,onChangeUndoHistory:Z,onCanvasDisplayChanged:ae,onNewDisplaysAdded:M,onDisplaysRemoved:Y},null,8,["current-id","canvas-list"])])]),d(re,{class:"editor-popup",overlay:!1,"safe-area-inset-bottom":"",show:!0,round:"",position:"bottom"},{default:g(()=>[p(x)?J("",!0):(y(),T(Ba,{key:0})),(y(),T(ut,{include:["ImageEditor"]},[p(x)?(y(),T(p(ua),{key:0,onHideImageEditor:O[0]||(O[0]=H=>(p(t).updateImageEditorVisible(!1),m.value="imageProcess"))})):p(S)?(y(),L("div",{key:1,onTouchstart:P,onTouchmove:N,onTouchend:C},[ns,d(ne,{active:m.value,"onUpdate:active":O[4]||(O[4]=H=>m.value=H),class:"editor-tabs"},{default:g(()=>[(y(!0),L(W,null,X(p(R),H=>(y(),T(te,{key:H.id,name:H.id,title:H.title,onTouchstart:O[1]||(O[1]=Ee=>Ee.stopPropagation()),onTouchmove:O[2]||(O[2]=Ee=>Ee.stopPropagation()),onTouchend:O[3]||(O[3]=Ee=>Ee.stopPropagation())},{default:g(()=>[(y(),T(ut,null,[w("section",{class:"editor-process-setting",style:pe(`height: ${c.value}px`)},[m.value===H.id?(y(),T(we(H.cmp),{key:0})):J("",!0)],4)],1024))]),_:2},1032,["name","title"]))),128))]),_:1},8,["active"])],32)):(y(),T(p(wa),{key:2}))],1024))]),_:1}),d(p(ee),{class:"zoomWrapper",name:"aim",onClick:fe})],64)}}});const fs=G(os,[["__scopeId","data-v-e6b51a86"]]);export{fs as default};
